<!DOCTYPE html>
<html>
<head>
<title>kiota-java-Refactoring-guide.md</title>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">

<style>
/* https://github.com/microsoft/vscode/blob/master/extensions/markdown-language-features/media/markdown.css */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

body {
	font-family: var(--vscode-markdown-font-family, -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif);
	font-size: var(--vscode-markdown-font-size, 14px);
	padding: 0 26px;
	line-height: var(--vscode-markdown-line-height, 22px);
	word-wrap: break-word;
}

#code-csp-warning {
	position: fixed;
	top: 0;
	right: 0;
	color: white;
	margin: 16px;
	text-align: center;
	font-size: 12px;
	font-family: sans-serif;
	background-color:#444444;
	cursor: pointer;
	padding: 6px;
	box-shadow: 1px 1px 1px rgba(0,0,0,.25);
}

#code-csp-warning:hover {
	text-decoration: none;
	background-color:#007acc;
	box-shadow: 2px 2px 2px rgba(0,0,0,.25);
}

body.scrollBeyondLastLine {
	margin-bottom: calc(100vh - 22px);
}

body.showEditorSelection .code-line {
	position: relative;
}

body.showEditorSelection .code-active-line:before,
body.showEditorSelection .code-line:hover:before {
	content: "";
	display: block;
	position: absolute;
	top: 0;
	left: -12px;
	height: 100%;
}

body.showEditorSelection li.code-active-line:before,
body.showEditorSelection li.code-line:hover:before {
	left: -30px;
}

.vscode-light.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(0, 0, 0, 0.15);
}

.vscode-light.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(0, 0, 0, 0.40);
}

.vscode-light.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-dark.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 255, 255, 0.4);
}

.vscode-dark.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 255, 255, 0.60);
}

.vscode-dark.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-high-contrast.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 160, 0, 0.7);
}

.vscode-high-contrast.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 160, 0, 1);
}

.vscode-high-contrast.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

img {
	max-width: 100%;
	max-height: 100%;
}

a {
	text-decoration: none;
}

a:hover {
	text-decoration: underline;
}

a:focus,
input:focus,
select:focus,
textarea:focus {
	outline: 1px solid -webkit-focus-ring-color;
	outline-offset: -1px;
}

hr {
	border: 0;
	height: 2px;
	border-bottom: 2px solid;
}

h1 {
	padding-bottom: 0.3em;
	line-height: 1.2;
	border-bottom-width: 1px;
	border-bottom-style: solid;
}

h1, h2, h3 {
	font-weight: normal;
}

table {
	border-collapse: collapse;
}

table > thead > tr > th {
	text-align: left;
	border-bottom: 1px solid;
}

table > thead > tr > th,
table > thead > tr > td,
table > tbody > tr > th,
table > tbody > tr > td {
	padding: 5px 10px;
}

table > tbody > tr + tr > td {
	border-top: 1px solid;
}

blockquote {
	margin: 0 7px 0 5px;
	padding: 0 16px 0 10px;
	border-left-width: 5px;
	border-left-style: solid;
}

code {
	font-family: Menlo, Monaco, Consolas, "Droid Sans Mono", "Courier New", monospace, "Droid Sans Fallback";
	font-size: 1em;
	line-height: 1.357em;
}

body.wordWrap pre {
	white-space: pre-wrap;
}

pre:not(.hljs),
pre.hljs code > div {
	padding: 16px;
	border-radius: 3px;
	overflow: auto;
}

pre code {
	color: var(--vscode-editor-foreground);
	tab-size: 4;
}

/** Theming */

.vscode-light pre {
	background-color: rgba(220, 220, 220, 0.4);
}

.vscode-dark pre {
	background-color: rgba(10, 10, 10, 0.4);
}

.vscode-high-contrast pre {
	background-color: rgb(0, 0, 0);
}

.vscode-high-contrast h1 {
	border-color: rgb(0, 0, 0);
}

.vscode-light table > thead > tr > th {
	border-color: rgba(0, 0, 0, 0.69);
}

.vscode-dark table > thead > tr > th {
	border-color: rgba(255, 255, 255, 0.69);
}

.vscode-light h1,
.vscode-light hr,
.vscode-light table > tbody > tr + tr > td {
	border-color: rgba(0, 0, 0, 0.18);
}

.vscode-dark h1,
.vscode-dark hr,
.vscode-dark table > tbody > tr + tr > td {
	border-color: rgba(255, 255, 255, 0.18);
}

</style>

<style>
/* Tomorrow Theme */
/* http://jmblog.github.com/color-themes-for-google-code-highlightjs */
/* Original theme - https://github.com/chriskempson/tomorrow-theme */

/* Tomorrow Comment */
.hljs-comment,
.hljs-quote {
	color: #8e908c;
}

/* Tomorrow Red */
.hljs-variable,
.hljs-template-variable,
.hljs-tag,
.hljs-name,
.hljs-selector-id,
.hljs-selector-class,
.hljs-regexp,
.hljs-deletion {
	color: #c82829;
}

/* Tomorrow Orange */
.hljs-number,
.hljs-built_in,
.hljs-builtin-name,
.hljs-literal,
.hljs-type,
.hljs-params,
.hljs-meta,
.hljs-link {
	color: #f5871f;
}

/* Tomorrow Yellow */
.hljs-attribute {
	color: #eab700;
}

/* Tomorrow Green */
.hljs-string,
.hljs-symbol,
.hljs-bullet,
.hljs-addition {
	color: #718c00;
}

/* Tomorrow Blue */
.hljs-title,
.hljs-section {
	color: #4271ae;
}

/* Tomorrow Purple */
.hljs-keyword,
.hljs-selector-tag {
	color: #8959a8;
}

.hljs {
	display: block;
	overflow-x: auto;
	color: #4d4d4c;
	padding: 0.5em;
}

.hljs-emphasis {
	font-style: italic;
}

.hljs-strong {
	font-weight: bold;
}
</style>

<style>
/*
 * Markdown PDF CSS
 */

 body {
	font-family: -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif, "Meiryo";
	padding: 0 12px;
}

pre {
	background-color: #f8f8f8;
	border: 1px solid #cccccc;
	border-radius: 3px;
	overflow-x: auto;
	white-space: pre-wrap;
	overflow-wrap: break-word;
}

pre:not(.hljs) {
	padding: 23px;
	line-height: 19px;
}

blockquote {
	background: rgba(127, 127, 127, 0.1);
	border-color: rgba(0, 122, 204, 0.5);
}

.emoji {
	height: 1.4em;
}

code {
	font-size: 14px;
	line-height: 19px;
}

/* for inline code */
:not(pre):not(.hljs) > code {
	color: #C9AE75; /* Change the old color so it seems less like an error */
	font-size: inherit;
}

/* Page Break : use <div class="page"/> to insert page break
-------------------------------------------------------- */
.page {
	page-break-after: always;
}

</style>

<script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
</head>
<body>
  <script>
    mermaid.initialize({
      startOnLoad: true,
      theme: document.body.classList.contains('vscode-dark') || document.body.classList.contains('vscode-high-contrast')
          ? 'dark'
          : 'default'
    });
  </script>
<h1 id="a-guide-to-refactoring-mock-clones-in-kiota-java">A guide to Refactoring mock clones in kiota-java</h1>
<h2 id="mock-clone-instance-kiota-javamci1">Mock Clone Instance #kiota-java_MCI_1</h2>
<ul>
<li><strong>Scope</strong>: method level</li>
<li><strong>Mocked Class</strong>: <code>com.microsoft.kiota.serialization.SerializationWriter</code></li>
<li><strong>Test Case Count</strong>: 2</li>
<li><strong>MO Count</strong>: 2</li>
</ul>
<h3 id="reusable-method">Reusable Method</h3>
<pre class="hljs"><code><div><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> SerializationWriter <span class="hljs-title">createMockSerializationWriter</span><span class="hljs-params">(ByteArrayInputStream serializedContent)</span> </span>{
    SerializationWriter mockSerializationWriter = mock(SerializationWriter<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;
    when(mockSerializationWriter.getSerializedContent()).thenReturn(serializedContent);
    <span class="hljs-keyword">return</span> mockSerializationWriter;
}
</div></code></pre>
<h3 id="the-refactoring-details-in-each-test-cases">The refactoring details in each test cases</h3>
<hr>
<h4 id="test-case-id-kiota-javatest11">Test Case ID #kiota-java_Test_1_1</h4>
<h4 id="test-case-name-serializesobjectfile-cjavaprojectsmicrosoftkiota-javacomponentsabstractionssrctestjavacommicrosoftkiotaserializationserializationhelperstestjava">Test Case Name: <code>serializesObject</code>(File: <code>C:\Java_projects\Microsoft\kiota-java\components\abstractions\src\test\java\com\microsoft\kiota\serialization\SerializationHelpersTest.java</code>)</h4>
<h4 id="mock-object-variable-name-mockserializationwriter">Mock Object Variable Name: <code>mockSerializationWriter</code></h4>
<summary>Suggested Diff</summary>
<pre class="hljs"><code><div><span class="hljs-comment">--- original</span>
<span class="hljs-comment">+++ refactored</span>
@@
void serializesObject() throws IOException {
<span class="hljs-deletion">-    final var mockSerializationWriter = mock(SerializationWriter.class);</span>
<span class="hljs-deletion">-    when(mockSerializationWriter.getSerializedContent()).thenReturn(new ByteArrayInputStream("{'id':'123'}".getBytes(_charset)));</span>
<span class="hljs-addition">+    final var mockSerializationWriter = createMockSerializationWriter(new ByteArrayInputStream("{'id':'123'}".getBytes(_charset)));</span>
    final var mockSerializationWriterFactory = mock(SerializationWriterFactory.class);
    when(mockSerializationWriterFactory.getSerializationWriter(_jsonContentType)).thenReturn(mockSerializationWriter);
    SerializationWriterFactoryRegistry.defaultInstance.contentTypeAssociatedFactories.put(_jsonContentType, mockSerializationWriterFactory);
    final var result = KiotaSerialization.serializeAsString(_jsonContentType, new TestEntity() {

        {
            setId("123");
        }
    });
    assertEquals("{'id':'123'}", result);
    verify(mockSerializationWriter, times(1)).writeObjectValue(eq(""), any(Parsable.class));
}
</div></code></pre>
<details><summary>Original Test Code (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-meta">@Test</span>

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">serializesObject</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException </span>{

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> mockSerializationWriter = mock(SerializationWriter<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    when(mockSerializationWriter.getSerializedContent()).thenReturn(<span class="hljs-keyword">new</span> ByteArrayInputStream(<span class="hljs-string">"{'id':'123'}"</span>.getBytes(_charset)));

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> mockSerializationWriterFactory = mock(SerializationWriterFactory<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    when(mockSerializationWriterFactory.getSerializationWriter(_jsonContentType)).thenReturn(mockSerializationWriter);

    SerializationWriterFactoryRegistry.defaultInstance.contentTypeAssociatedFactories.put(_jsonContentType, mockSerializationWriterFactory);

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> result = KiotaSerialization.serializeAsString(_jsonContentType, <span class="hljs-keyword">new</span> TestEntity() {



        {

            setId(<span class="hljs-string">"123"</span>);

        }

    });

    assertEquals(<span class="hljs-string">"{'id':'123'}"</span>, result);

    verify(mockSerializationWriter, times(<span class="hljs-number">1</span>)).writeObjectValue(eq(<span class="hljs-string">""</span>), any(Parsable<span class="hljs-class">.<span class="hljs-keyword">class</span>))</span>;

}
</div></code></pre>
</details>
<details><summary>Reusable Method for MCI (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> SerializationWriter <span class="hljs-title">createMockSerializationWriter</span><span class="hljs-params">(ByteArrayInputStream serializedContent)</span> </span>{
    SerializationWriter mockSerializationWriter = mock(SerializationWriter<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;
    when(mockSerializationWriter.getSerializedContent()).thenReturn(serializedContent);
    <span class="hljs-keyword">return</span> mockSerializationWriter;
}
</div></code></pre>
</details>
<hr>
<h4 id="test-case-id-kiota-javatest12">Test Case ID #kiota-java_Test_1_2</h4>
<h4 id="test-case-name-serializesobjectcollectionfile-cjavaprojectsmicrosoftkiota-javacomponentsabstractionssrctestjavacommicrosoftkiotaserializationserializationhelperstestjava">Test Case Name: <code>serializesObjectCollection</code>(File: <code>C:\Java_projects\Microsoft\kiota-java\components\abstractions\src\test\java\com\microsoft\kiota\serialization\SerializationHelpersTest.java</code>)</h4>
<h4 id="mock-object-variable-name-mockserializationwriter">Mock Object Variable Name: <code>mockSerializationWriter</code></h4>
<summary>Suggested Diff</summary>
<pre class="hljs"><code><div><span class="hljs-comment">--- original</span>
<span class="hljs-comment">+++ refactored</span>
@@
void serializesObjectCollection() throws IOException {
<span class="hljs-deletion">-    final var mockSerializationWriter = mock(SerializationWriter.class);</span>
<span class="hljs-deletion">-    when(mockSerializationWriter.getSerializedContent()).thenReturn(new ByteArrayInputStream("[{\'id\':\'123\'}]".getBytes(_charset)));</span>
<span class="hljs-addition">+    final var mockSerializationWriter = createMockSerializationWriter(new ByteArrayInputStream("[{\'id\':\'123\'}]".getBytes(_charset)));</span>
    final var mockSerializationWriterFactory = mock(SerializationWriterFactory.class);
    when(mockSerializationWriterFactory.getSerializationWriter(_jsonContentType)).thenReturn(mockSerializationWriter);
    SerializationWriterFactoryRegistry.defaultInstance.contentTypeAssociatedFactories.put(_jsonContentType, mockSerializationWriterFactory);
    final var result = KiotaSerialization.serializeAsString(_jsonContentType, new ArrayList&lt;&gt;() {

        {
            add(new TestEntity() {

                {
                    setId("123");
                }
            });
        }
    });
    assertEquals("[{\'id\':\'123\'}]", result);
    verify(mockSerializationWriter, times(1)).writeCollectionOfObjectValues(eq(""), any());
}
</div></code></pre>
<details><summary>Original Test Code (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-meta">@Test</span>

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">serializesObjectCollection</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException </span>{

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> mockSerializationWriter = mock(SerializationWriter<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    when(mockSerializationWriter.getSerializedContent()).thenReturn(<span class="hljs-keyword">new</span> ByteArrayInputStream(<span class="hljs-string">"[{'id':'123'}]"</span>.getBytes(_charset)));

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> mockSerializationWriterFactory = mock(SerializationWriterFactory<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    when(mockSerializationWriterFactory.getSerializationWriter(_jsonContentType)).thenReturn(mockSerializationWriter);

    SerializationWriterFactoryRegistry.defaultInstance.contentTypeAssociatedFactories.put(_jsonContentType, mockSerializationWriterFactory);

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> result = KiotaSerialization.serializeAsString(_jsonContentType, <span class="hljs-keyword">new</span> ArrayList&lt;&gt;() {



        {

            add(<span class="hljs-keyword">new</span> TestEntity() {



                {

                    setId(<span class="hljs-string">"123"</span>);

                }

            });

        }

    });

    assertEquals(<span class="hljs-string">"[{'id':'123'}]"</span>, result);

    verify(mockSerializationWriter, times(<span class="hljs-number">1</span>)).writeCollectionOfObjectValues(eq(<span class="hljs-string">""</span>), any());

}
</div></code></pre>
</details>
<details><summary>Reusable Method for MCI (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> SerializationWriter <span class="hljs-title">createMockSerializationWriter</span><span class="hljs-params">(ByteArrayInputStream serializedContent)</span> </span>{
    SerializationWriter mockSerializationWriter = mock(SerializationWriter<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;
    when(mockSerializationWriter.getSerializedContent()).thenReturn(serializedContent);
    <span class="hljs-keyword">return</span> mockSerializationWriter;
}
</div></code></pre>
</details>
<hr>
<h2 id="mock-clone-instance-kiota-javamci2">Mock Clone Instance #kiota-java_MCI_2</h2>
<ul>
<li><strong>Scope</strong>: method level</li>
<li><strong>Mocked Class</strong>: <code>com.microsoft.kiota.serialization.SerializationWriter</code></li>
<li><strong>Test Case Count</strong>: 4</li>
<li><strong>MO Count</strong>: 4</li>
</ul>
<h3 id="reusable-method">Reusable Method</h3>
<pre class="hljs"><code><div><span class="hljs-comment">// === Declare in class scope ===</span>
<span class="hljs-keyword">private</span> SerializationWriter writer;

<span class="hljs-comment">// === Add to @BeforeEach method ===</span>
<span class="hljs-meta">@BeforeEach</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setUp</span><span class="hljs-params">()</span> </span>{
    writer = mock(SerializationWriter<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;
}

<span class="hljs-comment">// === Replace local variable in test with ===</span>
writer;

</div></code></pre>
<h3 id="the-refactoring-details-in-each-test-cases">The refactoring details in each test cases</h3>
<hr>
<h4 id="test-case-id-kiota-javatest21">Test Case ID #kiota-java_Test_2_1</h4>
<h4 id="test-case-name-requiresrequestadapterfile-cjavaprojectsmicrosoftkiota-javacomponentsabstractionssrctestjavacommicrosoftkiotamultipartbodytestjava">Test Case Name: <code>requiresRequestAdapter</code>(File: <code>C:\Java_projects\Microsoft\kiota-java\components\abstractions\src\test\java\com\microsoft\kiota\MultiPartBodyTest.java</code>)</h4>
<h4 id="mock-object-variable-name-writer">Mock Object Variable Name: <code>writer</code></h4>
<summary>Suggested Diff</summary>
<pre class="hljs"><code><div>@@
 @Test
 void requiresRequestAdapter() {
     final MultipartBody multipartBody = new MultipartBody();
<span class="hljs-deletion">-    final SerializationWriter writer = mock(SerializationWriter.class);</span>
<span class="hljs-addition">+    // removed local mock; replaced with global field `writer`</span>
     assertThrows(IllegalStateException.class, () -&gt; multipartBody.serialize(writer));
 }
</div></code></pre>
<details><summary>Original Test Code (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-meta">@Test</span>

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">requiresRequestAdapter</span><span class="hljs-params">()</span> </span>{

    <span class="hljs-keyword">final</span> MultipartBody multipartBody = <span class="hljs-keyword">new</span> MultipartBody();

    <span class="hljs-keyword">final</span> SerializationWriter writer = mock(SerializationWriter<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    assertThrows(IllegalStateException<span class="hljs-class">.<span class="hljs-keyword">class</span>, () -&gt; <span class="hljs-title">multipartBody</span>.<span class="hljs-title">serialize</span>(<span class="hljs-title">writer</span>))</span>;

}
</div></code></pre>
</details>
<details><summary>Reusable Method for MCI (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-comment">// === Declare in class scope ===</span>
<span class="hljs-keyword">private</span> SerializationWriter writer;

<span class="hljs-comment">// === Add to @BeforeEach method ===</span>
<span class="hljs-meta">@BeforeEach</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setUp</span><span class="hljs-params">()</span> </span>{
    writer = mock(SerializationWriter<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;
}

<span class="hljs-comment">// === Replace local variable in test with ===</span>
writer;

</div></code></pre>
</details>
<hr>
<h4 id="test-case-id-kiota-javatest22">Test Case ID #kiota-java_Test_2_2</h4>
<h4 id="test-case-name-requirespartsforserializationfile-cjavaprojectsmicrosoftkiota-javacomponentsabstractionssrctestjavacommicrosoftkiotamultipartbodytestjava">Test Case Name: <code>requiresPartsForSerialization</code>(File: <code>C:\Java_projects\Microsoft\kiota-java\components\abstractions\src\test\java\com\microsoft\kiota\MultiPartBodyTest.java</code>)</h4>
<h4 id="mock-object-variable-name-writer">Mock Object Variable Name: <code>writer</code></h4>
<summary>Suggested Diff</summary>
<pre class="hljs"><code><div>@@
 @Test
 void requiresPartsForSerialization() {
     final MultipartBody multipartBody = new MultipartBody();
<span class="hljs-deletion">-    final SerializationWriter writer = mock(SerializationWriter.class);</span>
<span class="hljs-addition">+    // removed local mock; replaced with global field `writer`</span>
     final RequestAdapter requestAdapter = mock(RequestAdapter.class);
     multipartBody.requestAdapter = requestAdapter;
     assertThrows(IllegalStateException.class, () -&gt; multipartBody.serialize(writer));
}
</div></code></pre>
<details><summary>Original Test Code (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-meta">@Test</span>

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">requiresPartsForSerialization</span><span class="hljs-params">()</span> </span>{

    <span class="hljs-keyword">final</span> MultipartBody multipartBody = <span class="hljs-keyword">new</span> MultipartBody();

    <span class="hljs-keyword">final</span> SerializationWriter writer = mock(SerializationWriter<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    <span class="hljs-keyword">final</span> RequestAdapter requestAdapter = mock(RequestAdapter<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    multipartBody.requestAdapter = requestAdapter;

    assertThrows(IllegalStateException<span class="hljs-class">.<span class="hljs-keyword">class</span>, () -&gt; <span class="hljs-title">multipartBody</span>.<span class="hljs-title">serialize</span>(<span class="hljs-title">writer</span>))</span>;

}
</div></code></pre>
</details>
<details><summary>Reusable Method for MCI (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-comment">// === Declare in class scope ===</span>
<span class="hljs-keyword">private</span> SerializationWriter writer;

<span class="hljs-comment">// === Add to @BeforeEach method ===</span>
<span class="hljs-meta">@BeforeEach</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setUp</span><span class="hljs-params">()</span> </span>{
    writer = mock(SerializationWriter<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;
}

<span class="hljs-comment">// === Replace local variable in test with ===</span>
writer;

</div></code></pre>
</details>
<hr>
<h4 id="test-case-id-kiota-javatest23">Test Case ID #kiota-java_Test_2_3</h4>
<h4 id="test-case-name-notaddfilenamefile-cjavaprojectsmicrosoftkiota-javacomponentsabstractionssrctestjavacommicrosoftkiotamultipartbodytestjava">Test Case Name: <code>notAddFilename</code>(File: <code>C:\Java_projects\Microsoft\kiota-java\components\abstractions\src\test\java\com\microsoft\kiota\MultiPartBodyTest.java</code>)</h4>
<h4 id="mock-object-variable-name-writer">Mock Object Variable Name: <code>writer</code></h4>
<summary>Suggested Diff</summary>
<pre class="hljs"><code><div>@@
 @Test
 void notAddFilename() {
     final MultipartBody multipartBody = new MultipartBody();
<span class="hljs-deletion">-    final SerializationWriter writer = mock(SerializationWriter.class);</span>
<span class="hljs-addition">+    // removed local mock; replaced with global field `writer`</span>
     multipartBody.requestAdapter = mock(RequestAdapter.class);
     multipartBody.addOrReplacePart("foo", "bar", "baz");
<span class="hljs-deletion">-    multipartBody.serialize(writer);</span>
<span class="hljs-addition">+    multipartBody.serialize(writer);</span>
<span class="hljs-deletion">-    verify(writer).writeStringValue("Content-Disposition", "form-data; name=\"foo\""");</span>
<span class="hljs-addition">+    verify(writer).writeStringValue("Content-Disposition", "form-data; name=\"foo\""");</span>
 }
</div></code></pre>
<details><summary>Original Test Code (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-meta">@Test</span>

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">notAddFilename</span><span class="hljs-params">()</span> </span>{

    <span class="hljs-keyword">final</span> MultipartBody multipartBody = <span class="hljs-keyword">new</span> MultipartBody();

    <span class="hljs-keyword">final</span> SerializationWriter writer = mock(SerializationWriter<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    multipartBody.requestAdapter = mock(RequestAdapter<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    multipartBody.addOrReplacePart(<span class="hljs-string">"foo"</span>, <span class="hljs-string">"bar"</span>, <span class="hljs-string">"baz"</span>);

    multipartBody.serialize(writer);

    verify(writer).writeStringValue(<span class="hljs-string">"Content-Disposition"</span>, <span class="hljs-string">"form-data; name=\"foo\""</span>);

}
</div></code></pre>
</details>
<details><summary>Reusable Method for MCI (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-comment">// === Declare in class scope ===</span>
<span class="hljs-keyword">private</span> SerializationWriter writer;

<span class="hljs-comment">// === Add to @BeforeEach method ===</span>
<span class="hljs-meta">@BeforeEach</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setUp</span><span class="hljs-params">()</span> </span>{
    writer = mock(SerializationWriter<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;
}

<span class="hljs-comment">// === Replace local variable in test with ===</span>
writer;

</div></code></pre>
</details>
<hr>
<h4 id="test-case-id-kiota-javatest24">Test Case ID #kiota-java_Test_2_4</h4>
<h4 id="test-case-name-addfilenamefile-cjavaprojectsmicrosoftkiota-javacomponentsabstractionssrctestjavacommicrosoftkiotamultipartbodytestjava">Test Case Name: <code>addFilename</code>(File: <code>C:\Java_projects\Microsoft\kiota-java\components\abstractions\src\test\java\com\microsoft\kiota\MultiPartBodyTest.java</code>)</h4>
<h4 id="mock-object-variable-name-writer">Mock Object Variable Name: <code>writer</code></h4>
<summary>Suggested Diff</summary>
<pre class="hljs"><code><div>@@
 @Test
 void addFilename() {
     final MultipartBody multipartBody = new MultipartBody();
<span class="hljs-deletion">-    final SerializationWriter writer = mock(SerializationWriter.class);</span>
<span class="hljs-addition">+    // removed local mock; replaced with global field `writer`</span>
     multipartBody.requestAdapter = mock(RequestAdapter.class);
     multipartBody.addOrReplacePart("foo", "bar", "baz", "image.png");
<span class="hljs-deletion">-    multipartBody.serialize(writer);</span>
<span class="hljs-addition">+    multipartBody.serialize(writer);</span>
<span class="hljs-deletion">-    verify(writer).writeStringValue("Content-Disposition", "form-data; name=\"foo\"; filename=\"image.png\"");</span>
<span class="hljs-addition">+    verify(writer).writeStringValue("Content-Disposition", "form-data; name=\"foo\"; filename=\"image.png\"");</span>
 }
</div></code></pre>
<details><summary>Original Test Code (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-meta">@Test</span>

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">addFilename</span><span class="hljs-params">()</span> </span>{

    <span class="hljs-keyword">final</span> MultipartBody multipartBody = <span class="hljs-keyword">new</span> MultipartBody();

    <span class="hljs-keyword">final</span> SerializationWriter writer = mock(SerializationWriter<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    multipartBody.requestAdapter = mock(RequestAdapter<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    multipartBody.addOrReplacePart(<span class="hljs-string">"foo"</span>, <span class="hljs-string">"bar"</span>, <span class="hljs-string">"baz"</span>, <span class="hljs-string">"image.png"</span>);

    multipartBody.serialize(writer);

    verify(writer).writeStringValue(<span class="hljs-string">"Content-Disposition"</span>, <span class="hljs-string">"form-data; name=\"foo\"; filename=\"image.png\""</span>);

}
</div></code></pre>
</details>
<details><summary>Reusable Method for MCI (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-comment">// === Declare in class scope ===</span>
<span class="hljs-keyword">private</span> SerializationWriter writer;

<span class="hljs-comment">// === Add to @BeforeEach method ===</span>
<span class="hljs-meta">@BeforeEach</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setUp</span><span class="hljs-params">()</span> </span>{
    writer = mock(SerializationWriter<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;
}

<span class="hljs-comment">// === Replace local variable in test with ===</span>
writer;

</div></code></pre>
</details>
<hr>
<h2 id="mock-clone-instance-kiota-javamci3">Mock Clone Instance #kiota-java_MCI_3</h2>
<ul>
<li><strong>Scope</strong>: method level</li>
<li><strong>Mocked Class</strong>: <code>com.microsoft.kiota.serialization.SerializationWriter</code></li>
<li><strong>Test Case Count</strong>: 5</li>
<li><strong>MO Count</strong>: 5</li>
</ul>
<h3 id="reusable-method">Reusable Method</h3>
<pre class="hljs"><code><div><span class="hljs-comment">// === Declare in class scope ===</span>
<span class="hljs-keyword">private</span> SerializationWriter writerMock;

<span class="hljs-comment">// === Add to @BeforeEach method ===</span>
<span class="hljs-meta">@BeforeEach</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setUp</span><span class="hljs-params">()</span> </span>{
    writerMock = mock(SerializationWriter<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;
}

<span class="hljs-comment">// === Replace local variable in test with ===</span>
writerMock;

</div></code></pre>
<h3 id="the-refactoring-details-in-each-test-cases">The refactoring details in each test cases</h3>
<hr>
<h4 id="test-case-id-kiota-javatest31">Test Case ID #kiota-java_Test_3_1</h4>
<h4 id="test-case-name-setsparsablecontentfile-cjavaprojectsmicrosoftkiota-javacomponentsabstractionssrctestjavacommicrosoftkiotarequestinformationtestjava">Test Case Name: <code>SetsParsableContent</code>(File: <code>C:\Java_projects\Microsoft\kiota-java\components\abstractions\src\test\java\com\microsoft\kiota\RequestInformationTest.java</code>)</h4>
<h4 id="mock-object-variable-name-writermock">Mock Object Variable Name: <code>writerMock</code></h4>
<summary>Suggested Diff</summary>
<pre class="hljs"><code><div>@@
     requestInfo.httpMethod = HttpMethod.POST;
     requestInfo.urlTemplate = "http://localhost/users";
<span class="hljs-deletion">-    final SerializationWriter writerMock = mock(SerializationWriter.class);</span>
<span class="hljs-addition">+    // removed local mock; replaced with global field `writerMock`</span>
     final SerializationWriterFactory factoryMock = mock(SerializationWriterFactory.class);
     when(factoryMock.getSerializationWriter(anyString())).thenReturn(writerMock);
     final RequestAdapter requestAdapterMock = mock(RequestAdapter.class);
     when(requestAdapterMock.getSerializationWriterFactory()).thenReturn(factoryMock);
     requestInfo.setContentFromParsable(requestAdapterMock, "application/json", new TestEntity());
<span class="hljs-deletion">-    verify(writerMock, times(1)).writeObjectValue(any(), any(TestEntity.class));</span>
<span class="hljs-addition">+    verify(writerMock, times(1)).writeObjectValue(any(), any(TestEntity.class));</span>
<span class="hljs-deletion">-    verify(writerMock, never()).writeCollectionOfObjectValues(anyString(), any(ArrayList.class));</span>
<span class="hljs-addition">+    verify(writerMock, never()).writeCollectionOfObjectValues(anyString(), any(ArrayList.class));</span>
</div></code></pre>
<details><summary>Original Test Code (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-meta">@Test</span>

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">SetsParsableContent</span><span class="hljs-params">()</span> </span>{

    <span class="hljs-comment">// Arrange as the request builders would</span>

    <span class="hljs-keyword">final</span> RequestInformation requestInfo = <span class="hljs-keyword">new</span> RequestInformation();

    requestInfo.httpMethod = HttpMethod.POST;

    requestInfo.urlTemplate = <span class="hljs-string">"http://localhost/users"</span>;

    <span class="hljs-keyword">final</span> SerializationWriter writerMock = mock(SerializationWriter<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    <span class="hljs-keyword">final</span> SerializationWriterFactory factoryMock = mock(SerializationWriterFactory<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    when(factoryMock.getSerializationWriter(anyString())).thenReturn(writerMock);

    <span class="hljs-keyword">final</span> RequestAdapter requestAdapterMock = mock(RequestAdapter<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    when(requestAdapterMock.getSerializationWriterFactory()).thenReturn(factoryMock);

    requestInfo.setContentFromParsable(requestAdapterMock, <span class="hljs-string">"application/json"</span>, <span class="hljs-keyword">new</span> TestEntity());

    verify(writerMock, times(<span class="hljs-number">1</span>)).writeObjectValue(any(), any(TestEntity<span class="hljs-class">.<span class="hljs-keyword">class</span>))</span>;

    verify(writerMock, never()).writeCollectionOfObjectValues(anyString(), any(ArrayList<span class="hljs-class">.<span class="hljs-keyword">class</span>))</span>;

}
</div></code></pre>
</details>
<details><summary>Reusable Method for MCI (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-comment">// === Declare in class scope ===</span>
<span class="hljs-keyword">private</span> SerializationWriter writerMock;

<span class="hljs-comment">// === Add to @BeforeEach method ===</span>
<span class="hljs-meta">@BeforeEach</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setUp</span><span class="hljs-params">()</span> </span>{
    writerMock = mock(SerializationWriter<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;
}

<span class="hljs-comment">// === Replace local variable in test with ===</span>
writerMock;

</div></code></pre>
</details>
<hr>
<h4 id="test-case-id-kiota-javatest32">Test Case ID #kiota-java_Test_3_2</h4>
<h4 id="test-case-name-setsparsablecontentcollectionfile-cjavaprojectsmicrosoftkiota-javacomponentsabstractionssrctestjavacommicrosoftkiotarequestinformationtestjava">Test Case Name: <code>SetsParsableContentCollection</code>(File: <code>C:\Java_projects\Microsoft\kiota-java\components\abstractions\src\test\java\com\microsoft\kiota\RequestInformationTest.java</code>)</h4>
<h4 id="mock-object-variable-name-writermock">Mock Object Variable Name: <code>writerMock</code></h4>
<summary>Suggested Diff</summary>
<pre class="hljs"><code><div>@@
 @Test
 void SetsParsableContentCollection() {
     // Arrange as the request builders would
     final RequestInformation requestInfo = new RequestInformation();
     requestInfo.httpMethod = HttpMethod.POST;
     requestInfo.urlTemplate = "http://localhost/users";
<span class="hljs-deletion">-    final SerializationWriter writerMock = mock(SerializationWriter.class);</span>
<span class="hljs-addition">+    // removed local mock; replaced with global field `writerMock`</span>
     final SerializationWriterFactory factoryMock = mock(SerializationWriterFactory.class);
     when(factoryMock.getSerializationWriter(anyString())).thenReturn(writerMock);
     final RequestAdapter requestAdapterMock = mock(RequestAdapter.class);
     when(requestAdapterMock.getSerializationWriterFactory()).thenReturn(factoryMock);
     requestInfo.setContentFromParsable(requestAdapterMock, "application/json", new TestEntity[] { new TestEntity() });
     verify(writerMock, never()).writeObjectValue(any(), any(TestEntity.class));
     verify(writerMock, times(1)).writeCollectionOfObjectValues(any(), any(Iterable.class));
}
</div></code></pre>
<details><summary>Original Test Code (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-meta">@Test</span>

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">SetsParsableContentCollection</span><span class="hljs-params">()</span> </span>{

    <span class="hljs-comment">// Arrange as the request builders would</span>

    <span class="hljs-keyword">final</span> RequestInformation requestInfo = <span class="hljs-keyword">new</span> RequestInformation();

    requestInfo.httpMethod = HttpMethod.POST;

    requestInfo.urlTemplate = <span class="hljs-string">"http://localhost/users"</span>;

    <span class="hljs-keyword">final</span> SerializationWriter writerMock = mock(SerializationWriter<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    <span class="hljs-keyword">final</span> SerializationWriterFactory factoryMock = mock(SerializationWriterFactory<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    when(factoryMock.getSerializationWriter(anyString())).thenReturn(writerMock);

    <span class="hljs-keyword">final</span> RequestAdapter requestAdapterMock = mock(RequestAdapter<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    when(requestAdapterMock.getSerializationWriterFactory()).thenReturn(factoryMock);

    requestInfo.setContentFromParsable(requestAdapterMock, <span class="hljs-string">"application/json"</span>, <span class="hljs-keyword">new</span> TestEntity[] { <span class="hljs-keyword">new</span> TestEntity() });

    verify(writerMock, never()).writeObjectValue(any(), any(TestEntity<span class="hljs-class">.<span class="hljs-keyword">class</span>))</span>;

    verify(writerMock, times(<span class="hljs-number">1</span>)).writeCollectionOfObjectValues(any(), any(Iterable<span class="hljs-class">.<span class="hljs-keyword">class</span>))</span>;

}
</div></code></pre>
</details>
<details><summary>Reusable Method for MCI (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-comment">// === Declare in class scope ===</span>
<span class="hljs-keyword">private</span> SerializationWriter writerMock;

<span class="hljs-comment">// === Add to @BeforeEach method ===</span>
<span class="hljs-meta">@BeforeEach</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setUp</span><span class="hljs-params">()</span> </span>{
    writerMock = mock(SerializationWriter<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;
}

<span class="hljs-comment">// === Replace local variable in test with ===</span>
writerMock;

</div></code></pre>
</details>
<hr>
<h4 id="test-case-id-kiota-javatest33">Test Case ID #kiota-java_Test_3_3</h4>
<h4 id="test-case-name-setsscalarcontentcollectionfile-cjavaprojectsmicrosoftkiota-javacomponentsabstractionssrctestjavacommicrosoftkiotarequestinformationtestjava">Test Case Name: <code>SetsScalarContentCollection</code>(File: <code>C:\Java_projects\Microsoft\kiota-java\components\abstractions\src\test\java\com\microsoft\kiota\RequestInformationTest.java</code>)</h4>
<h4 id="mock-object-variable-name-writermock">Mock Object Variable Name: <code>writerMock</code></h4>
<summary>Suggested Diff</summary>
<pre class="hljs"><code><div>@@
 @Test
 void SetsScalarContentCollection() {
     // Arrange as the request builders would
     final RequestInformation requestInfo = new RequestInformation();
     requestInfo.httpMethod = HttpMethod.POST;
     requestInfo.urlTemplate = "http://localhost/users";
<span class="hljs-deletion">-    final SerializationWriter writerMock = mock(SerializationWriter.class);</span>
<span class="hljs-addition">+    // removed local mock; replaced with global field `writerMock`</span>
     final SerializationWriterFactory factoryMock = mock(SerializationWriterFactory.class);
     when(factoryMock.getSerializationWriter(anyString())).thenReturn(writerMock);
     final RequestAdapter requestAdapterMock = mock(RequestAdapter.class);
     when(requestAdapterMock.getSerializationWriterFactory()).thenReturn(factoryMock);
     requestInfo.setContentFromScalarCollection(requestAdapterMock, "application/json", new String[] { "foo" });
     verify(writerMock, never()).writeStringValue(any(), anyString());
     verify(writerMock, times(1)).writeCollectionOfPrimitiveValues(any(), any(Iterable.class));
}
</div></code></pre>
<details><summary>Original Test Code (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-meta">@Test</span>

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">SetsScalarContentCollection</span><span class="hljs-params">()</span> </span>{

    <span class="hljs-comment">// Arrange as the request builders would</span>

    <span class="hljs-keyword">final</span> RequestInformation requestInfo = <span class="hljs-keyword">new</span> RequestInformation();

    requestInfo.httpMethod = HttpMethod.POST;

    requestInfo.urlTemplate = <span class="hljs-string">"http://localhost/users"</span>;

    <span class="hljs-keyword">final</span> SerializationWriter writerMock = mock(SerializationWriter<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    <span class="hljs-keyword">final</span> SerializationWriterFactory factoryMock = mock(SerializationWriterFactory<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    when(factoryMock.getSerializationWriter(anyString())).thenReturn(writerMock);

    <span class="hljs-keyword">final</span> RequestAdapter requestAdapterMock = mock(RequestAdapter<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    when(requestAdapterMock.getSerializationWriterFactory()).thenReturn(factoryMock);

    requestInfo.setContentFromScalarCollection(requestAdapterMock, <span class="hljs-string">"application/json"</span>, <span class="hljs-keyword">new</span> String[] { <span class="hljs-string">"foo"</span> });

    verify(writerMock, never()).writeStringValue(any(), anyString());

    verify(writerMock, times(<span class="hljs-number">1</span>)).writeCollectionOfPrimitiveValues(any(), any(Iterable<span class="hljs-class">.<span class="hljs-keyword">class</span>))</span>;

}
</div></code></pre>
</details>
<details><summary>Reusable Method for MCI (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-comment">// === Declare in class scope ===</span>
<span class="hljs-keyword">private</span> SerializationWriter writerMock;

<span class="hljs-comment">// === Add to @BeforeEach method ===</span>
<span class="hljs-meta">@BeforeEach</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setUp</span><span class="hljs-params">()</span> </span>{
    writerMock = mock(SerializationWriter<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;
}

<span class="hljs-comment">// === Replace local variable in test with ===</span>
writerMock;

</div></code></pre>
</details>
<hr>
<h4 id="test-case-id-kiota-javatest34">Test Case ID #kiota-java_Test_3_4</h4>
<h4 id="test-case-name-setsscalarcontentfile-cjavaprojectsmicrosoftkiota-javacomponentsabstractionssrctestjavacommicrosoftkiotarequestinformationtestjava">Test Case Name: <code>SetsScalarContent</code>(File: <code>C:\Java_projects\Microsoft\kiota-java\components\abstractions\src\test\java\com\microsoft\kiota\RequestInformationTest.java</code>)</h4>
<h4 id="mock-object-variable-name-writermock">Mock Object Variable Name: <code>writerMock</code></h4>
<summary>Suggested Diff</summary>
<pre class="hljs"><code><div>@@
     requestInfo.httpMethod = HttpMethod.POST;
     requestInfo.urlTemplate = "http://localhost/users";
<span class="hljs-deletion">-    final SerializationWriter writerMock = mock(SerializationWriter.class);</span>
<span class="hljs-addition">+    // removed local mock; replaced with global field `writerMock`</span>
     final SerializationWriterFactory factoryMock = mock(SerializationWriterFactory.class);
     when(factoryMock.getSerializationWriter(anyString())).thenReturn(writerMock);
     final RequestAdapter requestAdapterMock = mock(RequestAdapter.class);
     when(requestAdapterMock.getSerializationWriterFactory()).thenReturn(factoryMock);
     requestInfo.setContentFromScalar(requestAdapterMock, "application/json", "foo");
<span class="hljs-deletion">-    verify(writerMock, times(1)).writeStringValue(any(), anyString());</span>
<span class="hljs-addition">+    verify(writerMock, times(1)).writeStringValue(any(), anyString());</span>
<span class="hljs-deletion">-    verify(writerMock, never()).writeCollectionOfPrimitiveValues(any(), any(Iterable.class));</span>
<span class="hljs-addition">+    verify(writerMock, never()).writeCollectionOfPrimitiveValues(any(), any(Iterable.class));</span>
</div></code></pre>
<details><summary>Original Test Code (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-meta">@Test</span>

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">SetsScalarContent</span><span class="hljs-params">()</span> </span>{

    <span class="hljs-comment">// Arrange as the request builders would</span>

    <span class="hljs-keyword">final</span> RequestInformation requestInfo = <span class="hljs-keyword">new</span> RequestInformation();

    requestInfo.httpMethod = HttpMethod.POST;

    requestInfo.urlTemplate = <span class="hljs-string">"http://localhost/users"</span>;

    <span class="hljs-keyword">final</span> SerializationWriter writerMock = mock(SerializationWriter<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    <span class="hljs-keyword">final</span> SerializationWriterFactory factoryMock = mock(SerializationWriterFactory<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    when(factoryMock.getSerializationWriter(anyString())).thenReturn(writerMock);

    <span class="hljs-keyword">final</span> RequestAdapter requestAdapterMock = mock(RequestAdapter<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    when(requestAdapterMock.getSerializationWriterFactory()).thenReturn(factoryMock);

    requestInfo.setContentFromScalar(requestAdapterMock, <span class="hljs-string">"application/json"</span>, <span class="hljs-string">"foo"</span>);

    verify(writerMock, times(<span class="hljs-number">1</span>)).writeStringValue(any(), anyString());

    verify(writerMock, never()).writeCollectionOfPrimitiveValues(any(), any(Iterable<span class="hljs-class">.<span class="hljs-keyword">class</span>))</span>;

}
</div></code></pre>
</details>
<details><summary>Reusable Method for MCI (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-comment">// === Declare in class scope ===</span>
<span class="hljs-keyword">private</span> SerializationWriter writerMock;

<span class="hljs-comment">// === Add to @BeforeEach method ===</span>
<span class="hljs-meta">@BeforeEach</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setUp</span><span class="hljs-params">()</span> </span>{
    writerMock = mock(SerializationWriter<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;
}

<span class="hljs-comment">// === Replace local variable in test with ===</span>
writerMock;

</div></code></pre>
</details>
<hr>
<h4 id="test-case-id-kiota-javatest35">Test Case ID #kiota-java_Test_3_5</h4>
<h4 id="test-case-name-setsboundaryonmultipartbodyfile-cjavaprojectsmicrosoftkiota-javacomponentsabstractionssrctestjavacommicrosoftkiotarequestinformationtestjava">Test Case Name: <code>SetsBoundaryOnMultipartBody</code>(File: <code>C:\Java_projects\Microsoft\kiota-java\components\abstractions\src\test\java\com\microsoft\kiota\RequestInformationTest.java</code>)</h4>
<h4 id="mock-object-variable-name-writermock">Mock Object Variable Name: <code>writerMock</code></h4>
<summary>Suggested Diff</summary>
<pre class="hljs"><code><div>@@
 @Test
 void SetsBoundaryOnMultipartBody() {
<span class="hljs-deletion">-    final SerializationWriter writerMock = mock(SerializationWriter.class);</span>
<span class="hljs-addition">+    // removed local mock; replaced with global field `writerMock`</span>
     final SerializationWriterFactory factoryMock = mock(SerializationWriterFactory.class);
     when(factoryMock.getSerializationWriter(anyString())).thenReturn(writerMock);
     final RequestAdapter requestAdapterMock = mock(RequestAdapter.class);
     when(requestAdapterMock.getSerializationWriterFactory()).thenReturn(factoryMock);
     final MultipartBody multipartBody = new MultipartBody();
     multipartBody.requestAdapter = requestAdapterMock;
     requestInfo.setContentFromParsable(requestAdapterMock, "multipart/form-data", multipartBody);
     assertNotNull(multipartBody.getBoundary());
     assertFalse(multipartBody.getBoundary().isEmpty());
     assertEquals("multipart/form-data; boundary=" + multipartBody.getBoundary(), requestInfo.headers.get("Content-Type").toArray()[0]);
}
</div></code></pre>
<details><summary>Original Test Code (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-meta">@Test</span>

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">SetsBoundaryOnMultipartBody</span><span class="hljs-params">()</span> </span>{

    <span class="hljs-keyword">final</span> RequestInformation requestInfo = <span class="hljs-keyword">new</span> RequestInformation();

    requestInfo.httpMethod = HttpMethod.POST;

    requestInfo.urlTemplate = <span class="hljs-string">"http://localhost/{URITemplate}/ParameterMapping?IsCaseSensitive={IsCaseSensitive}"</span>;

    <span class="hljs-keyword">final</span> SerializationWriter writerMock = mock(SerializationWriter<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    <span class="hljs-keyword">final</span> SerializationWriterFactory factoryMock = mock(SerializationWriterFactory<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    when(factoryMock.getSerializationWriter(anyString())).thenReturn(writerMock);

    <span class="hljs-keyword">final</span> RequestAdapter requestAdapterMock = mock(RequestAdapter<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    when(requestAdapterMock.getSerializationWriterFactory()).thenReturn(factoryMock);

    <span class="hljs-keyword">final</span> MultipartBody multipartBody = <span class="hljs-keyword">new</span> MultipartBody();

    multipartBody.requestAdapter = requestAdapterMock;

    requestInfo.setContentFromParsable(requestAdapterMock, <span class="hljs-string">"multipart/form-data"</span>, multipartBody);

    assertNotNull(multipartBody.getBoundary());

    assertFalse(multipartBody.getBoundary().isEmpty());

    assertEquals(<span class="hljs-string">"multipart/form-data; boundary="</span> + multipartBody.getBoundary(), requestInfo.headers.get(<span class="hljs-string">"Content-Type"</span>).toArray()[<span class="hljs-number">0</span>]);

}
</div></code></pre>
</details>
<details><summary>Reusable Method for MCI (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-comment">// === Declare in class scope ===</span>
<span class="hljs-keyword">private</span> SerializationWriter writerMock;

<span class="hljs-comment">// === Add to @BeforeEach method ===</span>
<span class="hljs-meta">@BeforeEach</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setUp</span><span class="hljs-params">()</span> </span>{
    writerMock = mock(SerializationWriter<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;
}

<span class="hljs-comment">// === Replace local variable in test with ===</span>
writerMock;

</div></code></pre>
</details>
<hr>
<h2 id="mock-clone-instance-kiota-javamci4">Mock Clone Instance #kiota-java_MCI_4</h2>
<ul>
<li><strong>Scope</strong>: method level</li>
<li><strong>Mocked Class</strong>: <code>com.microsoft.kiota.authentication.AuthenticationProvider</code></li>
<li><strong>Test Case Count</strong>: 11</li>
<li><strong>MO Count</strong>: 11</li>
</ul>
<h3 id="reusable-method">Reusable Method</h3>
<pre class="hljs"><code><div><span class="hljs-comment">// === Declare in class scope ===</span>
<span class="hljs-keyword">private</span> AuthenticationProvider authenticationProviderMock;

<span class="hljs-comment">// === Add to @BeforeEach method ===</span>
<span class="hljs-meta">@BeforeEach</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setUp</span><span class="hljs-params">()</span> </span>{
    authenticationProviderMock = mock(AuthenticationProvider<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;
}

<span class="hljs-comment">// === Replace local variable in test with ===</span>
authenticationProviderMock

</div></code></pre>
<h3 id="the-refactoring-details-in-each-test-cases">The refactoring details in each test cases</h3>
<hr>
<h4 id="test-case-id-kiota-javatest41">Test Case ID #kiota-java_Test_4_1</h4>
<h4 id="test-case-name-postrequestsshouldhaveemptybodyfile-cjavaprojectsmicrosoftkiota-javacomponentshttpokhttpsrctestjavacommicrosoftkiotahttpokhttprequestadaptertestjava">Test Case Name: <code>postRequestsShouldHaveEmptyBody</code>(File: <code>C:\Java_projects\Microsoft\kiota-java\components\http\okHttp\src\test\java\com\microsoft\kiota\http\OkHttpRequestAdapterTest.java</code>)</h4>
<h4 id="mock-object-variable-name-authenticationprovidermock">Mock Object Variable Name: <code>authenticationProviderMock</code></h4>
<summary>Suggested Diff</summary>
<pre class="hljs"><code><div>@@
 @ParameterizedTest
 @EnumSource(value = HttpMethod.class, names = { "PUT", "POST", "PATCH" })
 void postRequestsShouldHaveEmptyBody(HttpMethod method) throws Exception {
     // Unexpected exception thrown: java.lang.IllegalArgumentException:
     // method POST must have a request body.
<span class="hljs-deletion">-    final AuthenticationProvider authenticationProviderMock = mock(AuthenticationProvider.class);</span>
<span class="hljs-addition">+    // removed local mock; replaced with global field `authenticationProviderMock`</span>
     final var adapter = new OkHttpRequestAdapter(authenticationProviderMock) {

         public Request test() throws Exception {
             RequestInformation ri = new RequestInformation();
             ri.httpMethod = method;
             ri.urlTemplate = "http://localhost:1234";
             Span span1 = GlobalOpenTelemetry.getTracer("").spanBuilder("").startSpan();
             Span span2 = GlobalOpenTelemetry.getTracer("").spanBuilder("").startSpan();
             return this.getRequestFromRequestInformation(ri, span1, span2);
         }
     };
     final var request = assertDoesNotThrow(() -&gt; adapter.test());
     assertNotNull(request.body());
}
</div></code></pre>
<details><summary>Original Test Code (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-meta">@ParameterizedTest</span>

<span class="hljs-meta">@EnumSource</span>(value = HttpMethod<span class="hljs-class">.<span class="hljs-keyword">class</span>, <span class="hljs-title">names</span> </span>= { <span class="hljs-string">"PUT"</span>, <span class="hljs-string">"POST"</span>, <span class="hljs-string">"PATCH"</span> })

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">postRequestsShouldHaveEmptyBody</span><span class="hljs-params">(HttpMethod method)</span> <span class="hljs-keyword">throws</span> Exception </span>{

    <span class="hljs-comment">// Unexpected exception thrown: java.lang.IllegalArgumentException:</span>

    <span class="hljs-comment">// method POST must have a request body.</span>

    <span class="hljs-keyword">final</span> AuthenticationProvider authenticationProviderMock = mock(AuthenticationProvider<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> adapter = <span class="hljs-keyword">new</span> OkHttpRequestAdapter(authenticationProviderMock) {



        <span class="hljs-function"><span class="hljs-keyword">public</span> Request <span class="hljs-title">test</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>{

            RequestInformation ri = <span class="hljs-keyword">new</span> RequestInformation();

            ri.httpMethod = method;

            ri.urlTemplate = <span class="hljs-string">"http://localhost:1234"</span>;

            Span span1 = GlobalOpenTelemetry.getTracer(<span class="hljs-string">""</span>).spanBuilder(<span class="hljs-string">""</span>).startSpan();

            Span span2 = GlobalOpenTelemetry.getTracer(<span class="hljs-string">""</span>).spanBuilder(<span class="hljs-string">""</span>).startSpan();

            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.getRequestFromRequestInformation(ri, span1, span2);

        }

    };

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> request = assertDoesNotThrow(() -&gt; adapter.test());

    assertNotNull(request.body());

}
</div></code></pre>
</details>
<details><summary>Reusable Method for MCI (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-comment">// === Declare in class scope ===</span>
<span class="hljs-keyword">private</span> AuthenticationProvider authenticationProviderMock;

<span class="hljs-comment">// === Add to @BeforeEach method ===</span>
<span class="hljs-meta">@BeforeEach</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setUp</span><span class="hljs-params">()</span> </span>{
    authenticationProviderMock = mock(AuthenticationProvider<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;
}

<span class="hljs-comment">// === Replace local variable in test with ===</span>
authenticationProviderMock

</div></code></pre>
</details>
<hr>
<h4 id="test-case-id-kiota-javatest42">Test Case ID #kiota-java_Test_4_2</h4>
<h4 id="test-case-name-sendstreamreturnsusablestreamfile-cjavaprojectsmicrosoftkiota-javacomponentshttpokhttpsrctestjavacommicrosoftkiotahttpokhttprequestadaptertestjava">Test Case Name: <code>sendStreamReturnsUsableStream</code>(File: <code>C:\Java_projects\Microsoft\kiota-java\components\http\okHttp\src\test\java\com\microsoft\kiota\http\OkHttpRequestAdapterTest.java</code>)</h4>
<h4 id="mock-object-variable-name-authenticationprovidermock">Mock Object Variable Name: <code>authenticationProviderMock</code></h4>
<summary>Suggested Diff</summary>
<pre class="hljs"><code><div>@@
 @ParameterizedTest
 @ValueSource(ints = { 200, 201, 202, 203, 206 })
 void sendStreamReturnsUsableStream(int statusCode) throws Exception {
<span class="hljs-deletion">-    final var authenticationProviderMock = mock(AuthenticationProvider.class);</span>
<span class="hljs-addition">+    // removed local mock; replaced with global field `authenticationProviderMock`</span>
     authenticationProviderMock.authenticateRequest(any(RequestInformation.class), any(Map.class));
     final var text = "my-demo-text";
     final var bufferedSource = Okio.buffer(Okio.source(new ByteArrayInputStream(text.getBytes("UTF-8"))));
     final var client = getMockClient(new Response.Builder().code(statusCode).message("OK").protocol(Protocol.HTTP_1_1).request(new Request.Builder().url("http://localhost").build()).body(ResponseBody.create(bufferedSource, MediaType.parse("application/binary"), text.getBytes("UTF-8").length)).build());
     final var requestAdapter = new OkHttpRequestAdapter(authenticationProviderMock, null, null, client);
     final var requestInformation = new RequestInformation() {

         {
             setUri(new URI("https://localhost"));
             httpMethod = HttpMethod.GET;
         }
     };
     InputStream response = null;
     try {
         response = requestAdapter.sendPrimitive(requestInformation, null, InputStream.class);
         assertNotNull(response);
         assertEquals(text, new String(response.readAllBytes(), StandardCharsets.UTF_8));
     } finally {
         if (response != null) {
             response.close();
         }
     }
 }
</div></code></pre>
<details><summary>Original Test Code (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-meta">@ParameterizedTest</span>

<span class="hljs-meta">@ValueSource</span>(ints = { <span class="hljs-number">200</span>, <span class="hljs-number">201</span>, <span class="hljs-number">202</span>, <span class="hljs-number">203</span>, <span class="hljs-number">206</span> })

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">sendStreamReturnsUsableStream</span><span class="hljs-params">(<span class="hljs-keyword">int</span> statusCode)</span> <span class="hljs-keyword">throws</span> Exception </span>{

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> authenticationProviderMock = mock(AuthenticationProvider<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    authenticationProviderMock.authenticateRequest(any(RequestInformation<span class="hljs-class">.<span class="hljs-keyword">class</span>), <span class="hljs-title">any</span>(<span class="hljs-title">Map</span>.<span class="hljs-title">class</span>))</span>;

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> text = <span class="hljs-string">"my-demo-text"</span>;

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> bufferedSource = Okio.buffer(Okio.source(<span class="hljs-keyword">new</span> ByteArrayInputStream(text.getBytes(<span class="hljs-string">"UTF-8"</span>))));

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> client = getMockClient(<span class="hljs-keyword">new</span> Response.Builder().code(statusCode).message(<span class="hljs-string">"OK"</span>).protocol(Protocol.HTTP_1_1).request(<span class="hljs-keyword">new</span> Request.Builder().url(<span class="hljs-string">"http://localhost"</span>).build()).body(ResponseBody.create(bufferedSource, MediaType.parse(<span class="hljs-string">"application/binary"</span>), text.getBytes(<span class="hljs-string">"UTF-8"</span>).length)).build());

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> requestAdapter = <span class="hljs-keyword">new</span> OkHttpRequestAdapter(authenticationProviderMock, <span class="hljs-keyword">null</span>, <span class="hljs-keyword">null</span>, client);

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> requestInformation = <span class="hljs-keyword">new</span> RequestInformation() {



        {

            setUri(<span class="hljs-keyword">new</span> URI(<span class="hljs-string">"https://localhost"</span>));

            httpMethod = HttpMethod.GET;

        }

    };

    InputStream response = <span class="hljs-keyword">null</span>;

    <span class="hljs-keyword">try</span> {

        response = requestAdapter.sendPrimitive(requestInformation, <span class="hljs-keyword">null</span>, InputStream<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

        assertNotNull(response);

        assertEquals(text, <span class="hljs-keyword">new</span> String(response.readAllBytes(), StandardCharsets.UTF_8));

    } <span class="hljs-keyword">finally</span> {

        <span class="hljs-keyword">if</span> (response != <span class="hljs-keyword">null</span>) {

            response.close();

        }

    }

}
</div></code></pre>
</details>
<details><summary>Reusable Method for MCI (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-comment">// === Declare in class scope ===</span>
<span class="hljs-keyword">private</span> AuthenticationProvider authenticationProviderMock;

<span class="hljs-comment">// === Add to @BeforeEach method ===</span>
<span class="hljs-meta">@BeforeEach</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setUp</span><span class="hljs-params">()</span> </span>{
    authenticationProviderMock = mock(AuthenticationProvider<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;
}

<span class="hljs-comment">// === Replace local variable in test with ===</span>
authenticationProviderMock

</div></code></pre>
</details>
<hr>
<h4 id="test-case-id-kiota-javatest43">Test Case ID #kiota-java_Test_4_3</h4>
<h4 id="test-case-name-sendstreamreturnsnullonnocontentfile-cjavaprojectsmicrosoftkiota-javacomponentshttpokhttpsrctestjavacommicrosoftkiotahttpokhttprequestadaptertestjava">Test Case Name: <code>sendStreamReturnsNullOnNoContent</code>(File: <code>C:\Java_projects\Microsoft\kiota-java\components\http\okHttp\src\test\java\com\microsoft\kiota\http\OkHttpRequestAdapterTest.java</code>)</h4>
<h4 id="mock-object-variable-name-authenticationprovidermock">Mock Object Variable Name: <code>authenticationProviderMock</code></h4>
<summary>Suggested Diff</summary>
<pre class="hljs"><code><div>@@
 @ParameterizedTest
 @ValueSource(ints = { 200, 201, 202, 203, 204 })
 void sendStreamReturnsNullOnNoContent(int statusCode) throws Exception {
<span class="hljs-deletion">-    final var authenticationProviderMock = mock(AuthenticationProvider.class);</span>
<span class="hljs-addition">+    // removed local mock; replaced with global field `authenticationProviderMock`</span>
     authenticationProviderMock.authenticateRequest(any(RequestInformation.class), any(Map.class));
     final var client = getMockClient(new Response.Builder().code(statusCode).message("OK").protocol(Protocol.HTTP_1_1).request(new Request.Builder().url("http://localhost").build()).body(null).build());
     final var requestAdapter = new OkHttpRequestAdapter(authenticationProviderMock, null, null, client);
     final var requestInformation = new RequestInformation() {

         {
             setUri(new URI("https://localhost"));
             httpMethod = HttpMethod.GET;
         }
     };
     final var response = requestAdapter.sendPrimitive(requestInformation, null, InputStream.class);
     assertNull(response);
}
</div></code></pre>
<details><summary>Original Test Code (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-meta">@ParameterizedTest</span>

<span class="hljs-meta">@ValueSource</span>(ints = { <span class="hljs-number">200</span>, <span class="hljs-number">201</span>, <span class="hljs-number">202</span>, <span class="hljs-number">203</span>, <span class="hljs-number">204</span> })

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">sendStreamReturnsNullOnNoContent</span><span class="hljs-params">(<span class="hljs-keyword">int</span> statusCode)</span> <span class="hljs-keyword">throws</span> Exception </span>{

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> authenticationProviderMock = mock(AuthenticationProvider<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    authenticationProviderMock.authenticateRequest(any(RequestInformation<span class="hljs-class">.<span class="hljs-keyword">class</span>), <span class="hljs-title">any</span>(<span class="hljs-title">Map</span>.<span class="hljs-title">class</span>))</span>;

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> client = getMockClient(<span class="hljs-keyword">new</span> Response.Builder().code(statusCode).message(<span class="hljs-string">"OK"</span>).protocol(Protocol.HTTP_1_1).request(<span class="hljs-keyword">new</span> Request.Builder().url(<span class="hljs-string">"http://localhost"</span>).build()).body(<span class="hljs-keyword">null</span>).build());

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> requestAdapter = <span class="hljs-keyword">new</span> OkHttpRequestAdapter(authenticationProviderMock, <span class="hljs-keyword">null</span>, <span class="hljs-keyword">null</span>, client);

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> requestInformation = <span class="hljs-keyword">new</span> RequestInformation() {



        {

            setUri(<span class="hljs-keyword">new</span> URI(<span class="hljs-string">"https://localhost"</span>));

            httpMethod = HttpMethod.GET;

        }

    };

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> response = requestAdapter.sendPrimitive(requestInformation, <span class="hljs-keyword">null</span>, InputStream<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    assertNull(response);

}
</div></code></pre>
</details>
<details><summary>Reusable Method for MCI (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-comment">// === Declare in class scope ===</span>
<span class="hljs-keyword">private</span> AuthenticationProvider authenticationProviderMock;

<span class="hljs-comment">// === Add to @BeforeEach method ===</span>
<span class="hljs-meta">@BeforeEach</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setUp</span><span class="hljs-params">()</span> </span>{
    authenticationProviderMock = mock(AuthenticationProvider<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;
}

<span class="hljs-comment">// === Replace local variable in test with ===</span>
authenticationProviderMock

</div></code></pre>
</details>
<hr>
<h4 id="test-case-id-kiota-javatest44">Test Case ID #kiota-java_Test_4_4</h4>
<h4 id="test-case-name-sendreturnsnullonnocontentfile-cjavaprojectsmicrosoftkiota-javacomponentshttpokhttpsrctestjavacommicrosoftkiotahttpokhttprequestadaptertestjava">Test Case Name: <code>sendReturnsNullOnNoContent</code>(File: <code>C:\Java_projects\Microsoft\kiota-java\components\http\okHttp\src\test\java\com\microsoft\kiota\http\OkHttpRequestAdapterTest.java</code>)</h4>
<h4 id="mock-object-variable-name-authenticationprovidermock">Mock Object Variable Name: <code>authenticationProviderMock</code></h4>
<summary>Suggested Diff</summary>
<pre class="hljs"><code><div>@@
 void sendReturnsNullOnNoContent(int statusCode) throws Exception {
<span class="hljs-deletion">-    final var authenticationProviderMock = mock(AuthenticationProvider.class);</span>
<span class="hljs-addition">+    // removed local mock; replaced with global field `authenticationProviderMock`</span>
     authenticationProviderMock.authenticateRequest(any(RequestInformation.class), any(Map.class));
     final var client = getMockClient(new Response.Builder().code(statusCode).message("OK").protocol(Protocol.HTTP_1_1).request(new Request.Builder().url("http://localhost").build()).body(null).build());
     final var requestAdapter = new OkHttpRequestAdapter(authenticationProviderMock, null, null, client);
     final var requestInformation = new RequestInformation() {

         {
             setUri(new URI("https://localhost"));
             httpMethod = HttpMethod.GET;
         }
     };
     final var mockEntity = mock(Parsable.class);
     when(mockEntity.getFieldDeserializers()).thenReturn(new HashMap&lt;&gt;());
     final var response = requestAdapter.send(requestInformation, null, (node) -&gt; mockEntity);
     assertNull(response);
}
</div></code></pre>
<details><summary>Original Test Code (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-meta">@ParameterizedTest</span>

<span class="hljs-meta">@ValueSource</span>(ints = { <span class="hljs-number">200</span>, <span class="hljs-number">201</span>, <span class="hljs-number">202</span>, <span class="hljs-number">203</span>, <span class="hljs-number">204</span>, <span class="hljs-number">205</span> })

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">sendReturnsNullOnNoContent</span><span class="hljs-params">(<span class="hljs-keyword">int</span> statusCode)</span> <span class="hljs-keyword">throws</span> Exception </span>{

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> authenticationProviderMock = mock(AuthenticationProvider<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    authenticationProviderMock.authenticateRequest(any(RequestInformation<span class="hljs-class">.<span class="hljs-keyword">class</span>), <span class="hljs-title">any</span>(<span class="hljs-title">Map</span>.<span class="hljs-title">class</span>))</span>;

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> client = getMockClient(<span class="hljs-keyword">new</span> Response.Builder().code(statusCode).message(<span class="hljs-string">"OK"</span>).protocol(Protocol.HTTP_1_1).request(<span class="hljs-keyword">new</span> Request.Builder().url(<span class="hljs-string">"http://localhost"</span>).build()).body(<span class="hljs-keyword">null</span>).build());

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> requestAdapter = <span class="hljs-keyword">new</span> OkHttpRequestAdapter(authenticationProviderMock, <span class="hljs-keyword">null</span>, <span class="hljs-keyword">null</span>, client);

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> requestInformation = <span class="hljs-keyword">new</span> RequestInformation() {



        {

            setUri(<span class="hljs-keyword">new</span> URI(<span class="hljs-string">"https://localhost"</span>));

            httpMethod = HttpMethod.GET;

        }

    };

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> mockEntity = mock(Parsable<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    when(mockEntity.getFieldDeserializers()).thenReturn(<span class="hljs-keyword">new</span> HashMap&lt;&gt;());

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> response = requestAdapter.send(requestInformation, <span class="hljs-keyword">null</span>, (node) -&gt; mockEntity);

    assertNull(response);

}
</div></code></pre>
</details>
<details><summary>Reusable Method for MCI (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-comment">// === Declare in class scope ===</span>
<span class="hljs-keyword">private</span> AuthenticationProvider authenticationProviderMock;

<span class="hljs-comment">// === Add to @BeforeEach method ===</span>
<span class="hljs-meta">@BeforeEach</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setUp</span><span class="hljs-params">()</span> </span>{
    authenticationProviderMock = mock(AuthenticationProvider<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;
}

<span class="hljs-comment">// === Replace local variable in test with ===</span>
authenticationProviderMock

</div></code></pre>
</details>
<hr>
<h4 id="test-case-id-kiota-javatest45">Test Case ID #kiota-java_Test_4_5</h4>
<h4 id="test-case-name-sendreturnsobjectoncontentfile-cjavaprojectsmicrosoftkiota-javacomponentshttpokhttpsrctestjavacommicrosoftkiotahttpokhttprequestadaptertestjava">Test Case Name: <code>sendReturnsObjectOnContent</code>(File: <code>C:\Java_projects\Microsoft\kiota-java\components\http\okHttp\src\test\java\com\microsoft\kiota\http\OkHttpRequestAdapterTest.java</code>)</h4>
<h4 id="mock-object-variable-name-authenticationprovidermock">Mock Object Variable Name: <code>authenticationProviderMock</code></h4>
<summary>Suggested Diff</summary>
<pre class="hljs"><code><div>@@
 @ParameterizedTest
 @ValueSource(ints = { 200, 201, 202, 203 })
 void sendReturnsObjectOnContent(int statusCode) throws Exception {
<span class="hljs-deletion">-    final var authenticationProviderMock = mock(AuthenticationProvider.class);</span>
<span class="hljs-addition">+    // removed local mock; replaced with global field `authenticationProviderMock`</span>
     authenticationProviderMock.authenticateRequest(any(RequestInformation.class), any(Map.class));
     final var client = getMockClient(new Response.Builder().code(statusCode).message("OK").protocol(Protocol.HTTP_1_1).request(new Request.Builder().url("http://localhost").build()).body(ResponseBody.create("test".getBytes("UTF-8"), MediaType.parse("application/json"))).build());
     final var requestInformation = new RequestInformation() {

         {
             setUri(new URI("https://localhost"));
             httpMethod = HttpMethod.GET;
         }
     };
     final var mockEntity = mock(Parsable.class);
     when(mockEntity.getFieldDeserializers()).thenReturn(new HashMap&lt;&gt;());
     final var mockParseNode = mock(ParseNode.class);
     when(mockParseNode.getObjectValue(any(ParsableFactory.class))).thenReturn(mockEntity);
     final var mockFactory = mock(ParseNodeFactory.class);
     when(mockFactory.getParseNode(any(String.class), any(InputStream.class))).thenReturn(mockParseNode);
     when(mockFactory.getValidContentType()).thenReturn("application/json");
     final var requestAdapter = new OkHttpRequestAdapter(authenticationProviderMock, mockFactory, null, client);
     final var response = requestAdapter.send(requestInformation, null, (node) -&gt; mockEntity);
     assertNotNull(response);
}
</div></code></pre>
<details><summary>Original Test Code (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-meta">@ParameterizedTest</span>

<span class="hljs-meta">@ValueSource</span>(ints = { <span class="hljs-number">200</span>, <span class="hljs-number">201</span>, <span class="hljs-number">202</span>, <span class="hljs-number">203</span> })

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">sendReturnsObjectOnContent</span><span class="hljs-params">(<span class="hljs-keyword">int</span> statusCode)</span> <span class="hljs-keyword">throws</span> Exception </span>{

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> authenticationProviderMock = mock(AuthenticationProvider<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    authenticationProviderMock.authenticateRequest(any(RequestInformation<span class="hljs-class">.<span class="hljs-keyword">class</span>), <span class="hljs-title">any</span>(<span class="hljs-title">Map</span>.<span class="hljs-title">class</span>))</span>;

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> client = getMockClient(<span class="hljs-keyword">new</span> Response.Builder().code(statusCode).message(<span class="hljs-string">"OK"</span>).protocol(Protocol.HTTP_1_1).request(<span class="hljs-keyword">new</span> Request.Builder().url(<span class="hljs-string">"http://localhost"</span>).build()).body(ResponseBody.create(<span class="hljs-string">"test"</span>.getBytes(<span class="hljs-string">"UTF-8"</span>), MediaType.parse(<span class="hljs-string">"application/json"</span>))).build());

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> requestInformation = <span class="hljs-keyword">new</span> RequestInformation() {



        {

            setUri(<span class="hljs-keyword">new</span> URI(<span class="hljs-string">"https://localhost"</span>));

            httpMethod = HttpMethod.GET;

        }

    };

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> mockEntity = mock(Parsable<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    when(mockEntity.getFieldDeserializers()).thenReturn(<span class="hljs-keyword">new</span> HashMap&lt;&gt;());

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> mockParseNode = mock(ParseNode<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    when(mockParseNode.getObjectValue(any(ParsableFactory<span class="hljs-class">.<span class="hljs-keyword">class</span>))).<span class="hljs-title">thenReturn</span>(<span class="hljs-title">mockEntity</span>)</span>;

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> mockFactory = mock(ParseNodeFactory<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    when(mockFactory.getParseNode(any(String<span class="hljs-class">.<span class="hljs-keyword">class</span>), <span class="hljs-title">any</span>(<span class="hljs-title">InputStream</span>.<span class="hljs-title">class</span>))).<span class="hljs-title">thenReturn</span>(<span class="hljs-title">mockParseNode</span>)</span>;

    when(mockFactory.getValidContentType()).thenReturn(<span class="hljs-string">"application/json"</span>);

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> requestAdapter = <span class="hljs-keyword">new</span> OkHttpRequestAdapter(authenticationProviderMock, mockFactory, <span class="hljs-keyword">null</span>, client);

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> response = requestAdapter.send(requestInformation, <span class="hljs-keyword">null</span>, (node) -&gt; mockEntity);

    assertNotNull(response);

}
</div></code></pre>
</details>
<details><summary>Reusable Method for MCI (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-comment">// === Declare in class scope ===</span>
<span class="hljs-keyword">private</span> AuthenticationProvider authenticationProviderMock;

<span class="hljs-comment">// === Add to @BeforeEach method ===</span>
<span class="hljs-meta">@BeforeEach</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setUp</span><span class="hljs-params">()</span> </span>{
    authenticationProviderMock = mock(AuthenticationProvider<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;
}

<span class="hljs-comment">// === Replace local variable in test with ===</span>
authenticationProviderMock

</div></code></pre>
</details>
<hr>
<h4 id="test-case-id-kiota-javatest46">Test Case ID #kiota-java_Test_4_6</h4>
<h4 id="test-case-name-throwsapiexceptionfile-cjavaprojectsmicrosoftkiota-javacomponentshttpokhttpsrctestjavacommicrosoftkiotahttpokhttprequestadaptertestjava">Test Case Name: <code>throwsAPIException</code>(File: <code>C:\Java_projects\Microsoft\kiota-java\components\http\okHttp\src\test\java\com\microsoft\kiota\http\OkHttpRequestAdapterTest.java</code>)</h4>
<h4 id="mock-object-variable-name-authenticationprovidermock">Mock Object Variable Name: <code>authenticationProviderMock</code></h4>
<summary>Suggested Diff</summary>
<pre class="hljs"><code><div>@@
 @SuppressWarnings("unchecked")
 @ParameterizedTest
 @MethodSource("providesErrorMappings")
 void throwsAPIException(int responseStatusCode, List&lt;String&gt; errorMappingCodes, boolean expectDeserializedException) throws Exception {
<span class="hljs-deletion">-    final var authenticationProviderMock = mock(AuthenticationProvider.class);</span>
<span class="hljs-addition">+    // removed local mock; replaced with global field `authenticationProviderMock`</span>
     authenticationProviderMock.authenticateRequest(any(RequestInformation.class), any(Map.class));
     final var client = getMockClient(new Response.Builder().code(responseStatusCode).message("Not Found").protocol(Protocol.HTTP_1_1).request(new Request.Builder().url("http://localhost").build()).body(ResponseBody.create("test".getBytes("UTF-8"), MediaType.parse("application/json")).header("request-id", "request-id-value").build());
     final var requestInformation = new RequestInformation() {

         {
             setUri(new URI("https://localhost"));
             httpMethod = HttpMethod.GET;
         }
     };
     final var mockEntity = mock(Parsable.class);
     when(mockEntity.getFieldDeserializers()).thenReturn(new HashMap&lt;&gt;());
     final var mockParsableFactory = mock(ParsableFactory.class);
     when(mockParsableFactory.create(any(ParseNode.class))).thenReturn(mockEntity);
     final var mockParseNode = mock(ParseNode.class);
     when(mockParseNode.getObjectValue(any(ParsableFactory.class))).thenReturn(mockEntity);
     final var mockFactory = mock(ParseNodeFactory.class);
     when(mockFactory.getParseNode(any(String.class), any(InputStream.class))).thenReturn(mockParseNode);
     when(mockFactory.getValidContentType()).thenReturn("application/json");
<span class="hljs-deletion">-    final var requestAdapter = new OkHttpRequestAdapter(authenticationProviderMock, mockFactory, null, client);</span>
<span class="hljs-addition">+    final var requestAdapter = new OkHttpRequestAdapter(authenticationProviderMock, mockFactory, null, client);</span>
     final var errorMappings = errorMappingCodes == null ? null : new HashMap&lt;String, ParsableFactory&lt;? extends Parsable&gt;&gt;();
     if (errorMappings != null)
         errorMappingCodes.forEach((mapping) -&gt; errorMappings.put(mapping, mockParsableFactory));
     final var exception = assertThrows(ApiException.class, () -&gt; requestAdapter.send(requestInformation, errorMappings, (node) -&gt; mockEntity));
     assertNotNull(exception);
     if (expectDeserializedException)
         verify(mockParseNode, times(1)).getObjectValue(mockParsableFactory);
     assertEquals(responseStatusCode, exception.getResponseStatusCode());
     assertTrue(exception.getResponseHeaders().containsKey("request-id"));
}
</div></code></pre>
<details><summary>Original Test Code (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-meta">@SuppressWarnings</span>(<span class="hljs-string">"unchecked"</span>)

<span class="hljs-meta">@ParameterizedTest</span>

<span class="hljs-meta">@MethodSource</span>(<span class="hljs-string">"providesErrorMappings"</span>)

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">throwsAPIException</span><span class="hljs-params">(<span class="hljs-keyword">int</span> responseStatusCode, List&lt;String&gt; errorMappingCodes, <span class="hljs-keyword">boolean</span> expectDeserializedException)</span> <span class="hljs-keyword">throws</span> Exception </span>{

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> authenticationProviderMock = mock(AuthenticationProvider<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    authenticationProviderMock.authenticateRequest(any(RequestInformation<span class="hljs-class">.<span class="hljs-keyword">class</span>), <span class="hljs-title">any</span>(<span class="hljs-title">Map</span>.<span class="hljs-title">class</span>))</span>;

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> client = getMockClient(<span class="hljs-keyword">new</span> Response.Builder().code(responseStatusCode).message(<span class="hljs-string">"Not Found"</span>).protocol(Protocol.HTTP_1_1).request(<span class="hljs-keyword">new</span> Request.Builder().url(<span class="hljs-string">"http://localhost"</span>).build()).body(ResponseBody.create(<span class="hljs-string">"test"</span>.getBytes(<span class="hljs-string">"UTF-8"</span>), MediaType.parse(<span class="hljs-string">"application/json"</span>))).header(<span class="hljs-string">"request-id"</span>, <span class="hljs-string">"request-id-value"</span>).build());

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> requestInformation = <span class="hljs-keyword">new</span> RequestInformation() {



        {

            setUri(<span class="hljs-keyword">new</span> URI(<span class="hljs-string">"https://localhost"</span>));

            httpMethod = HttpMethod.GET;

        }

    };

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> mockEntity = mock(Parsable<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    when(mockEntity.getFieldDeserializers()).thenReturn(<span class="hljs-keyword">new</span> HashMap&lt;&gt;());

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> mockParsableFactory = mock(ParsableFactory<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    when(mockParsableFactory.create(any(ParseNode<span class="hljs-class">.<span class="hljs-keyword">class</span>))).<span class="hljs-title">thenReturn</span>(<span class="hljs-title">mockEntity</span>)</span>;

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> mockParseNode = mock(ParseNode<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    when(mockParseNode.getObjectValue(any(ParsableFactory<span class="hljs-class">.<span class="hljs-keyword">class</span>))).<span class="hljs-title">thenReturn</span>(<span class="hljs-title">mockEntity</span>)</span>;

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> mockFactory = mock(ParseNodeFactory<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    when(mockFactory.getParseNode(any(String<span class="hljs-class">.<span class="hljs-keyword">class</span>), <span class="hljs-title">any</span>(<span class="hljs-title">InputStream</span>.<span class="hljs-title">class</span>))).<span class="hljs-title">thenReturn</span>(<span class="hljs-title">mockParseNode</span>)</span>;

    when(mockFactory.getValidContentType()).thenReturn(<span class="hljs-string">"application/json"</span>);

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> requestAdapter = <span class="hljs-keyword">new</span> OkHttpRequestAdapter(authenticationProviderMock, mockFactory, <span class="hljs-keyword">null</span>, client);

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> errorMappings = errorMappingCodes == <span class="hljs-keyword">null</span> ? <span class="hljs-keyword">null</span> : <span class="hljs-keyword">new</span> HashMap&lt;String, ParsableFactory&lt;? extends Parsable&gt;&gt;();

    <span class="hljs-keyword">if</span> (errorMappings != <span class="hljs-keyword">null</span>)

        errorMappingCodes.forEach((mapping) -&gt; errorMappings.put(mapping, mockParsableFactory));

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> exception = assertThrows(ApiException<span class="hljs-class">.<span class="hljs-keyword">class</span>, () -&gt; <span class="hljs-title">requestAdapter</span>.<span class="hljs-title">send</span>(<span class="hljs-title">requestInformation</span>, <span class="hljs-title">errorMappings</span>, (<span class="hljs-title">node</span>) -&gt; <span class="hljs-title">mockEntity</span>))</span>;

    assertNotNull(exception);

    <span class="hljs-keyword">if</span> (expectDeserializedException)

        verify(mockParseNode, times(<span class="hljs-number">1</span>)).getObjectValue(mockParsableFactory);

    assertEquals(responseStatusCode, exception.getResponseStatusCode());

    assertTrue(exception.getResponseHeaders().containsKey(<span class="hljs-string">"request-id"</span>));

}
</div></code></pre>
</details>
<details><summary>Reusable Method for MCI (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-comment">// === Declare in class scope ===</span>
<span class="hljs-keyword">private</span> AuthenticationProvider authenticationProviderMock;

<span class="hljs-comment">// === Add to @BeforeEach method ===</span>
<span class="hljs-meta">@BeforeEach</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setUp</span><span class="hljs-params">()</span> </span>{
    authenticationProviderMock = mock(AuthenticationProvider<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;
}

<span class="hljs-comment">// === Replace local variable in test with ===</span>
authenticationProviderMock

</div></code></pre>
</details>
<hr>
<h4 id="test-case-id-kiota-javatest47">Test Case ID #kiota-java_Test_4_7</h4>
<h4 id="test-case-name-getrequestfromrequestinformationhascorrectcontentlengthjsonpayloadfile-cjavaprojectsmicrosoftkiota-javacomponentshttpokhttpsrctestjavacommicrosoftkiotahttpokhttprequestadaptertestjava">Test Case Name: <code>getRequestFromRequestInformationHasCorrectContentLength_JsonPayload</code>(File: <code>C:\Java_projects\Microsoft\kiota-java\components\http\okHttp\src\test\java\com\microsoft\kiota\http\OkHttpRequestAdapterTest.java</code>)</h4>
<h4 id="mock-object-variable-name-authenticationprovidermock">Mock Object Variable Name: <code>authenticationProviderMock</code></h4>
<summary>Suggested Diff</summary>
<pre class="hljs"><code><div>@@
@Test
void getRequestFromRequestInformationHasCorrectContentLength_JsonPayload() throws Exception {
<span class="hljs-deletion">-    final var authenticationProviderMock = mock(AuthenticationProvider.class);</span>
<span class="hljs-addition">+    // removed local mock; replaced with global field `authenticationProviderMock`</span>
    final var requestInformation = new RequestInformation();
    requestInformation.setUri(new URI("https://localhost"));
    ByteArrayInputStream content = new ByteArrayInputStream("{\"name\":\"value\",\"array\":[\"1\",\"2\",\"3\"]}".getBytes(StandardCharsets.UTF_8));
    requestInformation.setStreamContent(content, "application/json");
    requestInformation.httpMethod = HttpMethod.PUT;
    final var contentLength = content.available();
    requestInformation.headers.tryAdd("Content-Length", String.valueOf(contentLength));
<span class="hljs-deletion">-    final var adapter = new OkHttpRequestAdapter(authenticationProviderMock);</span>
<span class="hljs-addition">+    final var adapter = new OkHttpRequestAdapter(authenticationProviderMock);</span>
    final var request = adapter.getRequestFromRequestInformation(requestInformation, mock(Span.class), mock(Span.class));
    assertEquals(String.valueOf(contentLength), request.headers().get("Content-Length"));
    assertEquals("application/json", request.headers().get("Content-Type"));
    assertNotNull(request.body());
    assertEquals(request.body().contentLength(), contentLength);
    assertEquals(request.body().contentType(), MediaType.parse("application/json"));
}
</div></code></pre>
<details><summary>Original Test Code (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-meta">@Test</span>

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">getRequestFromRequestInformationHasCorrectContentLength_JsonPayload</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>{

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> authenticationProviderMock = mock(AuthenticationProvider<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> requestInformation = <span class="hljs-keyword">new</span> RequestInformation();

    requestInformation.setUri(<span class="hljs-keyword">new</span> URI(<span class="hljs-string">"https://localhost"</span>));

    ByteArrayInputStream content = <span class="hljs-keyword">new</span> ByteArrayInputStream(<span class="hljs-string">"{\"name\":\"value\",\"array\":[\"1\",\"2\",\"3\"]}"</span>.getBytes(StandardCharsets.UTF_8));

    requestInformation.setStreamContent(content, <span class="hljs-string">"application/json"</span>);

    requestInformation.httpMethod = HttpMethod.PUT;

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> contentLength = content.available();

    requestInformation.headers.tryAdd(<span class="hljs-string">"Content-Length"</span>, String.valueOf(contentLength));

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> adapter = <span class="hljs-keyword">new</span> OkHttpRequestAdapter(authenticationProviderMock);

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> request = adapter.getRequestFromRequestInformation(requestInformation, mock(Span<span class="hljs-class">.<span class="hljs-keyword">class</span>), <span class="hljs-title">mock</span>(<span class="hljs-title">Span</span>.<span class="hljs-title">class</span>))</span>;

    assertEquals(String.valueOf(contentLength), request.headers().get(<span class="hljs-string">"Content-Length"</span>));

    assertEquals(<span class="hljs-string">"application/json"</span>, request.headers().get(<span class="hljs-string">"Content-Type"</span>));

    assertNotNull(request.body());

    assertEquals(request.body().contentLength(), contentLength);

    assertEquals(request.body().contentType(), MediaType.parse(<span class="hljs-string">"application/json"</span>));

}
</div></code></pre>
</details>
<details><summary>Reusable Method for MCI (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-comment">// === Declare in class scope ===</span>
<span class="hljs-keyword">private</span> AuthenticationProvider authenticationProviderMock;

<span class="hljs-comment">// === Add to @BeforeEach method ===</span>
<span class="hljs-meta">@BeforeEach</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setUp</span><span class="hljs-params">()</span> </span>{
    authenticationProviderMock = mock(AuthenticationProvider<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;
}

<span class="hljs-comment">// === Replace local variable in test with ===</span>
authenticationProviderMock

</div></code></pre>
</details>
<hr>
<h4 id="test-case-id-kiota-javatest48">Test Case ID #kiota-java_Test_4_8</h4>
<h4 id="test-case-name-getrequestfromrequestinformationincludescontentlengthfilepayloadfile-cjavaprojectsmicrosoftkiota-javacomponentshttpokhttpsrctestjavacommicrosoftkiotahttpokhttprequestadaptertestjava">Test Case Name: <code>getRequestFromRequestInformationIncludesContentLength_FilePayload</code>(File: <code>C:\Java_projects\Microsoft\kiota-java\components\http\okHttp\src\test\java\com\microsoft\kiota\http\OkHttpRequestAdapterTest.java</code>)</h4>
<h4 id="mock-object-variable-name-authenticationprovidermock">Mock Object Variable Name: <code>authenticationProviderMock</code></h4>
<summary>Suggested Diff</summary>
<pre class="hljs"><code><div>@@
 @Test
 void getRequestFromRequestInformationIncludesContentLength_FilePayload() throws Exception {
<span class="hljs-deletion">-    final var authenticationProviderMock = mock(AuthenticationProvider.class);</span>
<span class="hljs-addition">+    // removed local mock; replaced with global field `authenticationProviderMock`</span>
     final var testFile = new File("./src/test/resources/helloWorld.txt");
     final var requestInformation = new RequestInformation();
     requestInformation.setUri(new URI("https://localhost"));
     requestInformation.httpMethod = HttpMethod.PUT;
     final var contentLength = testFile.length();
     requestInformation.headers.add("Content-Length", String.valueOf(contentLength));
     try (FileInputStream content = new FileInputStream(testFile)) {
         requestInformation.setStreamContent(content, "application/octet-stream");
<span class="hljs-deletion">-        final var adapter = new OkHttpRequestAdapter(authenticationProviderMock);</span>
<span class="hljs-addition">+        final var adapter = new OkHttpRequestAdapter(authenticationProviderMock);</span>
         final var request = adapter.getRequestFromRequestInformation(requestInformation, mock(Span.class), mock(Span.class));
         assertEquals(String.valueOf(contentLength), request.headers().get("Content-Length"));
         assertEquals("application/octet-stream", request.headers().get("Content-Type"));
         assertNotNull(request.body());
         assertEquals(request.body().contentLength(), contentLength);
         assertEquals(request.body().contentType(), MediaType.parse("application/octet-stream"));
     }
}
</div></code></pre>
<details><summary>Original Test Code (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-meta">@Test</span>

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">getRequestFromRequestInformationIncludesContentLength_FilePayload</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>{

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> authenticationProviderMock = mock(AuthenticationProvider<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> testFile = <span class="hljs-keyword">new</span> File(<span class="hljs-string">"./src/test/resources/helloWorld.txt"</span>);

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> requestInformation = <span class="hljs-keyword">new</span> RequestInformation();

    requestInformation.setUri(<span class="hljs-keyword">new</span> URI(<span class="hljs-string">"https://localhost"</span>));

    requestInformation.httpMethod = HttpMethod.PUT;

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> contentLength = testFile.length();

    requestInformation.headers.add(<span class="hljs-string">"Content-Length"</span>, String.valueOf(contentLength));

    <span class="hljs-keyword">try</span> (FileInputStream content = <span class="hljs-keyword">new</span> FileInputStream(testFile)) {

        requestInformation.setStreamContent(content, <span class="hljs-string">"application/octet-stream"</span>);

        <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> adapter = <span class="hljs-keyword">new</span> OkHttpRequestAdapter(authenticationProviderMock);

        <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> request = adapter.getRequestFromRequestInformation(requestInformation, mock(Span<span class="hljs-class">.<span class="hljs-keyword">class</span>), <span class="hljs-title">mock</span>(<span class="hljs-title">Span</span>.<span class="hljs-title">class</span>))</span>;

        assertEquals(String.valueOf(contentLength), request.headers().get(<span class="hljs-string">"Content-Length"</span>));

        assertEquals(<span class="hljs-string">"application/octet-stream"</span>, request.headers().get(<span class="hljs-string">"Content-Type"</span>));

        assertNotNull(request.body());

        assertEquals(request.body().contentLength(), contentLength);

        assertEquals(request.body().contentType(), MediaType.parse(<span class="hljs-string">"application/octet-stream"</span>));

    }

}
</div></code></pre>
</details>
<details><summary>Reusable Method for MCI (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-comment">// === Declare in class scope ===</span>
<span class="hljs-keyword">private</span> AuthenticationProvider authenticationProviderMock;

<span class="hljs-comment">// === Add to @BeforeEach method ===</span>
<span class="hljs-meta">@BeforeEach</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setUp</span><span class="hljs-params">()</span> </span>{
    authenticationProviderMock = mock(AuthenticationProvider<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;
}

<span class="hljs-comment">// === Replace local variable in test with ===</span>
authenticationProviderMock

</div></code></pre>
</details>
<hr>
<h4 id="test-case-id-kiota-javatest49">Test Case ID #kiota-java_Test_4_9</h4>
<h4 id="test-case-name-getrequestfromrequestinformationwithoutcontentlengthoverrideforstreambodyfile-cjavaprojectsmicrosoftkiota-javacomponentshttpokhttpsrctestjavacommicrosoftkiotahttpokhttprequestadaptertestjava">Test Case Name: <code>getRequestFromRequestInformationWithoutContentLengthOverrideForStreamBody</code>(File: <code>C:\Java_projects\Microsoft\kiota-java\components\http\okHttp\src\test\java\com\microsoft\kiota\http\OkHttpRequestAdapterTest.java</code>)</h4>
<h4 id="mock-object-variable-name-authenticationprovidermock">Mock Object Variable Name: <code>authenticationProviderMock</code></h4>
<summary>Suggested Diff</summary>
<pre class="hljs"><code><div>@@
 @Test
 void getRequestFromRequestInformationWithoutContentLengthOverrideForStreamBody() throws Exception {
<span class="hljs-deletion">-    final var authenticationProviderMock = mock(AuthenticationProvider.class);</span>
<span class="hljs-addition">+    // removed local mock; replaced with global field `authenticationProviderMock`</span>
     final var testFile = new File("./src/test/resources/helloWorld.txt");
     final var requestInformation = new RequestInformation();
     requestInformation.setUri(new URI("https://localhost"));
     requestInformation.httpMethod = HttpMethod.PUT;
     try (FileInputStream content = new FileInputStream(testFile)) {
         requestInformation.setStreamContent(content, "application/octet-stream");
         final var adapter = new OkHttpRequestAdapter(authenticationProviderMock);
         final var request = adapter.getRequestFromRequestInformation(requestInformation, mock(Span.class), mock(Span.class));
         assertEquals("application/octet-stream", request.headers().get("Content-Type"));
         assertNotNull(request.body());
         assertEquals(-1L, request.body().contentLength());
         assertEquals(request.body().contentType(), MediaType.parse("application/octet-stream"));
     }
}
</div></code></pre>
<details><summary>Original Test Code (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-meta">@Test</span>

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">getRequestFromRequestInformationWithoutContentLengthOverrideForStreamBody</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>{

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> authenticationProviderMock = mock(AuthenticationProvider<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> testFile = <span class="hljs-keyword">new</span> File(<span class="hljs-string">"./src/test/resources/helloWorld.txt"</span>);

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> requestInformation = <span class="hljs-keyword">new</span> RequestInformation();

    requestInformation.setUri(<span class="hljs-keyword">new</span> URI(<span class="hljs-string">"https://localhost"</span>));

    requestInformation.httpMethod = HttpMethod.PUT;

    <span class="hljs-keyword">try</span> (FileInputStream content = <span class="hljs-keyword">new</span> FileInputStream(testFile)) {

        requestInformation.setStreamContent(content, <span class="hljs-string">"application/octet-stream"</span>);

        <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> adapter = <span class="hljs-keyword">new</span> OkHttpRequestAdapter(authenticationProviderMock);

        <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> request = adapter.getRequestFromRequestInformation(requestInformation, mock(Span<span class="hljs-class">.<span class="hljs-keyword">class</span>), <span class="hljs-title">mock</span>(<span class="hljs-title">Span</span>.<span class="hljs-title">class</span>))</span>;

        assertEquals(<span class="hljs-string">"application/octet-stream"</span>, request.headers().get(<span class="hljs-string">"Content-Type"</span>));

        assertNotNull(request.body());

        assertEquals(-<span class="hljs-number">1L</span>, request.body().contentLength());

        assertEquals(request.body().contentType(), MediaType.parse(<span class="hljs-string">"application/octet-stream"</span>));

    }

}
</div></code></pre>
</details>
<details><summary>Reusable Method for MCI (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-comment">// === Declare in class scope ===</span>
<span class="hljs-keyword">private</span> AuthenticationProvider authenticationProviderMock;

<span class="hljs-comment">// === Add to @BeforeEach method ===</span>
<span class="hljs-meta">@BeforeEach</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setUp</span><span class="hljs-params">()</span> </span>{
    authenticationProviderMock = mock(AuthenticationProvider<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;
}

<span class="hljs-comment">// === Replace local variable in test with ===</span>
authenticationProviderMock

</div></code></pre>
</details>
<hr>
<h4 id="test-case-id-kiota-javatest410">Test Case ID #kiota-java_Test_4_10</h4>
<h4 id="test-case-name-getrequestfromrequestinformationwithoutcontentlengthoverrideforjsonpayloadfile-cjavaprojectsmicrosoftkiota-javacomponentshttpokhttpsrctestjavacommicrosoftkiotahttpokhttprequestadaptertestjava">Test Case Name: <code>getRequestFromRequestInformationWithoutContentLengthOverrideForJsonPayload</code>(File: <code>C:\Java_projects\Microsoft\kiota-java\components\http\okHttp\src\test\java\com\microsoft\kiota\http\OkHttpRequestAdapterTest.java</code>)</h4>
<h4 id="mock-object-variable-name-authenticationprovidermock">Mock Object Variable Name: <code>authenticationProviderMock</code></h4>
<summary>Suggested Diff</summary>
<pre class="hljs"><code><div>@@
 @Test
 void getRequestFromRequestInformationWithoutContentLengthOverrideForJsonPayload() throws Exception {
<span class="hljs-deletion">-    final var authenticationProviderMock = mock(AuthenticationProvider.class);</span>
<span class="hljs-addition">+    // removed local mock; replaced with global field `authenticationProviderMock`</span>
     final var requestInformation = new RequestInformation();
     requestInformation.setUri(new URI("https://localhost"));
     ByteArrayInputStream content = new ByteArrayInputStream("{\"name\":\"value\",\"array\":[\"1\",\"2\",\"3\"]}".getBytes(StandardCharsets.UTF_8));
     requestInformation.setStreamContent(content, "application/json");
     requestInformation.httpMethod = HttpMethod.PUT;
     final var contentLength = content.available();
<span class="hljs-deletion">-    final var adapter = new OkHttpRequestAdapter(authenticationProviderMock);</span>
<span class="hljs-addition">+    final var adapter = new OkHttpRequestAdapter(authenticationProviderMock);</span>
     final var request = adapter.getRequestFromRequestInformation(requestInformation, mock(Span.class), mock(Span.class));
     assertEquals("application/json", request.headers().get("Content-Type"));
     assertNotNull(request.body());
     assertEquals(contentLength, request.body().contentLength());
     assertEquals(MediaType.parse("application/json"), request.body().contentType());
}
</div></code></pre>
<details><summary>Original Test Code (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-meta">@Test</span>

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">getRequestFromRequestInformationWithoutContentLengthOverrideForJsonPayload</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>{

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> authenticationProviderMock = mock(AuthenticationProvider<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> requestInformation = <span class="hljs-keyword">new</span> RequestInformation();

    requestInformation.setUri(<span class="hljs-keyword">new</span> URI(<span class="hljs-string">"https://localhost"</span>));

    ByteArrayInputStream content = <span class="hljs-keyword">new</span> ByteArrayInputStream(<span class="hljs-string">"{\"name\":\"value\",\"array\":[\"1\",\"2\",\"3\"]}"</span>.getBytes(StandardCharsets.UTF_8));

    requestInformation.setStreamContent(content, <span class="hljs-string">"application/json"</span>);

    requestInformation.httpMethod = HttpMethod.PUT;

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> contentLength = content.available();

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> adapter = <span class="hljs-keyword">new</span> OkHttpRequestAdapter(authenticationProviderMock);

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> request = adapter.getRequestFromRequestInformation(requestInformation, mock(Span<span class="hljs-class">.<span class="hljs-keyword">class</span>), <span class="hljs-title">mock</span>(<span class="hljs-title">Span</span>.<span class="hljs-title">class</span>))</span>;

    assertEquals(<span class="hljs-string">"application/json"</span>, request.headers().get(<span class="hljs-string">"Content-Type"</span>));

    assertNotNull(request.body());

    assertEquals(contentLength, request.body().contentLength());

    assertEquals(MediaType.parse(<span class="hljs-string">"application/json"</span>), request.body().contentType());

}
</div></code></pre>
</details>
<details><summary>Reusable Method for MCI (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-comment">// === Declare in class scope ===</span>
<span class="hljs-keyword">private</span> AuthenticationProvider authenticationProviderMock;

<span class="hljs-comment">// === Add to @BeforeEach method ===</span>
<span class="hljs-meta">@BeforeEach</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setUp</span><span class="hljs-params">()</span> </span>{
    authenticationProviderMock = mock(AuthenticationProvider<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;
}

<span class="hljs-comment">// === Replace local variable in test with ===</span>
authenticationProviderMock

</div></code></pre>
</details>
<hr>
<h4 id="test-case-id-kiota-javatest411">Test Case ID #kiota-java_Test_4_11</h4>
<h4 id="test-case-name-getrequestfromrequestinformationwithoutcontentlengthoverridewithemptypayloadfile-cjavaprojectsmicrosoftkiota-javacomponentshttpokhttpsrctestjavacommicrosoftkiotahttpokhttprequestadaptertestjava">Test Case Name: <code>getRequestFromRequestInformationWithoutContentLengthOverrideWithEmptyPayload</code>(File: <code>C:\Java_projects\Microsoft\kiota-java\components\http\okHttp\src\test\java\com\microsoft\kiota\http\OkHttpRequestAdapterTest.java</code>)</h4>
<h4 id="mock-object-variable-name-authenticationprovidermock">Mock Object Variable Name: <code>authenticationProviderMock</code></h4>
<summary>Suggested Diff</summary>
<pre class="hljs"><code><div>@@
@Test
void getRequestFromRequestInformationWithoutContentLengthOverrideWithEmptyPayload() throws Exception {
<span class="hljs-deletion">-    final var authenticationProviderMock = mock(AuthenticationProvider.class);</span>
<span class="hljs-addition">+    // removed local mock; replaced with global field `authenticationProviderMock`</span>
    final var requestInformation = new RequestInformation();
    requestInformation.setUri(new URI("https://localhost"));
    ByteArrayInputStream content = new ByteArrayInputStream(new byte[0]);
    requestInformation.httpMethod = HttpMethod.PUT;
    requestInformation.content = content;
<span class="hljs-deletion">-    final var adapter = new OkHttpRequestAdapter(authenticationProviderMock);</span>
<span class="hljs-addition">+    final var adapter = new OkHttpRequestAdapter(authenticationProviderMock);</span>
    final var request = adapter.getRequestFromRequestInformation(requestInformation, mock(Span.class), mock(Span.class));
    assertNull(request.headers().get("Content-Type"));
    assertEquals(0, request.body().contentLength());
}
</div></code></pre>
<details><summary>Original Test Code (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-meta">@Test</span>

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">getRequestFromRequestInformationWithoutContentLengthOverrideWithEmptyPayload</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>{

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> authenticationProviderMock = mock(AuthenticationProvider<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> requestInformation = <span class="hljs-keyword">new</span> RequestInformation();

    requestInformation.setUri(<span class="hljs-keyword">new</span> URI(<span class="hljs-string">"https://localhost"</span>));

    ByteArrayInputStream content = <span class="hljs-keyword">new</span> ByteArrayInputStream(<span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[<span class="hljs-number">0</span>]);

    requestInformation.httpMethod = HttpMethod.PUT;

    requestInformation.content = content;

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> adapter = <span class="hljs-keyword">new</span> OkHttpRequestAdapter(authenticationProviderMock);

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> request = adapter.getRequestFromRequestInformation(requestInformation, mock(Span<span class="hljs-class">.<span class="hljs-keyword">class</span>), <span class="hljs-title">mock</span>(<span class="hljs-title">Span</span>.<span class="hljs-title">class</span>))</span>;

    assertNull(request.headers().get(<span class="hljs-string">"Content-Type"</span>));

    assertEquals(<span class="hljs-number">0</span>, request.body().contentLength());

}
</div></code></pre>
</details>
<details><summary>Reusable Method for MCI (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-comment">// === Declare in class scope ===</span>
<span class="hljs-keyword">private</span> AuthenticationProvider authenticationProviderMock;

<span class="hljs-comment">// === Add to @BeforeEach method ===</span>
<span class="hljs-meta">@BeforeEach</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setUp</span><span class="hljs-params">()</span> </span>{
    authenticationProviderMock = mock(AuthenticationProvider<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;
}

<span class="hljs-comment">// === Replace local variable in test with ===</span>
authenticationProviderMock

</div></code></pre>
</details>
<hr>
<h2 id="mock-clone-instance-kiota-javamci5">Mock Clone Instance #kiota-java_MCI_5</h2>
<ul>
<li><strong>Scope</strong>: method level</li>
<li><strong>Mocked Class</strong>: <code>com.microsoft.kiota.serialization.Parsable</code></li>
<li><strong>Test Case Count</strong>: 3</li>
<li><strong>MO Count</strong>: 3</li>
</ul>
<h3 id="reusable-method">Reusable Method</h3>
<pre class="hljs"><code><div><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Parsable <span class="hljs-title">createMockParsable</span><span class="hljs-params">()</span> </span>{
    Parsable mockParsable = mock(Parsable<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;
    when(mockParsable.getFieldDeserializers()).thenReturn(<span class="hljs-keyword">new</span> HashMap&lt;&gt;());
    <span class="hljs-keyword">return</span> mockParsable;
}
</div></code></pre>
<h3 id="the-refactoring-details-in-each-test-cases">The refactoring details in each test cases</h3>
<hr>
<h4 id="test-case-id-kiota-javatest51">Test Case ID #kiota-java_Test_5_1</h4>
<h4 id="test-case-name-sendreturnsnullonnocontentfile-cjavaprojectsmicrosoftkiota-javacomponentshttpokhttpsrctestjavacommicrosoftkiotahttpokhttprequestadaptertestjava">Test Case Name: <code>sendReturnsNullOnNoContent</code>(File: <code>C:\Java_projects\Microsoft\kiota-java\components\http\okHttp\src\test\java\com\microsoft\kiota\http\OkHttpRequestAdapterTest.java</code>)</h4>
<h4 id="mock-object-variable-name-mockentity">Mock Object Variable Name: <code>mockEntity</code></h4>
<summary>Suggested Diff</summary>
<pre class="hljs"><code><div><span class="hljs-comment">--- original</span>
<span class="hljs-comment">+++ refactored</span>
@@
        }
    };
<span class="hljs-deletion">-    final var mockEntity = mock(Parsable.class);</span>
<span class="hljs-deletion">-    when(mockEntity.getFieldDeserializers()).thenReturn(new HashMap&lt;&gt;());</span>
<span class="hljs-addition">+    final var mockEntity = createMockParsable();</span>
    final var response = requestAdapter.send(requestInformation, null, (node) -&gt; mockEntity);
    assertNull(response);
}
</div></code></pre>
<details><summary>Original Test Code (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-meta">@ParameterizedTest</span>

<span class="hljs-meta">@ValueSource</span>(ints = { <span class="hljs-number">200</span>, <span class="hljs-number">201</span>, <span class="hljs-number">202</span>, <span class="hljs-number">203</span>, <span class="hljs-number">204</span>, <span class="hljs-number">205</span> })

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">sendReturnsNullOnNoContent</span><span class="hljs-params">(<span class="hljs-keyword">int</span> statusCode)</span> <span class="hljs-keyword">throws</span> Exception </span>{

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> authenticationProviderMock = mock(AuthenticationProvider<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    authenticationProviderMock.authenticateRequest(any(RequestInformation<span class="hljs-class">.<span class="hljs-keyword">class</span>), <span class="hljs-title">any</span>(<span class="hljs-title">Map</span>.<span class="hljs-title">class</span>))</span>;

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> client = getMockClient(<span class="hljs-keyword">new</span> Response.Builder().code(statusCode).message(<span class="hljs-string">"OK"</span>).protocol(Protocol.HTTP_1_1).request(<span class="hljs-keyword">new</span> Request.Builder().url(<span class="hljs-string">"http://localhost"</span>).build()).body(<span class="hljs-keyword">null</span>).build());

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> requestAdapter = <span class="hljs-keyword">new</span> OkHttpRequestAdapter(authenticationProviderMock, <span class="hljs-keyword">null</span>, <span class="hljs-keyword">null</span>, client);

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> requestInformation = <span class="hljs-keyword">new</span> RequestInformation() {



        {

            setUri(<span class="hljs-keyword">new</span> URI(<span class="hljs-string">"https://localhost"</span>));

            httpMethod = HttpMethod.GET;

        }

    };

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> mockEntity = mock(Parsable<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    when(mockEntity.getFieldDeserializers()).thenReturn(<span class="hljs-keyword">new</span> HashMap&lt;&gt;());

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> response = requestAdapter.send(requestInformation, <span class="hljs-keyword">null</span>, (node) -&gt; mockEntity);

    assertNull(response);

}
</div></code></pre>
</details>
<details><summary>Reusable Method for MCI (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Parsable <span class="hljs-title">createMockParsable</span><span class="hljs-params">()</span> </span>{
    Parsable mockParsable = mock(Parsable<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;
    when(mockParsable.getFieldDeserializers()).thenReturn(<span class="hljs-keyword">new</span> HashMap&lt;&gt;());
    <span class="hljs-keyword">return</span> mockParsable;
}
</div></code></pre>
</details>
<hr>
<h4 id="test-case-id-kiota-javatest52">Test Case ID #kiota-java_Test_5_2</h4>
<h4 id="test-case-name-sendreturnsobjectoncontentfile-cjavaprojectsmicrosoftkiota-javacomponentshttpokhttpsrctestjavacommicrosoftkiotahttpokhttprequestadaptertestjava">Test Case Name: <code>sendReturnsObjectOnContent</code>(File: <code>C:\Java_projects\Microsoft\kiota-java\components\http\okHttp\src\test\java\com\microsoft\kiota\http\OkHttpRequestAdapterTest.java</code>)</h4>
<h4 id="mock-object-variable-name-mockentity">Mock Object Variable Name: <code>mockEntity</code></h4>
<summary>Suggested Diff</summary>
<pre class="hljs"><code><div><span class="hljs-comment">--- original</span>
<span class="hljs-comment">+++ refactored</span>
@@
    final var requestInformation = new RequestInformation() {
        {
            setUri(new URI("https://localhost"));
            httpMethod = HttpMethod.GET;
        }
    };
<span class="hljs-deletion">-    final var mockEntity = mock(Parsable.class);</span>
<span class="hljs-deletion">-    when(mockEntity.getFieldDeserializers()).thenReturn(new HashMap&lt;&gt;());</span>
<span class="hljs-addition">+    final var mockEntity = createMockParsable();</span>
    final var mockParseNode = mock(ParseNode.class);
    when(mockParseNode.getObjectValue(any(ParsableFactory.class))).thenReturn(mockEntity);
    final var mockFactory = mock(ParseNodeFactory.class);
    when(mockFactory.getParseNode(any(String.class), any(InputStream.class))).thenReturn(mockParseNode);
    when(mockFactory.getValidContentType()).thenReturn("application/json");
    final var requestAdapter = new OkHttpRequestAdapter(authenticationProviderMock, mockFactory, null, client);
    final var response = requestAdapter.send(requestInformation, null, (node) -&gt; mockEntity);
    assertNotNull(response);
}
</div></code></pre>
<details><summary>Original Test Code (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-meta">@ParameterizedTest</span>

<span class="hljs-meta">@ValueSource</span>(ints = { <span class="hljs-number">200</span>, <span class="hljs-number">201</span>, <span class="hljs-number">202</span>, <span class="hljs-number">203</span> })

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">sendReturnsObjectOnContent</span><span class="hljs-params">(<span class="hljs-keyword">int</span> statusCode)</span> <span class="hljs-keyword">throws</span> Exception </span>{

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> authenticationProviderMock = mock(AuthenticationProvider<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    authenticationProviderMock.authenticateRequest(any(RequestInformation<span class="hljs-class">.<span class="hljs-keyword">class</span>), <span class="hljs-title">any</span>(<span class="hljs-title">Map</span>.<span class="hljs-title">class</span>))</span>;

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> client = getMockClient(<span class="hljs-keyword">new</span> Response.Builder().code(statusCode).message(<span class="hljs-string">"OK"</span>).protocol(Protocol.HTTP_1_1).request(<span class="hljs-keyword">new</span> Request.Builder().url(<span class="hljs-string">"http://localhost"</span>).build()).body(ResponseBody.create(<span class="hljs-string">"test"</span>.getBytes(<span class="hljs-string">"UTF-8"</span>), MediaType.parse(<span class="hljs-string">"application/json"</span>))).build());

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> requestInformation = <span class="hljs-keyword">new</span> RequestInformation() {



        {

            setUri(<span class="hljs-keyword">new</span> URI(<span class="hljs-string">"https://localhost"</span>));

            httpMethod = HttpMethod.GET;

        }

    };

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> mockEntity = mock(Parsable<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    when(mockEntity.getFieldDeserializers()).thenReturn(<span class="hljs-keyword">new</span> HashMap&lt;&gt;());

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> mockParseNode = mock(ParseNode<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    when(mockParseNode.getObjectValue(any(ParsableFactory<span class="hljs-class">.<span class="hljs-keyword">class</span>))).<span class="hljs-title">thenReturn</span>(<span class="hljs-title">mockEntity</span>)</span>;

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> mockFactory = mock(ParseNodeFactory<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    when(mockFactory.getParseNode(any(String<span class="hljs-class">.<span class="hljs-keyword">class</span>), <span class="hljs-title">any</span>(<span class="hljs-title">InputStream</span>.<span class="hljs-title">class</span>))).<span class="hljs-title">thenReturn</span>(<span class="hljs-title">mockParseNode</span>)</span>;

    when(mockFactory.getValidContentType()).thenReturn(<span class="hljs-string">"application/json"</span>);

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> requestAdapter = <span class="hljs-keyword">new</span> OkHttpRequestAdapter(authenticationProviderMock, mockFactory, <span class="hljs-keyword">null</span>, client);

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> response = requestAdapter.send(requestInformation, <span class="hljs-keyword">null</span>, (node) -&gt; mockEntity);

    assertNotNull(response);

}
</div></code></pre>
</details>
<details><summary>Reusable Method for MCI (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Parsable <span class="hljs-title">createMockParsable</span><span class="hljs-params">()</span> </span>{
    Parsable mockParsable = mock(Parsable<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;
    when(mockParsable.getFieldDeserializers()).thenReturn(<span class="hljs-keyword">new</span> HashMap&lt;&gt;());
    <span class="hljs-keyword">return</span> mockParsable;
}
</div></code></pre>
</details>
<hr>
<h4 id="test-case-id-kiota-javatest53">Test Case ID #kiota-java_Test_5_3</h4>
<h4 id="test-case-name-throwsapiexceptionfile-cjavaprojectsmicrosoftkiota-javacomponentshttpokhttpsrctestjavacommicrosoftkiotahttpokhttprequestadaptertestjava">Test Case Name: <code>throwsAPIException</code>(File: <code>C:\Java_projects\Microsoft\kiota-java\components\http\okHttp\src\test\java\com\microsoft\kiota\http\OkHttpRequestAdapterTest.java</code>)</h4>
<h4 id="mock-object-variable-name-mockentity">Mock Object Variable Name: <code>mockEntity</code></h4>
<summary>Suggested Diff</summary>
<pre class="hljs"><code><div><span class="hljs-comment">--- original</span>
<span class="hljs-comment">+++ refactored</span>
@@
    final var requestInformation = new RequestInformation() {
        {
            setUri(new URI("https://localhost"));
            httpMethod = HttpMethod.GET;
        }
    };
<span class="hljs-deletion">-    final var mockEntity = mock(Parsable.class);</span>
<span class="hljs-deletion">-    when(mockEntity.getFieldDeserializers()).thenReturn(new HashMap&lt;&gt;());</span>
<span class="hljs-addition">+    final var mockEntity = createMockParsable();</span>
    final var mockParsableFactory = mock(ParsableFactory.class);
    when(mockParsableFactory.create(any(ParseNode.class))).thenReturn(mockEntity);
@@
</div></code></pre>
<details><summary>Original Test Code (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-meta">@SuppressWarnings</span>(<span class="hljs-string">"unchecked"</span>)

<span class="hljs-meta">@ParameterizedTest</span>

<span class="hljs-meta">@MethodSource</span>(<span class="hljs-string">"providesErrorMappings"</span>)

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">throwsAPIException</span><span class="hljs-params">(<span class="hljs-keyword">int</span> responseStatusCode, List&lt;String&gt; errorMappingCodes, <span class="hljs-keyword">boolean</span> expectDeserializedException)</span> <span class="hljs-keyword">throws</span> Exception </span>{

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> authenticationProviderMock = mock(AuthenticationProvider<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    authenticationProviderMock.authenticateRequest(any(RequestInformation<span class="hljs-class">.<span class="hljs-keyword">class</span>), <span class="hljs-title">any</span>(<span class="hljs-title">Map</span>.<span class="hljs-title">class</span>))</span>;

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> client = getMockClient(<span class="hljs-keyword">new</span> Response.Builder().code(responseStatusCode).message(<span class="hljs-string">"Not Found"</span>).protocol(Protocol.HTTP_1_1).request(<span class="hljs-keyword">new</span> Request.Builder().url(<span class="hljs-string">"http://localhost"</span>).build()).body(ResponseBody.create(<span class="hljs-string">"test"</span>.getBytes(<span class="hljs-string">"UTF-8"</span>), MediaType.parse(<span class="hljs-string">"application/json"</span>))).header(<span class="hljs-string">"request-id"</span>, <span class="hljs-string">"request-id-value"</span>).build());

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> requestInformation = <span class="hljs-keyword">new</span> RequestInformation() {



        {

            setUri(<span class="hljs-keyword">new</span> URI(<span class="hljs-string">"https://localhost"</span>));

            httpMethod = HttpMethod.GET;

        }

    };

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> mockEntity = mock(Parsable<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    when(mockEntity.getFieldDeserializers()).thenReturn(<span class="hljs-keyword">new</span> HashMap&lt;&gt;());

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> mockParsableFactory = mock(ParsableFactory<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    when(mockParsableFactory.create(any(ParseNode<span class="hljs-class">.<span class="hljs-keyword">class</span>))).<span class="hljs-title">thenReturn</span>(<span class="hljs-title">mockEntity</span>)</span>;

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> mockParseNode = mock(ParseNode<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    when(mockParseNode.getObjectValue(any(ParsableFactory<span class="hljs-class">.<span class="hljs-keyword">class</span>))).<span class="hljs-title">thenReturn</span>(<span class="hljs-title">mockEntity</span>)</span>;

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> mockFactory = mock(ParseNodeFactory<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    when(mockFactory.getParseNode(any(String<span class="hljs-class">.<span class="hljs-keyword">class</span>), <span class="hljs-title">any</span>(<span class="hljs-title">InputStream</span>.<span class="hljs-title">class</span>))).<span class="hljs-title">thenReturn</span>(<span class="hljs-title">mockParseNode</span>)</span>;

    when(mockFactory.getValidContentType()).thenReturn(<span class="hljs-string">"application/json"</span>);

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> requestAdapter = <span class="hljs-keyword">new</span> OkHttpRequestAdapter(authenticationProviderMock, mockFactory, <span class="hljs-keyword">null</span>, client);

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> errorMappings = errorMappingCodes == <span class="hljs-keyword">null</span> ? <span class="hljs-keyword">null</span> : <span class="hljs-keyword">new</span> HashMap&lt;String, ParsableFactory&lt;? extends Parsable&gt;&gt;();

    <span class="hljs-keyword">if</span> (errorMappings != <span class="hljs-keyword">null</span>)

        errorMappingCodes.forEach((mapping) -&gt; errorMappings.put(mapping, mockParsableFactory));

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> exception = assertThrows(ApiException<span class="hljs-class">.<span class="hljs-keyword">class</span>, () -&gt; <span class="hljs-title">requestAdapter</span>.<span class="hljs-title">send</span>(<span class="hljs-title">requestInformation</span>, <span class="hljs-title">errorMappings</span>, (<span class="hljs-title">node</span>) -&gt; <span class="hljs-title">mockEntity</span>))</span>;

    assertNotNull(exception);

    <span class="hljs-keyword">if</span> (expectDeserializedException)

        verify(mockParseNode, times(<span class="hljs-number">1</span>)).getObjectValue(mockParsableFactory);

    assertEquals(responseStatusCode, exception.getResponseStatusCode());

    assertTrue(exception.getResponseHeaders().containsKey(<span class="hljs-string">"request-id"</span>));

}
</div></code></pre>
</details>
<details><summary>Reusable Method for MCI (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Parsable <span class="hljs-title">createMockParsable</span><span class="hljs-params">()</span> </span>{
    Parsable mockParsable = mock(Parsable<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;
    when(mockParsable.getFieldDeserializers()).thenReturn(<span class="hljs-keyword">new</span> HashMap&lt;&gt;());
    <span class="hljs-keyword">return</span> mockParsable;
}
</div></code></pre>
</details>
<hr>
<h2 id="mock-clone-instance-kiota-javamci6">Mock Clone Instance #kiota-java_MCI_6</h2>
<ul>
<li><strong>Scope</strong>: method level</li>
<li><strong>Mocked Class</strong>: <code>com.microsoft.kiota.serialization.SerializationWriterFactory</code></li>
<li><strong>Test Case Count</strong>: 5</li>
<li><strong>MO Count</strong>: 5</li>
</ul>
<h3 id="reusable-method">Reusable Method</h3>
<pre class="hljs"><code><div><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> SerializationWriterFactory <span class="hljs-title">createMockSerializationWriterFactory</span><span class="hljs-params">(SerializationWriter writerMock)</span> </span>{
    SerializationWriterFactory factoryMock = mock(SerializationWriterFactory<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;
    when(factoryMock.getSerializationWriter(anyString())).thenReturn(writerMock);
    <span class="hljs-keyword">return</span> factoryMock;
}
</div></code></pre>
<h3 id="the-refactoring-details-in-each-test-cases">The refactoring details in each test cases</h3>
<hr>
<h4 id="test-case-id-kiota-javatest61">Test Case ID #kiota-java_Test_6_1</h4>
<h4 id="test-case-name-setsparsablecontentfile-cjavaprojectsmicrosoftkiota-javacomponentsabstractionssrctestjavacommicrosoftkiotarequestinformationtestjava">Test Case Name: <code>SetsParsableContent</code>(File: <code>C:\Java_projects\Microsoft\kiota-java\components\abstractions\src\test\java\com\microsoft\kiota\RequestInformationTest.java</code>)</h4>
<h4 id="mock-object-variable-name-factorymock">Mock Object Variable Name: <code>factoryMock</code></h4>
<summary>Suggested Diff</summary>
<pre class="hljs"><code><div>@@
     final SerializationWriter writerMock = mock(SerializationWriter.class);
<span class="hljs-deletion">-    final SerializationWriterFactory factoryMock = mock(SerializationWriterFactory.class);</span>
<span class="hljs-deletion">-    when(factoryMock.getSerializationWriter(anyString())).thenReturn(writerMock);</span>
<span class="hljs-addition">+    final SerializationWriterFactory factoryMock = createMockSerializationWriterFactory(writerMock);</span>
     final RequestAdapter requestAdapterMock = mock(RequestAdapter.class);
     when(requestAdapterMock.getSerializationWriterFactory()).thenReturn(factoryMock);
     requestInfo.setContentFromParsable(requestAdapterMock, "application/json", new TestEntity());
     verify(writerMock, times(1)).writeObjectValue(any(), any(TestEntity.class));
     verify(writerMock, never()).writeCollectionOfObjectValues(anyString(), any(ArrayList.class));
@@
</div></code></pre>
<details><summary>Original Test Code (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-meta">@Test</span>

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">SetsParsableContent</span><span class="hljs-params">()</span> </span>{

    <span class="hljs-comment">// Arrange as the request builders would</span>

    <span class="hljs-keyword">final</span> RequestInformation requestInfo = <span class="hljs-keyword">new</span> RequestInformation();

    requestInfo.httpMethod = HttpMethod.POST;

    requestInfo.urlTemplate = <span class="hljs-string">"http://localhost/users"</span>;

    <span class="hljs-keyword">final</span> SerializationWriter writerMock = mock(SerializationWriter<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    <span class="hljs-keyword">final</span> SerializationWriterFactory factoryMock = mock(SerializationWriterFactory<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    when(factoryMock.getSerializationWriter(anyString())).thenReturn(writerMock);

    <span class="hljs-keyword">final</span> RequestAdapter requestAdapterMock = mock(RequestAdapter<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    when(requestAdapterMock.getSerializationWriterFactory()).thenReturn(factoryMock);

    requestInfo.setContentFromParsable(requestAdapterMock, <span class="hljs-string">"application/json"</span>, <span class="hljs-keyword">new</span> TestEntity());

    verify(writerMock, times(<span class="hljs-number">1</span>)).writeObjectValue(any(), any(TestEntity<span class="hljs-class">.<span class="hljs-keyword">class</span>))</span>;

    verify(writerMock, never()).writeCollectionOfObjectValues(anyString(), any(ArrayList<span class="hljs-class">.<span class="hljs-keyword">class</span>))</span>;

}
</div></code></pre>
</details>
<details><summary>Reusable Method for MCI (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> SerializationWriterFactory <span class="hljs-title">createMockSerializationWriterFactory</span><span class="hljs-params">(SerializationWriter writerMock)</span> </span>{
    SerializationWriterFactory factoryMock = mock(SerializationWriterFactory<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;
    when(factoryMock.getSerializationWriter(anyString())).thenReturn(writerMock);
    <span class="hljs-keyword">return</span> factoryMock;
}
</div></code></pre>
</details>
<hr>
<h4 id="test-case-id-kiota-javatest62">Test Case ID #kiota-java_Test_6_2</h4>
<h4 id="test-case-name-setsparsablecontentcollectionfile-cjavaprojectsmicrosoftkiota-javacomponentsabstractionssrctestjavacommicrosoftkiotarequestinformationtestjava">Test Case Name: <code>SetsParsableContentCollection</code>(File: <code>C:\Java_projects\Microsoft\kiota-java\components\abstractions\src\test\java\com\microsoft\kiota\RequestInformationTest.java</code>)</h4>
<h4 id="mock-object-variable-name-factorymock">Mock Object Variable Name: <code>factoryMock</code></h4>
<summary>Suggested Diff</summary>
<pre class="hljs"><code><div>@@
     final SerializationWriter writerMock = mock(SerializationWriter.class);
<span class="hljs-deletion">-    final SerializationWriterFactory factoryMock = mock(SerializationWriterFactory.class);</span>
<span class="hljs-deletion">-    when(factoryMock.getSerializationWriter(anyString())).thenReturn(writerMock);</span>
<span class="hljs-addition">+    final SerializationWriterFactory factoryMock = createMockSerializationWriterFactory(writerMock);</span>
     final RequestAdapter requestAdapterMock = mock(RequestAdapter.class);
     when(requestAdapterMock.getSerializationWriterFactory()).thenReturn(factoryMock);
     requestInfo.setContentFromParsable(requestAdapterMock, "application/json", new TestEntity[] { new TestEntity() });
     verify(writerMock, never()).writeObjectValue(any(), any(TestEntity.class));
     verify(writerMock, times(1)).writeCollectionOfObjectValues(any(), any(Iterable.class));
@@
</div></code></pre>
<details><summary>Original Test Code (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-meta">@Test</span>

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">SetsParsableContentCollection</span><span class="hljs-params">()</span> </span>{

    <span class="hljs-comment">// Arrange as the request builders would</span>

    <span class="hljs-keyword">final</span> RequestInformation requestInfo = <span class="hljs-keyword">new</span> RequestInformation();

    requestInfo.httpMethod = HttpMethod.POST;

    requestInfo.urlTemplate = <span class="hljs-string">"http://localhost/users"</span>;

    <span class="hljs-keyword">final</span> SerializationWriter writerMock = mock(SerializationWriter<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    <span class="hljs-keyword">final</span> SerializationWriterFactory factoryMock = mock(SerializationWriterFactory<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    when(factoryMock.getSerializationWriter(anyString())).thenReturn(writerMock);

    <span class="hljs-keyword">final</span> RequestAdapter requestAdapterMock = mock(RequestAdapter<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    when(requestAdapterMock.getSerializationWriterFactory()).thenReturn(factoryMock);

    requestInfo.setContentFromParsable(requestAdapterMock, <span class="hljs-string">"application/json"</span>, <span class="hljs-keyword">new</span> TestEntity[] { <span class="hljs-keyword">new</span> TestEntity() });

    verify(writerMock, never()).writeObjectValue(any(), any(TestEntity<span class="hljs-class">.<span class="hljs-keyword">class</span>))</span>;

    verify(writerMock, times(<span class="hljs-number">1</span>)).writeCollectionOfObjectValues(any(), any(Iterable<span class="hljs-class">.<span class="hljs-keyword">class</span>))</span>;

}
</div></code></pre>
</details>
<details><summary>Reusable Method for MCI (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> SerializationWriterFactory <span class="hljs-title">createMockSerializationWriterFactory</span><span class="hljs-params">(SerializationWriter writerMock)</span> </span>{
    SerializationWriterFactory factoryMock = mock(SerializationWriterFactory<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;
    when(factoryMock.getSerializationWriter(anyString())).thenReturn(writerMock);
    <span class="hljs-keyword">return</span> factoryMock;
}
</div></code></pre>
</details>
<hr>
<h4 id="test-case-id-kiota-javatest63">Test Case ID #kiota-java_Test_6_3</h4>
<h4 id="test-case-name-setsscalarcontentcollectionfile-cjavaprojectsmicrosoftkiota-javacomponentsabstractionssrctestjavacommicrosoftkiotarequestinformationtestjava">Test Case Name: <code>SetsScalarContentCollection</code>(File: <code>C:\Java_projects\Microsoft\kiota-java\components\abstractions\src\test\java\com\microsoft\kiota\RequestInformationTest.java</code>)</h4>
<h4 id="mock-object-variable-name-factorymock">Mock Object Variable Name: <code>factoryMock</code></h4>
<summary>Suggested Diff</summary>
<pre class="hljs"><code><div>@@
     final SerializationWriter writerMock = mock(SerializationWriter.class);
<span class="hljs-deletion">-    final SerializationWriterFactory factoryMock = mock(SerializationWriterFactory.class);</span>
<span class="hljs-deletion">-    when(factoryMock.getSerializationWriter(anyString())).thenReturn(writerMock);</span>
<span class="hljs-addition">+    final SerializationWriterFactory factoryMock = createMockSerializationWriterFactory(writerMock);</span>
     final RequestAdapter requestAdapterMock = mock(RequestAdapter.class);
     when(requestAdapterMock.getSerializationWriterFactory()).thenReturn(factoryMock);
     requestInfo.setContentFromScalarCollection(requestAdapterMock, "application/json", new String[] { "foo" });
     verify(writerMock, never()).writeStringValue(any(), anyString());
     verify(writerMock, times(1)).writeCollectionOfPrimitiveValues(any(), any(Iterable.class));
@@
</div></code></pre>
<details><summary>Original Test Code (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-meta">@Test</span>

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">SetsScalarContentCollection</span><span class="hljs-params">()</span> </span>{

    <span class="hljs-comment">// Arrange as the request builders would</span>

    <span class="hljs-keyword">final</span> RequestInformation requestInfo = <span class="hljs-keyword">new</span> RequestInformation();

    requestInfo.httpMethod = HttpMethod.POST;

    requestInfo.urlTemplate = <span class="hljs-string">"http://localhost/users"</span>;

    <span class="hljs-keyword">final</span> SerializationWriter writerMock = mock(SerializationWriter<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    <span class="hljs-keyword">final</span> SerializationWriterFactory factoryMock = mock(SerializationWriterFactory<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    when(factoryMock.getSerializationWriter(anyString())).thenReturn(writerMock);

    <span class="hljs-keyword">final</span> RequestAdapter requestAdapterMock = mock(RequestAdapter<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    when(requestAdapterMock.getSerializationWriterFactory()).thenReturn(factoryMock);

    requestInfo.setContentFromScalarCollection(requestAdapterMock, <span class="hljs-string">"application/json"</span>, <span class="hljs-keyword">new</span> String[] { <span class="hljs-string">"foo"</span> });

    verify(writerMock, never()).writeStringValue(any(), anyString());

    verify(writerMock, times(<span class="hljs-number">1</span>)).writeCollectionOfPrimitiveValues(any(), any(Iterable<span class="hljs-class">.<span class="hljs-keyword">class</span>))</span>;

}
</div></code></pre>
</details>
<details><summary>Reusable Method for MCI (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> SerializationWriterFactory <span class="hljs-title">createMockSerializationWriterFactory</span><span class="hljs-params">(SerializationWriter writerMock)</span> </span>{
    SerializationWriterFactory factoryMock = mock(SerializationWriterFactory<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;
    when(factoryMock.getSerializationWriter(anyString())).thenReturn(writerMock);
    <span class="hljs-keyword">return</span> factoryMock;
}
</div></code></pre>
</details>
<hr>
<h4 id="test-case-id-kiota-javatest64">Test Case ID #kiota-java_Test_6_4</h4>
<h4 id="test-case-name-setsscalarcontentfile-cjavaprojectsmicrosoftkiota-javacomponentsabstractionssrctestjavacommicrosoftkiotarequestinformationtestjava">Test Case Name: <code>SetsScalarContent</code>(File: <code>C:\Java_projects\Microsoft\kiota-java\components\abstractions\src\test\java\com\microsoft\kiota\RequestInformationTest.java</code>)</h4>
<h4 id="mock-object-variable-name-factorymock">Mock Object Variable Name: <code>factoryMock</code></h4>
<summary>Suggested Diff</summary>
<pre class="hljs"><code><div>@@
     final SerializationWriter writerMock = mock(SerializationWriter.class);
<span class="hljs-deletion">-    final SerializationWriterFactory factoryMock = mock(SerializationWriterFactory.class);</span>
<span class="hljs-deletion">-    when(factoryMock.getSerializationWriter(anyString())).thenReturn(writerMock);</span>
<span class="hljs-addition">+    final SerializationWriterFactory factoryMock = createMockSerializationWriterFactory(writerMock);</span>
     final RequestAdapter requestAdapterMock = mock(RequestAdapter.class);
     when(requestAdapterMock.getSerializationWriterFactory()).thenReturn(factoryMock);
     requestInfo.setContentFromScalar(requestAdapterMock, "application/json", "foo");
     verify(writerMock, times(1)).writeStringValue(any(), anyString());
     verify(writerMock, never()).writeCollectionOfPrimitiveValues(any(), any(Iterable.class));
@@
</div></code></pre>
<details><summary>Original Test Code (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-meta">@Test</span>

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">SetsScalarContent</span><span class="hljs-params">()</span> </span>{

    <span class="hljs-comment">// Arrange as the request builders would</span>

    <span class="hljs-keyword">final</span> RequestInformation requestInfo = <span class="hljs-keyword">new</span> RequestInformation();

    requestInfo.httpMethod = HttpMethod.POST;

    requestInfo.urlTemplate = <span class="hljs-string">"http://localhost/users"</span>;

    <span class="hljs-keyword">final</span> SerializationWriter writerMock = mock(SerializationWriter<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    <span class="hljs-keyword">final</span> SerializationWriterFactory factoryMock = mock(SerializationWriterFactory<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    when(factoryMock.getSerializationWriter(anyString())).thenReturn(writerMock);

    <span class="hljs-keyword">final</span> RequestAdapter requestAdapterMock = mock(RequestAdapter<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    when(requestAdapterMock.getSerializationWriterFactory()).thenReturn(factoryMock);

    requestInfo.setContentFromScalar(requestAdapterMock, <span class="hljs-string">"application/json"</span>, <span class="hljs-string">"foo"</span>);

    verify(writerMock, times(<span class="hljs-number">1</span>)).writeStringValue(any(), anyString());

    verify(writerMock, never()).writeCollectionOfPrimitiveValues(any(), any(Iterable<span class="hljs-class">.<span class="hljs-keyword">class</span>))</span>;

}
</div></code></pre>
</details>
<details><summary>Reusable Method for MCI (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> SerializationWriterFactory <span class="hljs-title">createMockSerializationWriterFactory</span><span class="hljs-params">(SerializationWriter writerMock)</span> </span>{
    SerializationWriterFactory factoryMock = mock(SerializationWriterFactory<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;
    when(factoryMock.getSerializationWriter(anyString())).thenReturn(writerMock);
    <span class="hljs-keyword">return</span> factoryMock;
}
</div></code></pre>
</details>
<hr>
<h4 id="test-case-id-kiota-javatest65">Test Case ID #kiota-java_Test_6_5</h4>
<h4 id="test-case-name-setsboundaryonmultipartbodyfile-cjavaprojectsmicrosoftkiota-javacomponentsabstractionssrctestjavacommicrosoftkiotarequestinformationtestjava">Test Case Name: <code>SetsBoundaryOnMultipartBody</code>(File: <code>C:\Java_projects\Microsoft\kiota-java\components\abstractions\src\test\java\com\microsoft\kiota\RequestInformationTest.java</code>)</h4>
<h4 id="mock-object-variable-name-factorymock">Mock Object Variable Name: <code>factoryMock</code></h4>
<summary>Suggested Diff</summary>
<pre class="hljs"><code><div><span class="hljs-comment">--- original</span>
<span class="hljs-comment">+++ refactored</span>
@@
    final SerializationWriter writerMock = mock(SerializationWriter.class);
<span class="hljs-deletion">-    final SerializationWriterFactory factoryMock = mock(SerializationWriterFactory.class);</span>
<span class="hljs-deletion">-    when(factoryMock.getSerializationWriter(anyString())).thenReturn(writerMock);</span>
<span class="hljs-addition">+    final SerializationWriterFactory factoryMock = createMockSerializationWriterFactory(writerMock);</span>
    final RequestAdapter requestAdapterMock = mock(RequestAdapter.class);
    when(requestAdapterMock.getSerializationWriterFactory()).thenReturn(factoryMock);
    final MultipartBody multipartBody = new MultipartBody();
    multipartBody.requestAdapter = requestAdapterMock;
@@
</div></code></pre>
<details><summary>Original Test Code (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-meta">@Test</span>

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">SetsBoundaryOnMultipartBody</span><span class="hljs-params">()</span> </span>{

    <span class="hljs-keyword">final</span> RequestInformation requestInfo = <span class="hljs-keyword">new</span> RequestInformation();

    requestInfo.httpMethod = HttpMethod.POST;

    requestInfo.urlTemplate = <span class="hljs-string">"http://localhost/{URITemplate}/ParameterMapping?IsCaseSensitive={IsCaseSensitive}"</span>;

    <span class="hljs-keyword">final</span> SerializationWriter writerMock = mock(SerializationWriter<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    <span class="hljs-keyword">final</span> SerializationWriterFactory factoryMock = mock(SerializationWriterFactory<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    when(factoryMock.getSerializationWriter(anyString())).thenReturn(writerMock);

    <span class="hljs-keyword">final</span> RequestAdapter requestAdapterMock = mock(RequestAdapter<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    when(requestAdapterMock.getSerializationWriterFactory()).thenReturn(factoryMock);

    <span class="hljs-keyword">final</span> MultipartBody multipartBody = <span class="hljs-keyword">new</span> MultipartBody();

    multipartBody.requestAdapter = requestAdapterMock;

    requestInfo.setContentFromParsable(requestAdapterMock, <span class="hljs-string">"multipart/form-data"</span>, multipartBody);

    assertNotNull(multipartBody.getBoundary());

    assertFalse(multipartBody.getBoundary().isEmpty());

    assertEquals(<span class="hljs-string">"multipart/form-data; boundary="</span> + multipartBody.getBoundary(), requestInfo.headers.get(<span class="hljs-string">"Content-Type"</span>).toArray()[<span class="hljs-number">0</span>]);

}
</div></code></pre>
</details>
<details><summary>Reusable Method for MCI (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> SerializationWriterFactory <span class="hljs-title">createMockSerializationWriterFactory</span><span class="hljs-params">(SerializationWriter writerMock)</span> </span>{
    SerializationWriterFactory factoryMock = mock(SerializationWriterFactory<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;
    when(factoryMock.getSerializationWriter(anyString())).thenReturn(writerMock);
    <span class="hljs-keyword">return</span> factoryMock;
}
</div></code></pre>
</details>
<hr>
<h2 id="mock-clone-instance-kiota-javamci7">Mock Clone Instance #kiota-java_MCI_7</h2>
<ul>
<li><strong>Scope</strong>: method level</li>
<li><strong>Mocked Class</strong>: <code>com.microsoft.kiota.serialization.SerializationWriterFactory</code></li>
<li><strong>Test Case Count</strong>: 2</li>
<li><strong>MO Count</strong>: 2</li>
</ul>
<h3 id="reusable-method">Reusable Method</h3>
<pre class="hljs"><code><div><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> SerializationWriterFactory <span class="hljs-title">createMockSerializationWriterFactory</span><span class="hljs-params">(String contentType, SerializationWriter mockSerializationWriter)</span> </span>{
    SerializationWriterFactory mockSerializationWriterFactory = mock(SerializationWriterFactory<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;
    when(mockSerializationWriterFactory.getSerializationWriter(contentType)).thenReturn(mockSerializationWriter);
    <span class="hljs-keyword">return</span> mockSerializationWriterFactory;
}
</div></code></pre>
<h3 id="the-refactoring-details-in-each-test-cases">The refactoring details in each test cases</h3>
<hr>
<h4 id="test-case-id-kiota-javatest71">Test Case ID #kiota-java_Test_7_1</h4>
<h4 id="test-case-name-serializesobjectfile-cjavaprojectsmicrosoftkiota-javacomponentsabstractionssrctestjavacommicrosoftkiotaserializationserializationhelperstestjava">Test Case Name: <code>serializesObject</code>(File: <code>C:\Java_projects\Microsoft\kiota-java\components\abstractions\src\test\java\com\microsoft\kiota\serialization\SerializationHelpersTest.java</code>)</h4>
<h4 id="mock-object-variable-name-mockserializationwriterfactory">Mock Object Variable Name: <code>mockSerializationWriterFactory</code></h4>
<summary>Suggested Diff</summary>
<pre class="hljs"><code><div>@@
    final var mockSerializationWriter = mock(SerializationWriter.class);
    when(mockSerializationWriter.getSerializedContent()).thenReturn(new ByteArrayInputStream("{'id':'123'}".getBytes(_charset)));
<span class="hljs-deletion">-    final var mockSerializationWriterFactory = mock(SerializationWriterFactory.class);</span>
<span class="hljs-deletion">-    when(mockSerializationWriterFactory.getSerializationWriter(_jsonContentType)).thenReturn(mockSerializationWriter);</span>
<span class="hljs-addition">+    final var mockSerializationWriterFactory = createMockSerializationWriterFactory(_jsonContentType, mockSerializationWriter);</span>
    SerializationWriterFactoryRegistry.defaultInstance.contentTypeAssociatedFactories.put(_jsonContentType, mockSerializationWriterFactory);
    final var result = KiotaSerialization.serializeAsString(_jsonContentType, new TestEntity() {

        {
            setId("123");
        }
    });
    assertEquals("{'id':'123'}", result);
    verify(mockSerializationWriter, times(1)).writeObjectValue(eq(""), any(Parsable.class));
}
</div></code></pre>
<details><summary>Original Test Code (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-meta">@Test</span>

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">serializesObject</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException </span>{

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> mockSerializationWriter = mock(SerializationWriter<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    when(mockSerializationWriter.getSerializedContent()).thenReturn(<span class="hljs-keyword">new</span> ByteArrayInputStream(<span class="hljs-string">"{'id':'123'}"</span>.getBytes(_charset)));

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> mockSerializationWriterFactory = mock(SerializationWriterFactory<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    when(mockSerializationWriterFactory.getSerializationWriter(_jsonContentType)).thenReturn(mockSerializationWriter);

    SerializationWriterFactoryRegistry.defaultInstance.contentTypeAssociatedFactories.put(_jsonContentType, mockSerializationWriterFactory);

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> result = KiotaSerialization.serializeAsString(_jsonContentType, <span class="hljs-keyword">new</span> TestEntity() {



        {

            setId(<span class="hljs-string">"123"</span>);

        }

    });

    assertEquals(<span class="hljs-string">"{'id':'123'}"</span>, result);

    verify(mockSerializationWriter, times(<span class="hljs-number">1</span>)).writeObjectValue(eq(<span class="hljs-string">""</span>), any(Parsable<span class="hljs-class">.<span class="hljs-keyword">class</span>))</span>;

}
</div></code></pre>
</details>
<details><summary>Reusable Method for MCI (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> SerializationWriterFactory <span class="hljs-title">createMockSerializationWriterFactory</span><span class="hljs-params">(String contentType, SerializationWriter mockSerializationWriter)</span> </span>{
    SerializationWriterFactory mockSerializationWriterFactory = mock(SerializationWriterFactory<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;
    when(mockSerializationWriterFactory.getSerializationWriter(contentType)).thenReturn(mockSerializationWriter);
    <span class="hljs-keyword">return</span> mockSerializationWriterFactory;
}
</div></code></pre>
</details>
<hr>
<h4 id="test-case-id-kiota-javatest72">Test Case ID #kiota-java_Test_7_2</h4>
<h4 id="test-case-name-serializesobjectcollectionfile-cjavaprojectsmicrosoftkiota-javacomponentsabstractionssrctestjavacommicrosoftkiotaserializationserializationhelperstestjava">Test Case Name: <code>serializesObjectCollection</code>(File: <code>C:\Java_projects\Microsoft\kiota-java\components\abstractions\src\test\java\com\microsoft\kiota\serialization\SerializationHelpersTest.java</code>)</h4>
<h4 id="mock-object-variable-name-mockserializationwriterfactory">Mock Object Variable Name: <code>mockSerializationWriterFactory</code></h4>
<summary>Suggested Diff</summary>
<pre class="hljs"><code><div><span class="hljs-comment">--- original</span>
<span class="hljs-comment">+++ refactored</span>
@@
    final var mockSerializationWriter = mock(SerializationWriter.class);
    when(mockSerializationWriter.getSerializedContent()).thenReturn(new ByteArrayInputStream("[{\'id\':\'123\'}]".getBytes(_charset)));
<span class="hljs-deletion">-    final var mockSerializationWriterFactory = mock(SerializationWriterFactory.class);</span>
<span class="hljs-deletion">-    when(mockSerializationWriterFactory.getSerializationWriter(_jsonContentType)).thenReturn(mockSerializationWriter);</span>
<span class="hljs-addition">+    final var mockSerializationWriterFactory = createMockSerializationWriterFactory(_jsonContentType, mockSerializationWriter);</span>
    SerializationWriterFactoryRegistry.defaultInstance.contentTypeAssociatedFactories.put(_jsonContentType, mockSerializationWriterFactory);
    final var result = KiotaSerialization.serializeAsString(_jsonContentType, new ArrayList&lt;&gt;() {
@@
</div></code></pre>
<details><summary>Original Test Code (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-meta">@Test</span>

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">serializesObjectCollection</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException </span>{

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> mockSerializationWriter = mock(SerializationWriter<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    when(mockSerializationWriter.getSerializedContent()).thenReturn(<span class="hljs-keyword">new</span> ByteArrayInputStream(<span class="hljs-string">"[{'id':'123'}]"</span>.getBytes(_charset)));

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> mockSerializationWriterFactory = mock(SerializationWriterFactory<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    when(mockSerializationWriterFactory.getSerializationWriter(_jsonContentType)).thenReturn(mockSerializationWriter);

    SerializationWriterFactoryRegistry.defaultInstance.contentTypeAssociatedFactories.put(_jsonContentType, mockSerializationWriterFactory);

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> result = KiotaSerialization.serializeAsString(_jsonContentType, <span class="hljs-keyword">new</span> ArrayList&lt;&gt;() {



        {

            add(<span class="hljs-keyword">new</span> TestEntity() {



                {

                    setId(<span class="hljs-string">"123"</span>);

                }

            });

        }

    });

    assertEquals(<span class="hljs-string">"[{'id':'123'}]"</span>, result);

    verify(mockSerializationWriter, times(<span class="hljs-number">1</span>)).writeCollectionOfObjectValues(eq(<span class="hljs-string">""</span>), any());

}
</div></code></pre>
</details>
<details><summary>Reusable Method for MCI (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> SerializationWriterFactory <span class="hljs-title">createMockSerializationWriterFactory</span><span class="hljs-params">(String contentType, SerializationWriter mockSerializationWriter)</span> </span>{
    SerializationWriterFactory mockSerializationWriterFactory = mock(SerializationWriterFactory<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;
    when(mockSerializationWriterFactory.getSerializationWriter(contentType)).thenReturn(mockSerializationWriter);
    <span class="hljs-keyword">return</span> mockSerializationWriterFactory;
}
</div></code></pre>
</details>
<hr>
<h2 id="mock-clone-instance-kiota-javamci8">Mock Clone Instance #kiota-java_MCI_8</h2>
<ul>
<li><strong>Scope</strong>: method level</li>
<li><strong>Mocked Class</strong>: <code>com.azure.core.credential.TokenCredential</code></li>
<li><strong>Test Case Count</strong>: 4</li>
<li><strong>MO Count</strong>: 4</li>
</ul>
<h3 id="reusable-method">Reusable Method</h3>
<pre class="hljs"><code><div><span class="hljs-comment">// === Declare in class scope ===</span>
<span class="hljs-keyword">private</span> TokenCredential tokenCredential;

<span class="hljs-comment">// === Add to @BeforeEach method ===</span>
<span class="hljs-meta">@BeforeEach</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setUp</span><span class="hljs-params">()</span> </span>{
    tokenCredential = mock(TokenCredential<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;
}

<span class="hljs-comment">// === Replace local variable in test with ===</span>
tokenCredential;

</div></code></pre>
<h3 id="the-refactoring-details-in-each-test-cases">The refactoring details in each test cases</h3>
<hr>
<h4 id="test-case-id-kiota-javatest81">Test Case ID #kiota-java_Test_8_1</h4>
<h4 id="test-case-name-testnonlocalhosthttpurlisinvalidfile-cjavaprojectsmicrosoftkiota-javacomponentsauthenticationazuresrctestjavacommicrosoftkiotaauthenticationazureidentityaccesstokenprovidertestjava">Test Case Name: <code>testNonLocalhostHttpUrlIsInvalid</code>(File: <code>C:\Java_projects\Microsoft\kiota-java\components\authentication\azure\src\test\java\com\microsoft\kiota\authentication\AzureIdentityAccessTokenProviderTest.java</code>)</h4>
<h4 id="mock-object-variable-name-tokencredential">Mock Object Variable Name: <code>tokenCredential</code></h4>
<summary>Suggested Diff</summary>
<pre class="hljs"><code><div>@@
 @ParameterizedTest
 @ValueSource(strings = { "http://graph.microsoft.com/me" })
 void testNonLocalhostHttpUrlIsInvalid(String urlString) {
<span class="hljs-deletion">-    var tokenCredential = mock(TokenCredential.class);</span>
<span class="hljs-addition">+    // removed local mock; replaced with global field `tokenCredential`</span>
     var accessTokenProvider = new AzureIdentityAccessTokenProvider(tokenCredential, null, "");
     assertThrows(IllegalArgumentException.class, () -&gt; accessTokenProvider.getAuthorizationToken(new URI(urlString), new HashMap&lt;&gt;()));
}
</div></code></pre>
<details><summary>Original Test Code (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-meta">@ParameterizedTest</span>

<span class="hljs-meta">@ValueSource</span>(strings = { <span class="hljs-string">"http://graph.microsoft.com/me"</span> })

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">testNonLocalhostHttpUrlIsInvalid</span><span class="hljs-params">(String urlString)</span> </span>{

    <span class="hljs-keyword">var</span> tokenCredential = mock(TokenCredential<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    <span class="hljs-keyword">var</span> accessTokenProvider = <span class="hljs-keyword">new</span> AzureIdentityAccessTokenProvider(tokenCredential, <span class="hljs-keyword">null</span>, <span class="hljs-string">""</span>);

    assertThrows(IllegalArgumentException<span class="hljs-class">.<span class="hljs-keyword">class</span>, () -&gt; <span class="hljs-title">accessTokenProvider</span>.<span class="hljs-title">getAuthorizationToken</span>(<span class="hljs-title">new</span> <span class="hljs-title">URI</span>(<span class="hljs-title">urlString</span>), <span class="hljs-title">new</span> <span class="hljs-title">HashMap</span>&lt;&gt;()))</span>;

}
</div></code></pre>
</details>
<details><summary>Reusable Method for MCI (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-comment">// === Declare in class scope ===</span>
<span class="hljs-keyword">private</span> TokenCredential tokenCredential;

<span class="hljs-comment">// === Add to @BeforeEach method ===</span>
<span class="hljs-meta">@BeforeEach</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setUp</span><span class="hljs-params">()</span> </span>{
    tokenCredential = mock(TokenCredential<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;
}

<span class="hljs-comment">// === Replace local variable in test with ===</span>
tokenCredential;

</div></code></pre>
</details>
<hr>
<h4 id="test-case-id-kiota-javatest82">Test Case ID #kiota-java_Test_8_2</h4>
<h4 id="test-case-name-testkeepuserprovidedscopesfile-cjavaprojectsmicrosoftkiota-javacomponentsauthenticationazuresrctestjavacommicrosoftkiotaauthenticationazureidentityaccesstokenprovidertestjava">Test Case Name: <code>testKeepUserProvidedScopes</code>(File: <code>C:\Java_projects\Microsoft\kiota-java\components\authentication\azure\src\test\java\com\microsoft\kiota\authentication\AzureIdentityAccessTokenProviderTest.java</code>)</h4>
<h4 id="mock-object-variable-name-tokencredential">Mock Object Variable Name: <code>tokenCredential</code></h4>
<summary>Suggested Diff</summary>
<pre class="hljs"><code><div>@@
 @Test
 void testKeepUserProvidedScopes() throws URISyntaxException {
<span class="hljs-deletion">-    var tokenCredential = mock(TokenCredential.class);</span>
<span class="hljs-addition">+    // removed local mock; replaced with global field `tokenCredential`</span>
     String[] userProvidedScopes = { "https://graph.microsoft.com/User.Read", "https://graph.microsoft.com/Application.Read" };
     var accessTokenProvider = new AzureIdentityAccessTokenProvider(tokenCredential, new String[] {}, userProvidedScopes);
     assertScopes(tokenCredential, accessTokenProvider, userProvidedScopes);
}
</div></code></pre>
<details><summary>Original Test Code (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-meta">@Test</span>

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">testKeepUserProvidedScopes</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> URISyntaxException </span>{

    <span class="hljs-keyword">var</span> tokenCredential = mock(TokenCredential<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    String[] userProvidedScopes = { <span class="hljs-string">"https://graph.microsoft.com/User.Read"</span>, <span class="hljs-string">"https://graph.microsoft.com/Application.Read"</span> };

    <span class="hljs-keyword">var</span> accessTokenProvider = <span class="hljs-keyword">new</span> AzureIdentityAccessTokenProvider(tokenCredential, <span class="hljs-keyword">new</span> String[] {}, userProvidedScopes);

    assertScopes(tokenCredential, accessTokenProvider, userProvidedScopes);

}
</div></code></pre>
</details>
<details><summary>Reusable Method for MCI (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-comment">// === Declare in class scope ===</span>
<span class="hljs-keyword">private</span> TokenCredential tokenCredential;

<span class="hljs-comment">// === Add to @BeforeEach method ===</span>
<span class="hljs-meta">@BeforeEach</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setUp</span><span class="hljs-params">()</span> </span>{
    tokenCredential = mock(TokenCredential<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;
}

<span class="hljs-comment">// === Replace local variable in test with ===</span>
tokenCredential;

</div></code></pre>
</details>
<hr>
<h4 id="test-case-id-kiota-javatest83">Test Case ID #kiota-java_Test_8_3</h4>
<h4 id="test-case-name-testconfiguredefaultscopewhenscopesnotprovidedfile-cjavaprojectsmicrosoftkiota-javacomponentsauthenticationazuresrctestjavacommicrosoftkiotaauthenticationazureidentityaccesstokenprovidertestjava">Test Case Name: <code>testConfigureDefaultScopeWhenScopesNotProvided</code>(File: <code>C:\Java_projects\Microsoft\kiota-java\components\authentication\azure\src\test\java\com\microsoft\kiota\authentication\AzureIdentityAccessTokenProviderTest.java</code>)</h4>
<h4 id="mock-object-variable-name-tokencredential">Mock Object Variable Name: <code>tokenCredential</code></h4>
<summary>Suggested Diff</summary>
<pre class="hljs"><code><div>@@
 @Test
 void testConfigureDefaultScopeWhenScopesNotProvided() throws URISyntaxException {
<span class="hljs-deletion">-    var tokenCredential = mock(TokenCredential.class);</span>
<span class="hljs-addition">+    // removed local mock; replaced with global field `tokenCredential`</span>
     var accessTokenProvider = new AzureIdentityAccessTokenProvider(tokenCredential, new String[] {});
     assertScopes(tokenCredential, accessTokenProvider, new String[] { "https://graph.microsoft.com/.default" });
}
</div></code></pre>
<details><summary>Original Test Code (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-meta">@Test</span>

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">testConfigureDefaultScopeWhenScopesNotProvided</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> URISyntaxException </span>{

    <span class="hljs-keyword">var</span> tokenCredential = mock(TokenCredential<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    <span class="hljs-keyword">var</span> accessTokenProvider = <span class="hljs-keyword">new</span> AzureIdentityAccessTokenProvider(tokenCredential, <span class="hljs-keyword">new</span> String[] {});

    assertScopes(tokenCredential, accessTokenProvider, <span class="hljs-keyword">new</span> String[] { <span class="hljs-string">"https://graph.microsoft.com/.default"</span> });

}
</div></code></pre>
</details>
<details><summary>Reusable Method for MCI (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-comment">// === Declare in class scope ===</span>
<span class="hljs-keyword">private</span> TokenCredential tokenCredential;

<span class="hljs-comment">// === Add to @BeforeEach method ===</span>
<span class="hljs-meta">@BeforeEach</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setUp</span><span class="hljs-params">()</span> </span>{
    tokenCredential = mock(TokenCredential<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;
}

<span class="hljs-comment">// === Replace local variable in test with ===</span>
tokenCredential;

</div></code></pre>
</details>
<hr>
<h4 id="test-case-id-kiota-javatest84">Test Case ID #kiota-java_Test_8_4</h4>
<h4 id="test-case-name-testconfiguredefaultscopewhenscopesnulloremptyfile-cjavaprojectsmicrosoftkiota-javacomponentsauthenticationazuresrctestjavacommicrosoftkiotaauthenticationazureidentityaccesstokenprovidertestjava">Test Case Name: <code>testConfigureDefaultScopeWhenScopesNullOrEmpty</code>(File: <code>C:\Java_projects\Microsoft\kiota-java\components\authentication\azure\src\test\java\com\microsoft\kiota\authentication\AzureIdentityAccessTokenProviderTest.java</code>)</h4>
<h4 id="mock-object-variable-name-tokencredential">Mock Object Variable Name: <code>tokenCredential</code></h4>
<summary>Suggested Diff</summary>
<pre class="hljs"><code><div>@@
@ParameterizedTest
@NullAndEmptySource
void testConfigureDefaultScopeWhenScopesNullOrEmpty(String[] nullOrEmptyUserProvidedScopes) throws URISyntaxException {
<span class="hljs-deletion">-    var tokenCredential = mock(TokenCredential.class);</span>
<span class="hljs-addition">+    // removed local mock; replaced with global field `tokenCredential`</span>
    var accessTokenProvider = new AzureIdentityAccessTokenProvider(tokenCredential, new String[] {}, nullOrEmptyUserProvidedScopes);
    assertScopes(tokenCredential, accessTokenProvider, new String[] { "https://graph.microsoft.com/.default" });
}
</div></code></pre>
<details><summary>Original Test Code (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-meta">@ParameterizedTest</span>

<span class="hljs-meta">@NullAndEmptySource</span>

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">testConfigureDefaultScopeWhenScopesNullOrEmpty</span><span class="hljs-params">(String[] nullOrEmptyUserProvidedScopes)</span> <span class="hljs-keyword">throws</span> URISyntaxException </span>{

    <span class="hljs-keyword">var</span> tokenCredential = mock(TokenCredential<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    <span class="hljs-keyword">var</span> accessTokenProvider = <span class="hljs-keyword">new</span> AzureIdentityAccessTokenProvider(tokenCredential, <span class="hljs-keyword">new</span> String[] {}, nullOrEmptyUserProvidedScopes);

    assertScopes(tokenCredential, accessTokenProvider, <span class="hljs-keyword">new</span> String[] { <span class="hljs-string">"https://graph.microsoft.com/.default"</span> });

}
</div></code></pre>
</details>
<details><summary>Reusable Method for MCI (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-comment">// === Declare in class scope ===</span>
<span class="hljs-keyword">private</span> TokenCredential tokenCredential;

<span class="hljs-comment">// === Add to @BeforeEach method ===</span>
<span class="hljs-meta">@BeforeEach</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setUp</span><span class="hljs-params">()</span> </span>{
    tokenCredential = mock(TokenCredential<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;
}

<span class="hljs-comment">// === Replace local variable in test with ===</span>
tokenCredential;

</div></code></pre>
</details>
<hr>
<h2 id="mock-clone-instance-kiota-javamci9">Mock Clone Instance #kiota-java_MCI_9</h2>
<ul>
<li><strong>Scope</strong>: method level</li>
<li><strong>Mocked Class</strong>: <code>com.microsoft.kiota.RequestAdapter</code></li>
<li><strong>Test Case Count</strong>: 5</li>
<li><strong>MO Count</strong>: 5</li>
</ul>
<h3 id="reusable-method">Reusable Method</h3>
<pre class="hljs"><code><div><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> RequestAdapter <span class="hljs-title">createMockRequestAdapter</span><span class="hljs-params">(SerializationWriterFactory factoryMock)</span> </span>{
    RequestAdapter requestAdapterMock = mock(RequestAdapter<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;
    when(requestAdapterMock.getSerializationWriterFactory()).thenReturn(factoryMock);
    <span class="hljs-keyword">return</span> requestAdapterMock;
}
</div></code></pre>
<h3 id="the-refactoring-details-in-each-test-cases">The refactoring details in each test cases</h3>
<hr>
<h4 id="test-case-id-kiota-javatest91">Test Case ID #kiota-java_Test_9_1</h4>
<h4 id="test-case-name-setsparsablecontentfile-cjavaprojectsmicrosoftkiota-javacomponentsabstractionssrctestjavacommicrosoftkiotarequestinformationtestjava">Test Case Name: <code>SetsParsableContent</code>(File: <code>C:\Java_projects\Microsoft\kiota-java\components\abstractions\src\test\java\com\microsoft\kiota\RequestInformationTest.java</code>)</h4>
<h4 id="mock-object-variable-name-requestadaptermock">Mock Object Variable Name: <code>requestAdapterMock</code></h4>
<summary>Suggested Diff</summary>
<pre class="hljs"><code><div><span class="hljs-comment">--- original</span>
<span class="hljs-comment">+++ refactored</span>
@@
    final SerializationWriter writerMock = mock(SerializationWriter.class);
    final SerializationWriterFactory factoryMock = mock(SerializationWriterFactory.class);
    when(factoryMock.getSerializationWriter(anyString())).thenReturn(writerMock);
<span class="hljs-deletion">-    final RequestAdapter requestAdapterMock = mock(RequestAdapter.class);</span>
<span class="hljs-deletion">-    when(requestAdapterMock.getSerializationWriterFactory()).thenReturn(factoryMock);</span>
<span class="hljs-addition">+    final RequestAdapter requestAdapterMock = createMockRequestAdapter(factoryMock);</span>
    requestInfo.setContentFromParsable(requestAdapterMock, "application/json", new TestEntity());
    verify(writerMock, times(1)).writeObjectValue(any(), any(TestEntity.class));
    verify(writerMock, never()).writeCollectionOfObjectValues(anyString(), any(ArrayList.class));
@@
</div></code></pre>
<details><summary>Original Test Code (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-meta">@Test</span>

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">SetsParsableContent</span><span class="hljs-params">()</span> </span>{

    <span class="hljs-comment">// Arrange as the request builders would</span>

    <span class="hljs-keyword">final</span> RequestInformation requestInfo = <span class="hljs-keyword">new</span> RequestInformation();

    requestInfo.httpMethod = HttpMethod.POST;

    requestInfo.urlTemplate = <span class="hljs-string">"http://localhost/users"</span>;

    <span class="hljs-keyword">final</span> SerializationWriter writerMock = mock(SerializationWriter<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    <span class="hljs-keyword">final</span> SerializationWriterFactory factoryMock = mock(SerializationWriterFactory<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    when(factoryMock.getSerializationWriter(anyString())).thenReturn(writerMock);

    <span class="hljs-keyword">final</span> RequestAdapter requestAdapterMock = mock(RequestAdapter<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    when(requestAdapterMock.getSerializationWriterFactory()).thenReturn(factoryMock);

    requestInfo.setContentFromParsable(requestAdapterMock, <span class="hljs-string">"application/json"</span>, <span class="hljs-keyword">new</span> TestEntity());

    verify(writerMock, times(<span class="hljs-number">1</span>)).writeObjectValue(any(), any(TestEntity<span class="hljs-class">.<span class="hljs-keyword">class</span>))</span>;

    verify(writerMock, never()).writeCollectionOfObjectValues(anyString(), any(ArrayList<span class="hljs-class">.<span class="hljs-keyword">class</span>))</span>;

}
</div></code></pre>
</details>
<details><summary>Reusable Method for MCI (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> RequestAdapter <span class="hljs-title">createMockRequestAdapter</span><span class="hljs-params">(SerializationWriterFactory factoryMock)</span> </span>{
    RequestAdapter requestAdapterMock = mock(RequestAdapter<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;
    when(requestAdapterMock.getSerializationWriterFactory()).thenReturn(factoryMock);
    <span class="hljs-keyword">return</span> requestAdapterMock;
}
</div></code></pre>
</details>
<hr>
<h4 id="test-case-id-kiota-javatest92">Test Case ID #kiota-java_Test_9_2</h4>
<h4 id="test-case-name-setsparsablecontentcollectionfile-cjavaprojectsmicrosoftkiota-javacomponentsabstractionssrctestjavacommicrosoftkiotarequestinformationtestjava">Test Case Name: <code>SetsParsableContentCollection</code>(File: <code>C:\Java_projects\Microsoft\kiota-java\components\abstractions\src\test\java\com\microsoft\kiota\RequestInformationTest.java</code>)</h4>
<h4 id="mock-object-variable-name-requestadaptermock">Mock Object Variable Name: <code>requestAdapterMock</code></h4>
<summary>Suggested Diff</summary>
<pre class="hljs"><code><div>@@
    final SerializationWriter writerMock = mock(SerializationWriter.class);
    final SerializationWriterFactory factoryMock = mock(SerializationWriterFactory.class);
    when(factoryMock.getSerializationWriter(anyString())).thenReturn(writerMock);
<span class="hljs-deletion">-    final RequestAdapter requestAdapterMock = mock(RequestAdapter.class);</span>
<span class="hljs-deletion">-    when(requestAdapterMock.getSerializationWriterFactory()).thenReturn(factoryMock);</span>
<span class="hljs-addition">+    final RequestAdapter requestAdapterMock = createMockRequestAdapter(factoryMock);</span>
    requestInfo.setContentFromParsable(requestAdapterMock, "application/json", new TestEntity[] { new TestEntity() });
    verify(writerMock, never()).writeObjectValue(any(), any(TestEntity.class));
    verify(writerMock, times(1)).writeCollectionOfObjectValues(any(), any(Iterable.class));
@@
</div></code></pre>
<details><summary>Original Test Code (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-meta">@Test</span>

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">SetsParsableContentCollection</span><span class="hljs-params">()</span> </span>{

    <span class="hljs-comment">// Arrange as the request builders would</span>

    <span class="hljs-keyword">final</span> RequestInformation requestInfo = <span class="hljs-keyword">new</span> RequestInformation();

    requestInfo.httpMethod = HttpMethod.POST;

    requestInfo.urlTemplate = <span class="hljs-string">"http://localhost/users"</span>;

    <span class="hljs-keyword">final</span> SerializationWriter writerMock = mock(SerializationWriter<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    <span class="hljs-keyword">final</span> SerializationWriterFactory factoryMock = mock(SerializationWriterFactory<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    when(factoryMock.getSerializationWriter(anyString())).thenReturn(writerMock);

    <span class="hljs-keyword">final</span> RequestAdapter requestAdapterMock = mock(RequestAdapter<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    when(requestAdapterMock.getSerializationWriterFactory()).thenReturn(factoryMock);

    requestInfo.setContentFromParsable(requestAdapterMock, <span class="hljs-string">"application/json"</span>, <span class="hljs-keyword">new</span> TestEntity[] { <span class="hljs-keyword">new</span> TestEntity() });

    verify(writerMock, never()).writeObjectValue(any(), any(TestEntity<span class="hljs-class">.<span class="hljs-keyword">class</span>))</span>;

    verify(writerMock, times(<span class="hljs-number">1</span>)).writeCollectionOfObjectValues(any(), any(Iterable<span class="hljs-class">.<span class="hljs-keyword">class</span>))</span>;

}
</div></code></pre>
</details>
<details><summary>Reusable Method for MCI (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> RequestAdapter <span class="hljs-title">createMockRequestAdapter</span><span class="hljs-params">(SerializationWriterFactory factoryMock)</span> </span>{
    RequestAdapter requestAdapterMock = mock(RequestAdapter<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;
    when(requestAdapterMock.getSerializationWriterFactory()).thenReturn(factoryMock);
    <span class="hljs-keyword">return</span> requestAdapterMock;
}
</div></code></pre>
</details>
<hr>
<h4 id="test-case-id-kiota-javatest93">Test Case ID #kiota-java_Test_9_3</h4>
<h4 id="test-case-name-setsscalarcontentcollectionfile-cjavaprojectsmicrosoftkiota-javacomponentsabstractionssrctestjavacommicrosoftkiotarequestinformationtestjava">Test Case Name: <code>SetsScalarContentCollection</code>(File: <code>C:\Java_projects\Microsoft\kiota-java\components\abstractions\src\test\java\com\microsoft\kiota\RequestInformationTest.java</code>)</h4>
<h4 id="mock-object-variable-name-requestadaptermock">Mock Object Variable Name: <code>requestAdapterMock</code></h4>
<summary>Suggested Diff</summary>
<pre class="hljs"><code><div>@@
    final SerializationWriter writerMock = mock(SerializationWriter.class);
    final SerializationWriterFactory factoryMock = mock(SerializationWriterFactory.class);
    when(factoryMock.getSerializationWriter(anyString())).thenReturn(writerMock);
<span class="hljs-deletion">-    final RequestAdapter requestAdapterMock = mock(RequestAdapter.class);</span>
<span class="hljs-deletion">-    when(requestAdapterMock.getSerializationWriterFactory()).thenReturn(factoryMock);</span>
<span class="hljs-addition">+    final RequestAdapter requestAdapterMock = createMockRequestAdapter(factoryMock);</span>
    requestInfo.setContentFromScalarCollection(requestAdapterMock, "application/json", new String[] { "foo" });
    verify(writerMock, never()).writeStringValue(any(), anyString());
    verify(writerMock, times(1)).writeCollectionOfPrimitiveValues(any(), any(Iterable.class));
@@
</div></code></pre>
<details><summary>Original Test Code (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-meta">@Test</span>

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">SetsScalarContentCollection</span><span class="hljs-params">()</span> </span>{

    <span class="hljs-comment">// Arrange as the request builders would</span>

    <span class="hljs-keyword">final</span> RequestInformation requestInfo = <span class="hljs-keyword">new</span> RequestInformation();

    requestInfo.httpMethod = HttpMethod.POST;

    requestInfo.urlTemplate = <span class="hljs-string">"http://localhost/users"</span>;

    <span class="hljs-keyword">final</span> SerializationWriter writerMock = mock(SerializationWriter<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    <span class="hljs-keyword">final</span> SerializationWriterFactory factoryMock = mock(SerializationWriterFactory<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    when(factoryMock.getSerializationWriter(anyString())).thenReturn(writerMock);

    <span class="hljs-keyword">final</span> RequestAdapter requestAdapterMock = mock(RequestAdapter<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    when(requestAdapterMock.getSerializationWriterFactory()).thenReturn(factoryMock);

    requestInfo.setContentFromScalarCollection(requestAdapterMock, <span class="hljs-string">"application/json"</span>, <span class="hljs-keyword">new</span> String[] { <span class="hljs-string">"foo"</span> });

    verify(writerMock, never()).writeStringValue(any(), anyString());

    verify(writerMock, times(<span class="hljs-number">1</span>)).writeCollectionOfPrimitiveValues(any(), any(Iterable<span class="hljs-class">.<span class="hljs-keyword">class</span>))</span>;

}
</div></code></pre>
</details>
<details><summary>Reusable Method for MCI (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> RequestAdapter <span class="hljs-title">createMockRequestAdapter</span><span class="hljs-params">(SerializationWriterFactory factoryMock)</span> </span>{
    RequestAdapter requestAdapterMock = mock(RequestAdapter<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;
    when(requestAdapterMock.getSerializationWriterFactory()).thenReturn(factoryMock);
    <span class="hljs-keyword">return</span> requestAdapterMock;
}
</div></code></pre>
</details>
<hr>
<h4 id="test-case-id-kiota-javatest94">Test Case ID #kiota-java_Test_9_4</h4>
<h4 id="test-case-name-setsscalarcontentfile-cjavaprojectsmicrosoftkiota-javacomponentsabstractionssrctestjavacommicrosoftkiotarequestinformationtestjava">Test Case Name: <code>SetsScalarContent</code>(File: <code>C:\Java_projects\Microsoft\kiota-java\components\abstractions\src\test\java\com\microsoft\kiota\RequestInformationTest.java</code>)</h4>
<h4 id="mock-object-variable-name-requestadaptermock">Mock Object Variable Name: <code>requestAdapterMock</code></h4>
<summary>Suggested Diff</summary>
<pre class="hljs"><code><div><span class="hljs-comment">--- original</span>
<span class="hljs-comment">+++ refactored</span>
@@
    final SerializationWriter writerMock = mock(SerializationWriter.class);
    final SerializationWriterFactory factoryMock = mock(SerializationWriterFactory.class);
    when(factoryMock.getSerializationWriter(anyString())).thenReturn(writerMock);
<span class="hljs-deletion">-    final RequestAdapter requestAdapterMock = mock(RequestAdapter.class);</span>
<span class="hljs-deletion">-    when(requestAdapterMock.getSerializationWriterFactory()).thenReturn(factoryMock);</span>
<span class="hljs-addition">+    final RequestAdapter requestAdapterMock = createMockRequestAdapter(factoryMock);</span>
    requestInfo.setContentFromScalar(requestAdapterMock, "application/json", "foo");
    verify(writerMock, times(1)).writeStringValue(any(), anyString());
    verify(writerMock, never()).writeCollectionOfPrimitiveValues(any(), any(Iterable.class));
@@
</div></code></pre>
<details><summary>Original Test Code (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-meta">@Test</span>

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">SetsScalarContent</span><span class="hljs-params">()</span> </span>{

    <span class="hljs-comment">// Arrange as the request builders would</span>

    <span class="hljs-keyword">final</span> RequestInformation requestInfo = <span class="hljs-keyword">new</span> RequestInformation();

    requestInfo.httpMethod = HttpMethod.POST;

    requestInfo.urlTemplate = <span class="hljs-string">"http://localhost/users"</span>;

    <span class="hljs-keyword">final</span> SerializationWriter writerMock = mock(SerializationWriter<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    <span class="hljs-keyword">final</span> SerializationWriterFactory factoryMock = mock(SerializationWriterFactory<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    when(factoryMock.getSerializationWriter(anyString())).thenReturn(writerMock);

    <span class="hljs-keyword">final</span> RequestAdapter requestAdapterMock = mock(RequestAdapter<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    when(requestAdapterMock.getSerializationWriterFactory()).thenReturn(factoryMock);

    requestInfo.setContentFromScalar(requestAdapterMock, <span class="hljs-string">"application/json"</span>, <span class="hljs-string">"foo"</span>);

    verify(writerMock, times(<span class="hljs-number">1</span>)).writeStringValue(any(), anyString());

    verify(writerMock, never()).writeCollectionOfPrimitiveValues(any(), any(Iterable<span class="hljs-class">.<span class="hljs-keyword">class</span>))</span>;

}
</div></code></pre>
</details>
<details><summary>Reusable Method for MCI (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> RequestAdapter <span class="hljs-title">createMockRequestAdapter</span><span class="hljs-params">(SerializationWriterFactory factoryMock)</span> </span>{
    RequestAdapter requestAdapterMock = mock(RequestAdapter<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;
    when(requestAdapterMock.getSerializationWriterFactory()).thenReturn(factoryMock);
    <span class="hljs-keyword">return</span> requestAdapterMock;
}
</div></code></pre>
</details>
<hr>
<h4 id="test-case-id-kiota-javatest95">Test Case ID #kiota-java_Test_9_5</h4>
<h4 id="test-case-name-setsboundaryonmultipartbodyfile-cjavaprojectsmicrosoftkiota-javacomponentsabstractionssrctestjavacommicrosoftkiotarequestinformationtestjava">Test Case Name: <code>SetsBoundaryOnMultipartBody</code>(File: <code>C:\Java_projects\Microsoft\kiota-java\components\abstractions\src\test\java\com\microsoft\kiota\RequestInformationTest.java</code>)</h4>
<h4 id="mock-object-variable-name-requestadaptermock">Mock Object Variable Name: <code>requestAdapterMock</code></h4>
<summary>Suggested Diff</summary>
<pre class="hljs"><code><div>@@
    final SerializationWriter writerMock = mock(SerializationWriter.class);
    final SerializationWriterFactory factoryMock = mock(SerializationWriterFactory.class);
    when(factoryMock.getSerializationWriter(anyString())).thenReturn(writerMock);
<span class="hljs-deletion">-    final RequestAdapter requestAdapterMock = mock(RequestAdapter.class);</span>
<span class="hljs-deletion">-    when(requestAdapterMock.getSerializationWriterFactory()).thenReturn(factoryMock);</span>
<span class="hljs-addition">+    final RequestAdapter requestAdapterMock = createMockRequestAdapter(factoryMock);</span>
    final MultipartBody multipartBody = new MultipartBody();
    multipartBody.requestAdapter = requestAdapterMock;
    requestInfo.setContentFromParsable(requestAdapterMock, "multipart/form-data", multipartBody);
    assertNotNull(multipartBody.getBoundary());
    assertFalse(multipartBody.getBoundary().isEmpty());
    assertEquals("multipart/form-data; boundary=" + multipartBody.getBoundary(), requestInfo.headers.get("Content-Type").toArray()[0]);
@@
</div></code></pre>
<details><summary>Original Test Code (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-meta">@Test</span>

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">SetsBoundaryOnMultipartBody</span><span class="hljs-params">()</span> </span>{

    <span class="hljs-keyword">final</span> RequestInformation requestInfo = <span class="hljs-keyword">new</span> RequestInformation();

    requestInfo.httpMethod = HttpMethod.POST;

    requestInfo.urlTemplate = <span class="hljs-string">"http://localhost/{URITemplate}/ParameterMapping?IsCaseSensitive={IsCaseSensitive}"</span>;

    <span class="hljs-keyword">final</span> SerializationWriter writerMock = mock(SerializationWriter<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    <span class="hljs-keyword">final</span> SerializationWriterFactory factoryMock = mock(SerializationWriterFactory<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    when(factoryMock.getSerializationWriter(anyString())).thenReturn(writerMock);

    <span class="hljs-keyword">final</span> RequestAdapter requestAdapterMock = mock(RequestAdapter<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    when(requestAdapterMock.getSerializationWriterFactory()).thenReturn(factoryMock);

    <span class="hljs-keyword">final</span> MultipartBody multipartBody = <span class="hljs-keyword">new</span> MultipartBody();

    multipartBody.requestAdapter = requestAdapterMock;

    requestInfo.setContentFromParsable(requestAdapterMock, <span class="hljs-string">"multipart/form-data"</span>, multipartBody);

    assertNotNull(multipartBody.getBoundary());

    assertFalse(multipartBody.getBoundary().isEmpty());

    assertEquals(<span class="hljs-string">"multipart/form-data; boundary="</span> + multipartBody.getBoundary(), requestInfo.headers.get(<span class="hljs-string">"Content-Type"</span>).toArray()[<span class="hljs-number">0</span>]);

}
</div></code></pre>
</details>
<details><summary>Reusable Method for MCI (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> RequestAdapter <span class="hljs-title">createMockRequestAdapter</span><span class="hljs-params">(SerializationWriterFactory factoryMock)</span> </span>{
    RequestAdapter requestAdapterMock = mock(RequestAdapter<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;
    when(requestAdapterMock.getSerializationWriterFactory()).thenReturn(factoryMock);
    <span class="hljs-keyword">return</span> requestAdapterMock;
}
</div></code></pre>
</details>
<hr>
<h2 id="mock-clone-instance-kiota-javamci10">Mock Clone Instance #kiota-java_MCI_10</h2>
<ul>
<li><strong>Scope</strong>: method level</li>
<li><strong>Mocked Class</strong>: <code>com.microsoft.kiota.RequestAdapter</code></li>
<li><strong>Test Case Count</strong>: 3</li>
<li><strong>MO Count</strong>: 3</li>
</ul>
<h3 id="reusable-method">Reusable Method</h3>
<pre class="hljs"><code><div><span class="hljs-comment">// === Declare in class scope ===</span>
<span class="hljs-keyword">private</span> RequestAdapter requestAdapter;

<span class="hljs-comment">// === Add to @BeforeEach method ===</span>
<span class="hljs-meta">@BeforeEach</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setUp</span><span class="hljs-params">()</span> </span>{
    requestAdapter = mock(RequestAdapter<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;
}

<span class="hljs-comment">// === Replace local variable in test with ===</span>
requestAdapter;

</div></code></pre>
<h3 id="the-refactoring-details-in-each-test-cases">The refactoring details in each test cases</h3>
<hr>
<h4 id="test-case-id-kiota-javatest101">Test Case ID #kiota-java_Test_10_1</h4>
<h4 id="test-case-name-requirespartsforserializationfile-cjavaprojectsmicrosoftkiota-javacomponentsabstractionssrctestjavacommicrosoftkiotamultipartbodytestjava">Test Case Name: <code>requiresPartsForSerialization</code>(File: <code>C:\Java_projects\Microsoft\kiota-java\components\abstractions\src\test\java\com\microsoft\kiota\MultiPartBodyTest.java</code>)</h4>
<h4 id="mock-object-variable-name-requestadapter">Mock Object Variable Name: <code>requestAdapter</code></h4>
<summary>Suggested Diff</summary>
<pre class="hljs"><code><div>@@
 @Test
 void requiresPartsForSerialization() {
     final MultipartBody multipartBody = new MultipartBody();
     final SerializationWriter writer = mock(SerializationWriter.class);
<span class="hljs-deletion">-    final RequestAdapter requestAdapter = mock(RequestAdapter.class);</span>
<span class="hljs-addition">+    // removed local mock; replaced with global field `requestAdapter`</span>
     multipartBody.requestAdapter = requestAdapter;
     assertThrows(IllegalStateException.class, () -&gt; multipartBody.serialize(writer));
 }
</div></code></pre>
<details><summary>Original Test Code (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-meta">@Test</span>

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">requiresPartsForSerialization</span><span class="hljs-params">()</span> </span>{

    <span class="hljs-keyword">final</span> MultipartBody multipartBody = <span class="hljs-keyword">new</span> MultipartBody();

    <span class="hljs-keyword">final</span> SerializationWriter writer = mock(SerializationWriter<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    <span class="hljs-keyword">final</span> RequestAdapter requestAdapter = mock(RequestAdapter<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    multipartBody.requestAdapter = requestAdapter;

    assertThrows(IllegalStateException<span class="hljs-class">.<span class="hljs-keyword">class</span>, () -&gt; <span class="hljs-title">multipartBody</span>.<span class="hljs-title">serialize</span>(<span class="hljs-title">writer</span>))</span>;

}
</div></code></pre>
</details>
<details><summary>Reusable Method for MCI (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-comment">// === Declare in class scope ===</span>
<span class="hljs-keyword">private</span> RequestAdapter requestAdapter;

<span class="hljs-comment">// === Add to @BeforeEach method ===</span>
<span class="hljs-meta">@BeforeEach</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setUp</span><span class="hljs-params">()</span> </span>{
    requestAdapter = mock(RequestAdapter<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;
}

<span class="hljs-comment">// === Replace local variable in test with ===</span>
requestAdapter;

</div></code></pre>
</details>
<hr>
<h4 id="test-case-id-kiota-javatest102">Test Case ID #kiota-java_Test_10_2</h4>
<h4 id="test-case-name-addspartfile-cjavaprojectsmicrosoftkiota-javacomponentsabstractionssrctestjavacommicrosoftkiotamultipartbodytestjava">Test Case Name: <code>addsPart</code>(File: <code>C:\Java_projects\Microsoft\kiota-java\components\abstractions\src\test\java\com\microsoft\kiota\MultiPartBodyTest.java</code>)</h4>
<h4 id="mock-object-variable-name-requestadapter">Mock Object Variable Name: <code>requestAdapter</code></h4>
<summary>Suggested Diff</summary>
<pre class="hljs"><code><div>@@
 @Test
 void addsPart() {
     final MultipartBody multipartBody = new MultipartBody();
<span class="hljs-deletion">-    final RequestAdapter requestAdapter = mock(RequestAdapter.class);</span>
<span class="hljs-addition">+    // removed local mock; replaced with global field `requestAdapter`</span>
     multipartBody.requestAdapter = requestAdapter;
     multipartBody.addOrReplacePart("foo", "bar", "baz");
     final Object result = multipartBody.getPartValue("foo");
     assertNotNull(result);
     assertTrue(result instanceof String);
 }
</div></code></pre>
<details><summary>Original Test Code (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-meta">@Test</span>

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">addsPart</span><span class="hljs-params">()</span> </span>{

    <span class="hljs-keyword">final</span> MultipartBody multipartBody = <span class="hljs-keyword">new</span> MultipartBody();

    <span class="hljs-keyword">final</span> RequestAdapter requestAdapter = mock(RequestAdapter<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    multipartBody.requestAdapter = requestAdapter;

    multipartBody.addOrReplacePart(<span class="hljs-string">"foo"</span>, <span class="hljs-string">"bar"</span>, <span class="hljs-string">"baz"</span>);

    <span class="hljs-keyword">final</span> Object result = multipartBody.getPartValue(<span class="hljs-string">"foo"</span>);

    assertNotNull(result);

    assertTrue(result <span class="hljs-keyword">instanceof</span> String);

}
</div></code></pre>
</details>
<details><summary>Reusable Method for MCI (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-comment">// === Declare in class scope ===</span>
<span class="hljs-keyword">private</span> RequestAdapter requestAdapter;

<span class="hljs-comment">// === Add to @BeforeEach method ===</span>
<span class="hljs-meta">@BeforeEach</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setUp</span><span class="hljs-params">()</span> </span>{
    requestAdapter = mock(RequestAdapter<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;
}

<span class="hljs-comment">// === Replace local variable in test with ===</span>
requestAdapter;

</div></code></pre>
</details>
<hr>
<h4 id="test-case-id-kiota-javatest103">Test Case ID #kiota-java_Test_10_3</h4>
<h4 id="test-case-name-removespartfile-cjavaprojectsmicrosoftkiota-javacomponentsabstractionssrctestjavacommicrosoftkiotamultipartbodytestjava">Test Case Name: <code>removesPart</code>(File: <code>C:\Java_projects\Microsoft\kiota-java\components\abstractions\src\test\java\com\microsoft\kiota\MultiPartBodyTest.java</code>)</h4>
<h4 id="mock-object-variable-name-requestadapter">Mock Object Variable Name: <code>requestAdapter</code></h4>
<summary>Suggested Diff</summary>
<pre class="hljs"><code><div>@@
 @Test
 void removesPart() {
     final MultipartBody multipartBody = new MultipartBody();
<span class="hljs-deletion">-    final RequestAdapter requestAdapter = mock(RequestAdapter.class);</span>
<span class="hljs-addition">+    // removed local mock; replaced with global field `requestAdapter`</span>
     multipartBody.requestAdapter = requestAdapter;
     multipartBody.addOrReplacePart("foo", "bar", "baz");
     multipartBody.removePart("FOO");
     final Object result = multipartBody.getPartValue("foo");
     assertNull(result);
 }
</div></code></pre>
<details><summary>Original Test Code (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-meta">@Test</span>

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">removesPart</span><span class="hljs-params">()</span> </span>{

    <span class="hljs-keyword">final</span> MultipartBody multipartBody = <span class="hljs-keyword">new</span> MultipartBody();

    <span class="hljs-keyword">final</span> RequestAdapter requestAdapter = mock(RequestAdapter<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    multipartBody.requestAdapter = requestAdapter;

    multipartBody.addOrReplacePart(<span class="hljs-string">"foo"</span>, <span class="hljs-string">"bar"</span>, <span class="hljs-string">"baz"</span>);

    multipartBody.removePart(<span class="hljs-string">"FOO"</span>);

    <span class="hljs-keyword">final</span> Object result = multipartBody.getPartValue(<span class="hljs-string">"foo"</span>);

    assertNull(result);

}
</div></code></pre>
</details>
<details><summary>Reusable Method for MCI (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-comment">// === Declare in class scope ===</span>
<span class="hljs-keyword">private</span> RequestAdapter requestAdapter;

<span class="hljs-comment">// === Add to @BeforeEach method ===</span>
<span class="hljs-meta">@BeforeEach</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setUp</span><span class="hljs-params">()</span> </span>{
    requestAdapter = mock(RequestAdapter<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;
}

<span class="hljs-comment">// === Replace local variable in test with ===</span>
requestAdapter;

</div></code></pre>
</details>
<hr>
<h2 id="mock-clone-instance-kiota-javamci11">Mock Clone Instance #kiota-java_MCI_11</h2>
<ul>
<li><strong>Scope</strong>: method level</li>
<li><strong>Mocked Class</strong>: <code>com.microsoft.kiota.serialization.ParseNodeFactory</code></li>
<li><strong>Test Case Count</strong>: 2</li>
<li><strong>MO Count</strong>: 2</li>
</ul>
<h3 id="reusable-method">Reusable Method</h3>
<pre class="hljs"><code><div><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> ParseNodeFactory <span class="hljs-title">createMockParseNodeFactory</span><span class="hljs-params">(ParseNode mockParseNode, String validContentType)</span> </span>{
    ParseNodeFactory mockFactory = mock(ParseNodeFactory<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;
    when(mockFactory.getParseNode(any(String<span class="hljs-class">.<span class="hljs-keyword">class</span>), <span class="hljs-title">any</span>(<span class="hljs-title">InputStream</span>.<span class="hljs-title">class</span>))).<span class="hljs-title">thenReturn</span>(<span class="hljs-title">mockParseNode</span>)</span>;
    when(mockFactory.getValidContentType()).thenReturn(validContentType);
    <span class="hljs-keyword">return</span> mockFactory;
}
</div></code></pre>
<h3 id="the-refactoring-details-in-each-test-cases">The refactoring details in each test cases</h3>
<hr>
<h4 id="test-case-id-kiota-javatest111">Test Case ID #kiota-java_Test_11_1</h4>
<h4 id="test-case-name-sendreturnsobjectoncontentfile-cjavaprojectsmicrosoftkiota-javacomponentshttpokhttpsrctestjavacommicrosoftkiotahttpokhttprequestadaptertestjava">Test Case Name: <code>sendReturnsObjectOnContent</code>(File: <code>C:\Java_projects\Microsoft\kiota-java\components\http\okHttp\src\test\java\com\microsoft\kiota\http\OkHttpRequestAdapterTest.java</code>)</h4>
<h4 id="mock-object-variable-name-mockfactory">Mock Object Variable Name: <code>mockFactory</code></h4>
<summary>Suggested Diff</summary>
<pre class="hljs"><code><div><span class="hljs-comment">--- original</span>
<span class="hljs-comment">+++ refactored</span>
@@
    final var mockEntity = mock(Parsable.class);
    when(mockEntity.getFieldDeserializers()).thenReturn(new HashMap&lt;&gt;());
    final var mockParseNode = mock(ParseNode.class);
    when(mockParseNode.getObjectValue(any(ParsableFactory.class))).thenReturn(mockEntity);
<span class="hljs-deletion">-    final var mockFactory = mock(ParseNodeFactory.class);</span>
<span class="hljs-deletion">-    when(mockFactory.getParseNode(any(String.class), any(InputStream.class))).thenReturn(mockParseNode);</span>
<span class="hljs-deletion">-    when(mockFactory.getValidContentType()).thenReturn("application/json");</span>
<span class="hljs-addition">+    final var mockFactory = createMockParseNodeFactory(mockParseNode, "application/json");</span>
    final var requestAdapter = new OkHttpRequestAdapter(authenticationProviderMock, mockFactory, null, client);
    final var response = requestAdapter.send(requestInformation, null, (node) -&gt; mockEntity);
    assertNotNull(response);
@@
</div></code></pre>
<details><summary>Original Test Code (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-meta">@ParameterizedTest</span>

<span class="hljs-meta">@ValueSource</span>(ints = { <span class="hljs-number">200</span>, <span class="hljs-number">201</span>, <span class="hljs-number">202</span>, <span class="hljs-number">203</span> })

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">sendReturnsObjectOnContent</span><span class="hljs-params">(<span class="hljs-keyword">int</span> statusCode)</span> <span class="hljs-keyword">throws</span> Exception </span>{

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> authenticationProviderMock = mock(AuthenticationProvider<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    authenticationProviderMock.authenticateRequest(any(RequestInformation<span class="hljs-class">.<span class="hljs-keyword">class</span>), <span class="hljs-title">any</span>(<span class="hljs-title">Map</span>.<span class="hljs-title">class</span>))</span>;

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> client = getMockClient(<span class="hljs-keyword">new</span> Response.Builder().code(statusCode).message(<span class="hljs-string">"OK"</span>).protocol(Protocol.HTTP_1_1).request(<span class="hljs-keyword">new</span> Request.Builder().url(<span class="hljs-string">"http://localhost"</span>).build()).body(ResponseBody.create(<span class="hljs-string">"test"</span>.getBytes(<span class="hljs-string">"UTF-8"</span>), MediaType.parse(<span class="hljs-string">"application/json"</span>))).build());

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> requestInformation = <span class="hljs-keyword">new</span> RequestInformation() {



        {

            setUri(<span class="hljs-keyword">new</span> URI(<span class="hljs-string">"https://localhost"</span>));

            httpMethod = HttpMethod.GET;

        }

    };

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> mockEntity = mock(Parsable<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    when(mockEntity.getFieldDeserializers()).thenReturn(<span class="hljs-keyword">new</span> HashMap&lt;&gt;());

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> mockParseNode = mock(ParseNode<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    when(mockParseNode.getObjectValue(any(ParsableFactory<span class="hljs-class">.<span class="hljs-keyword">class</span>))).<span class="hljs-title">thenReturn</span>(<span class="hljs-title">mockEntity</span>)</span>;

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> mockFactory = mock(ParseNodeFactory<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    when(mockFactory.getParseNode(any(String<span class="hljs-class">.<span class="hljs-keyword">class</span>), <span class="hljs-title">any</span>(<span class="hljs-title">InputStream</span>.<span class="hljs-title">class</span>))).<span class="hljs-title">thenReturn</span>(<span class="hljs-title">mockParseNode</span>)</span>;

    when(mockFactory.getValidContentType()).thenReturn(<span class="hljs-string">"application/json"</span>);

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> requestAdapter = <span class="hljs-keyword">new</span> OkHttpRequestAdapter(authenticationProviderMock, mockFactory, <span class="hljs-keyword">null</span>, client);

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> response = requestAdapter.send(requestInformation, <span class="hljs-keyword">null</span>, (node) -&gt; mockEntity);

    assertNotNull(response);

}
</div></code></pre>
</details>
<details><summary>Reusable Method for MCI (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> ParseNodeFactory <span class="hljs-title">createMockParseNodeFactory</span><span class="hljs-params">(ParseNode mockParseNode, String validContentType)</span> </span>{
    ParseNodeFactory mockFactory = mock(ParseNodeFactory<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;
    when(mockFactory.getParseNode(any(String<span class="hljs-class">.<span class="hljs-keyword">class</span>), <span class="hljs-title">any</span>(<span class="hljs-title">InputStream</span>.<span class="hljs-title">class</span>))).<span class="hljs-title">thenReturn</span>(<span class="hljs-title">mockParseNode</span>)</span>;
    when(mockFactory.getValidContentType()).thenReturn(validContentType);
    <span class="hljs-keyword">return</span> mockFactory;
}
</div></code></pre>
</details>
<hr>
<h4 id="test-case-id-kiota-javatest112">Test Case ID #kiota-java_Test_11_2</h4>
<h4 id="test-case-name-throwsapiexceptionfile-cjavaprojectsmicrosoftkiota-javacomponentshttpokhttpsrctestjavacommicrosoftkiotahttpokhttprequestadaptertestjava">Test Case Name: <code>throwsAPIException</code>(File: <code>C:\Java_projects\Microsoft\kiota-java\components\http\okHttp\src\test\java\com\microsoft\kiota\http\OkHttpRequestAdapterTest.java</code>)</h4>
<h4 id="mock-object-variable-name-mockfactory">Mock Object Variable Name: <code>mockFactory</code></h4>
<summary>Suggested Diff</summary>
<pre class="hljs"><code><div><span class="hljs-comment">--- original</span>
<span class="hljs-comment">+++ refactored</span>
@@
    final var mockParseNode = mock(ParseNode.class);
    when(mockParseNode.getObjectValue(any(ParsableFactory.class))).thenReturn(mockEntity);
<span class="hljs-deletion">-    final var mockFactory = mock(ParseNodeFactory.class);</span>
<span class="hljs-deletion">-    when(mockFactory.getParseNode(any(String.class), any(InputStream.class))).thenReturn(mockParseNode);</span>
<span class="hljs-deletion">-    when(mockFactory.getValidContentType()).thenReturn("application/json");</span>
<span class="hljs-addition">+    final var mockFactory = createMockParseNodeFactory(mockParseNode, "application/json");</span>
    final var requestAdapter = new OkHttpRequestAdapter(authenticationProviderMock, mockFactory, null, client);
    final var errorMappings = errorMappingCodes == null ? null : new HashMap&lt;String, ParsableFactory&lt;? extends Parsable&gt;&gt;();
@@
</div></code></pre>
<details><summary>Original Test Code (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-meta">@SuppressWarnings</span>(<span class="hljs-string">"unchecked"</span>)

<span class="hljs-meta">@ParameterizedTest</span>

<span class="hljs-meta">@MethodSource</span>(<span class="hljs-string">"providesErrorMappings"</span>)

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">throwsAPIException</span><span class="hljs-params">(<span class="hljs-keyword">int</span> responseStatusCode, List&lt;String&gt; errorMappingCodes, <span class="hljs-keyword">boolean</span> expectDeserializedException)</span> <span class="hljs-keyword">throws</span> Exception </span>{

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> authenticationProviderMock = mock(AuthenticationProvider<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    authenticationProviderMock.authenticateRequest(any(RequestInformation<span class="hljs-class">.<span class="hljs-keyword">class</span>), <span class="hljs-title">any</span>(<span class="hljs-title">Map</span>.<span class="hljs-title">class</span>))</span>;

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> client = getMockClient(<span class="hljs-keyword">new</span> Response.Builder().code(responseStatusCode).message(<span class="hljs-string">"Not Found"</span>).protocol(Protocol.HTTP_1_1).request(<span class="hljs-keyword">new</span> Request.Builder().url(<span class="hljs-string">"http://localhost"</span>).build()).body(ResponseBody.create(<span class="hljs-string">"test"</span>.getBytes(<span class="hljs-string">"UTF-8"</span>), MediaType.parse(<span class="hljs-string">"application/json"</span>))).header(<span class="hljs-string">"request-id"</span>, <span class="hljs-string">"request-id-value"</span>).build());

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> requestInformation = <span class="hljs-keyword">new</span> RequestInformation() {



        {

            setUri(<span class="hljs-keyword">new</span> URI(<span class="hljs-string">"https://localhost"</span>));

            httpMethod = HttpMethod.GET;

        }

    };

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> mockEntity = mock(Parsable<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    when(mockEntity.getFieldDeserializers()).thenReturn(<span class="hljs-keyword">new</span> HashMap&lt;&gt;());

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> mockParsableFactory = mock(ParsableFactory<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    when(mockParsableFactory.create(any(ParseNode<span class="hljs-class">.<span class="hljs-keyword">class</span>))).<span class="hljs-title">thenReturn</span>(<span class="hljs-title">mockEntity</span>)</span>;

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> mockParseNode = mock(ParseNode<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    when(mockParseNode.getObjectValue(any(ParsableFactory<span class="hljs-class">.<span class="hljs-keyword">class</span>))).<span class="hljs-title">thenReturn</span>(<span class="hljs-title">mockEntity</span>)</span>;

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> mockFactory = mock(ParseNodeFactory<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    when(mockFactory.getParseNode(any(String<span class="hljs-class">.<span class="hljs-keyword">class</span>), <span class="hljs-title">any</span>(<span class="hljs-title">InputStream</span>.<span class="hljs-title">class</span>))).<span class="hljs-title">thenReturn</span>(<span class="hljs-title">mockParseNode</span>)</span>;

    when(mockFactory.getValidContentType()).thenReturn(<span class="hljs-string">"application/json"</span>);

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> requestAdapter = <span class="hljs-keyword">new</span> OkHttpRequestAdapter(authenticationProviderMock, mockFactory, <span class="hljs-keyword">null</span>, client);

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> errorMappings = errorMappingCodes == <span class="hljs-keyword">null</span> ? <span class="hljs-keyword">null</span> : <span class="hljs-keyword">new</span> HashMap&lt;String, ParsableFactory&lt;? extends Parsable&gt;&gt;();

    <span class="hljs-keyword">if</span> (errorMappings != <span class="hljs-keyword">null</span>)

        errorMappingCodes.forEach((mapping) -&gt; errorMappings.put(mapping, mockParsableFactory));

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> exception = assertThrows(ApiException<span class="hljs-class">.<span class="hljs-keyword">class</span>, () -&gt; <span class="hljs-title">requestAdapter</span>.<span class="hljs-title">send</span>(<span class="hljs-title">requestInformation</span>, <span class="hljs-title">errorMappings</span>, (<span class="hljs-title">node</span>) -&gt; <span class="hljs-title">mockEntity</span>))</span>;

    assertNotNull(exception);

    <span class="hljs-keyword">if</span> (expectDeserializedException)

        verify(mockParseNode, times(<span class="hljs-number">1</span>)).getObjectValue(mockParsableFactory);

    assertEquals(responseStatusCode, exception.getResponseStatusCode());

    assertTrue(exception.getResponseHeaders().containsKey(<span class="hljs-string">"request-id"</span>));

}
</div></code></pre>
</details>
<details><summary>Reusable Method for MCI (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> ParseNodeFactory <span class="hljs-title">createMockParseNodeFactory</span><span class="hljs-params">(ParseNode mockParseNode, String validContentType)</span> </span>{
    ParseNodeFactory mockFactory = mock(ParseNodeFactory<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;
    when(mockFactory.getParseNode(any(String<span class="hljs-class">.<span class="hljs-keyword">class</span>), <span class="hljs-title">any</span>(<span class="hljs-title">InputStream</span>.<span class="hljs-title">class</span>))).<span class="hljs-title">thenReturn</span>(<span class="hljs-title">mockParseNode</span>)</span>;
    when(mockFactory.getValidContentType()).thenReturn(validContentType);
    <span class="hljs-keyword">return</span> mockFactory;
}
</div></code></pre>
</details>
<hr>
<h2 id="mock-clone-instance-kiota-javamci12">Mock Clone Instance #kiota-java_MCI_12</h2>
<ul>
<li><strong>Scope</strong>: method level</li>
<li><strong>Mocked Class</strong>: <code>com.microsoft.kiota.serialization.ParseNodeFactory</code></li>
<li><strong>Test Case Count</strong>: 3</li>
<li><strong>MO Count</strong>: 3</li>
</ul>
<h3 id="reusable-method">Reusable Method</h3>
<pre class="hljs"><code><div><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> ParseNodeFactory <span class="hljs-title">createMockParseNodeFactory</span><span class="hljs-params">(ParseNode mockParseNode)</span> </span>{
    ParseNodeFactory mockParseNodeFactory = mock(ParseNodeFactory<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;
    when(mockParseNodeFactory.getParseNode(any(), any())).thenReturn(mockParseNode);
    <span class="hljs-keyword">return</span> mockParseNodeFactory;
}
</div></code></pre>
<h3 id="the-refactoring-details-in-each-test-cases">The refactoring details in each test cases</h3>
<hr>
<h4 id="test-case-id-kiota-javatest121">Test Case ID #kiota-java_Test_12_1</h4>
<h4 id="test-case-name-deserializesobjectwithoutreflectionfile-cjavaprojectsmicrosoftkiota-javacomponentsabstractionssrctestjavacommicrosoftkiotaserializationdeserializationhelperstestjava">Test Case Name: <code>deserializesObjectWithoutReflection</code>(File: <code>C:\Java_projects\Microsoft\kiota-java\components\abstractions\src\test\java\com\microsoft\kiota\serialization\DeserializationHelpersTest.java</code>)</h4>
<h4 id="mock-object-variable-name-mockparsenodefactory">Mock Object Variable Name: <code>mockParseNodeFactory</code></h4>
<summary>Suggested Diff</summary>
<pre class="hljs"><code><div>@@
    final ParseNode mockParseNode = mock(ParseNode.class);
    when(mockParseNode.getObjectValue(any())).thenReturn(new TestEntity() {

        {
            setId("123");
        }
    });
<span class="hljs-deletion">-    final ParseNodeFactory mockParseNodeFactory = mock(ParseNodeFactory.class);</span>
<span class="hljs-deletion">-    when(mockParseNodeFactory.getParseNode(any(), any())).thenReturn(mockParseNode);</span>
<span class="hljs-addition">+    final ParseNodeFactory mockParseNodeFactory = createMockParseNodeFactory(mockParseNode);</span>
    ParseNodeFactoryRegistry.defaultInstance.contentTypeAssociatedFactories.put(_jsonContentType, mockParseNodeFactory);
    final var result = KiotaSerialization.deserialize(_jsonContentType, strValue, TestEntity::createFromDiscriminatorValue);
    assertEquals("123", result.getId());
}
</div></code></pre>
<details><summary>Original Test Code (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-meta">@Test</span>

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">deserializesObjectWithoutReflection</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException </span>{

    <span class="hljs-keyword">final</span> String strValue = <span class="hljs-string">"{'id':'123'}"</span>;

    <span class="hljs-keyword">final</span> ParseNode mockParseNode = mock(ParseNode<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    when(mockParseNode.getObjectValue(any())).thenReturn(<span class="hljs-keyword">new</span> TestEntity() {



        {

            setId(<span class="hljs-string">"123"</span>);

        }

    });

    <span class="hljs-keyword">final</span> ParseNodeFactory mockParseNodeFactory = mock(ParseNodeFactory<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    when(mockParseNodeFactory.getParseNode(any(), any())).thenReturn(mockParseNode);

    ParseNodeFactoryRegistry.defaultInstance.contentTypeAssociatedFactories.put(_jsonContentType, mockParseNodeFactory);

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> result = KiotaSerialization.deserialize(_jsonContentType, strValue, TestEntity::createFromDiscriminatorValue);

    assertEquals(<span class="hljs-string">"123"</span>, result.getId());

}
</div></code></pre>
</details>
<details><summary>Reusable Method for MCI (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> ParseNodeFactory <span class="hljs-title">createMockParseNodeFactory</span><span class="hljs-params">(ParseNode mockParseNode)</span> </span>{
    ParseNodeFactory mockParseNodeFactory = mock(ParseNodeFactory<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;
    when(mockParseNodeFactory.getParseNode(any(), any())).thenReturn(mockParseNode);
    <span class="hljs-keyword">return</span> mockParseNodeFactory;
}
</div></code></pre>
</details>
<hr>
<h4 id="test-case-id-kiota-javatest122">Test Case ID #kiota-java_Test_12_2</h4>
<h4 id="test-case-name-deserializesobjectwithreflectionfile-cjavaprojectsmicrosoftkiota-javacomponentsabstractionssrctestjavacommicrosoftkiotaserializationdeserializationhelperstestjava">Test Case Name: <code>deserializesObjectWithReflection</code>(File: <code>C:\Java_projects\Microsoft\kiota-java\components\abstractions\src\test\java\com\microsoft\kiota\serialization\DeserializationHelpersTest.java</code>)</h4>
<h4 id="mock-object-variable-name-mockparsenodefactory">Mock Object Variable Name: <code>mockParseNodeFactory</code></h4>
<summary>Suggested Diff</summary>
<pre class="hljs"><code><div>@@
    final ParseNode mockParseNode = mock(ParseNode.class);
    when(mockParseNode.getObjectValue(any())).thenReturn(new TestEntity() {

        {
            setId("123");
        }
    });
<span class="hljs-deletion">-    final ParseNodeFactory mockParseNodeFactory = mock(ParseNodeFactory.class);</span>
<span class="hljs-deletion">-    when(mockParseNodeFactory.getParseNode(any(), any())).thenReturn(mockParseNode);</span>
<span class="hljs-addition">+    final ParseNodeFactory mockParseNodeFactory = createMockParseNodeFactory(mockParseNode);</span>
    ParseNodeFactoryRegistry.defaultInstance.contentTypeAssociatedFactories.put(_jsonContentType, mockParseNodeFactory);
    final var result = KiotaSerialization.deserialize(_jsonContentType, strValue, TestEntity::createFromDiscriminatorValue);
    assertEquals("123", result.getId());
}
@@
</div></code></pre>
<details><summary>Original Test Code (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-meta">@Test</span>

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">deserializesObjectWithReflection</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException </span>{

    <span class="hljs-keyword">final</span> String strValue = <span class="hljs-string">"{'id':'123'}"</span>;

    <span class="hljs-keyword">final</span> ParseNode mockParseNode = mock(ParseNode<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    when(mockParseNode.getObjectValue(any())).thenReturn(<span class="hljs-keyword">new</span> TestEntity() {



        {

            setId(<span class="hljs-string">"123"</span>);

        }

    });

    <span class="hljs-keyword">final</span> ParseNodeFactory mockParseNodeFactory = mock(ParseNodeFactory<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    when(mockParseNodeFactory.getParseNode(any(), any())).thenReturn(mockParseNode);

    ParseNodeFactoryRegistry.defaultInstance.contentTypeAssociatedFactories.put(_jsonContentType, mockParseNodeFactory);

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> result = KiotaSerialization.deserialize(_jsonContentType, strValue, TestEntity::createFromDiscriminatorValue);

    assertEquals(<span class="hljs-string">"123"</span>, result.getId());

}
</div></code></pre>
</details>
<details><summary>Reusable Method for MCI (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> ParseNodeFactory <span class="hljs-title">createMockParseNodeFactory</span><span class="hljs-params">(ParseNode mockParseNode)</span> </span>{
    ParseNodeFactory mockParseNodeFactory = mock(ParseNodeFactory<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;
    when(mockParseNodeFactory.getParseNode(any(), any())).thenReturn(mockParseNode);
    <span class="hljs-keyword">return</span> mockParseNodeFactory;
}
</div></code></pre>
</details>
<hr>
<h4 id="test-case-id-kiota-javatest123">Test Case ID #kiota-java_Test_12_3</h4>
<h4 id="test-case-name-deserializescollectionofobjectsfile-cjavaprojectsmicrosoftkiota-javacomponentsabstractionssrctestjavacommicrosoftkiotaserializationdeserializationhelperstestjava">Test Case Name: <code>deserializesCollectionOfObjects</code>(File: <code>C:\Java_projects\Microsoft\kiota-java\components\abstractions\src\test\java\com\microsoft\kiota\serialization\DeserializationHelpersTest.java</code>)</h4>
<h4 id="mock-object-variable-name-mockparsenodefactory">Mock Object Variable Name: <code>mockParseNodeFactory</code></h4>
<summary>Suggested Diff</summary>
<pre class="hljs"><code><div>@@
    final ParseNode mockParseNode = mock(ParseNode.class);
    when(mockParseNode.getCollectionOfObjectValues(any())).thenReturn(new ArrayList&lt;Parsable&gt;() {
        {
            add(new TestEntity() {
                {
                    setId("123");
                }
            });
        }
    });
<span class="hljs-deletion">-    final ParseNodeFactory mockParseNodeFactory = mock(ParseNodeFactory.class);</span>
<span class="hljs-deletion">-    when(mockParseNodeFactory.getParseNode(any(), any())).thenReturn(mockParseNode);</span>
<span class="hljs-addition">+    final ParseNodeFactory mockParseNodeFactory = createMockParseNodeFactory(mockParseNode);</span>
    ParseNodeFactoryRegistry.defaultInstance.contentTypeAssociatedFactories.put(_jsonContentType, mockParseNodeFactory);
    final var result = KiotaSerialization.deserializeCollection(_jsonContentType, strValue, TestEntity::createFromDiscriminatorValue);
    assertEquals("123", result.get(0).getId());
@@
</div></code></pre>
<details><summary>Original Test Code (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-meta">@Test</span>

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">deserializesCollectionOfObjects</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException </span>{

    <span class="hljs-keyword">final</span> String strValue = <span class="hljs-string">"{'id':'123'}"</span>;

    <span class="hljs-keyword">final</span> ParseNode mockParseNode = mock(ParseNode<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    when(mockParseNode.getCollectionOfObjectValues(any())).thenReturn(<span class="hljs-keyword">new</span> ArrayList&lt;Parsable&gt;() {



        {

            add(<span class="hljs-keyword">new</span> TestEntity() {



                {

                    setId(<span class="hljs-string">"123"</span>);

                }

            });

        }

    });

    <span class="hljs-keyword">final</span> ParseNodeFactory mockParseNodeFactory = mock(ParseNodeFactory<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    when(mockParseNodeFactory.getParseNode(any(), any())).thenReturn(mockParseNode);

    ParseNodeFactoryRegistry.defaultInstance.contentTypeAssociatedFactories.put(_jsonContentType, mockParseNodeFactory);

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> result = KiotaSerialization.deserializeCollection(_jsonContentType, strValue, TestEntity::createFromDiscriminatorValue);

    assertEquals(<span class="hljs-string">"123"</span>, result.get(<span class="hljs-number">0</span>).getId());

}
</div></code></pre>
</details>
<details><summary>Reusable Method for MCI (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> ParseNodeFactory <span class="hljs-title">createMockParseNodeFactory</span><span class="hljs-params">(ParseNode mockParseNode)</span> </span>{
    ParseNodeFactory mockParseNodeFactory = mock(ParseNodeFactory<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;
    when(mockParseNodeFactory.getParseNode(any(), any())).thenReturn(mockParseNode);
    <span class="hljs-keyword">return</span> mockParseNodeFactory;
}
</div></code></pre>
</details>
<hr>
<h2 id="mock-clone-instance-kiota-javamci13">Mock Clone Instance #kiota-java_MCI_13</h2>
<ul>
<li><strong>Scope</strong>: method level</li>
<li><strong>Mocked Class</strong>: <code>com.microsoft.kiota.serialization.ParseNode</code></li>
<li><strong>Test Case Count</strong>: 2</li>
<li><strong>MO Count</strong>: 2</li>
</ul>
<h3 id="reusable-method">Reusable Method</h3>
<pre class="hljs"><code><div><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> ParseNode <span class="hljs-title">createMockParseNode</span><span class="hljs-params">()</span> </span>{
    ParseNode mockParseNode = mock(ParseNode<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;
    when(mockParseNode.getObjectValue(any())).thenReturn(<span class="hljs-keyword">new</span> TestEntity() {
        {
            setId(<span class="hljs-string">"123"</span>);
        }
    });
    <span class="hljs-keyword">return</span> mockParseNode;
}
</div></code></pre>
<h3 id="the-refactoring-details-in-each-test-cases">The refactoring details in each test cases</h3>
<hr>
<h4 id="test-case-id-kiota-javatest131">Test Case ID #kiota-java_Test_13_1</h4>
<h4 id="test-case-name-deserializesobjectwithoutreflectionfile-cjavaprojectsmicrosoftkiota-javacomponentsabstractionssrctestjavacommicrosoftkiotaserializationdeserializationhelperstestjava">Test Case Name: <code>deserializesObjectWithoutReflection</code>(File: <code>C:\Java_projects\Microsoft\kiota-java\components\abstractions\src\test\java\com\microsoft\kiota\serialization\DeserializationHelpersTest.java</code>)</h4>
<h4 id="mock-object-variable-name-mockparsenode">Mock Object Variable Name: <code>mockParseNode</code></h4>
<summary>Suggested Diff</summary>
<pre class="hljs"><code><div><span class="hljs-comment">--- original</span>
<span class="hljs-comment">+++ refactored</span>
@@
    final String strValue = "{'id':'123'}";
<span class="hljs-deletion">-    final ParseNode mockParseNode = mock(ParseNode.class);</span>
<span class="hljs-deletion">-    when(mockParseNode.getObjectValue(any())).thenReturn(new TestEntity() {</span>
<span class="hljs-deletion">-</span>
<span class="hljs-deletion">-        {</span>
<span class="hljs-deletion">-            setId("123");</span>
<span class="hljs-deletion">-        }</span>
<span class="hljs-deletion">-    });</span>
<span class="hljs-addition">+    final ParseNode mockParseNode = createMockParseNode();</span>
    final ParseNodeFactory mockParseNodeFactory = mock(ParseNodeFactory.class);
    when(mockParseNodeFactory.getParseNode(any(), any())).thenReturn(mockParseNode);
    ParseNodeFactoryRegistry.defaultInstance.contentTypeAssociatedFactories.put(_jsonContentType, mockParseNodeFactory);
    final var result = KiotaSerialization.deserialize(_jsonContentType, strValue, TestEntity::createFromDiscriminatorValue);
    assertEquals("123", result.getId());
@@
</div></code></pre>
<details><summary>Original Test Code (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-meta">@Test</span>

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">deserializesObjectWithoutReflection</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException </span>{

    <span class="hljs-keyword">final</span> String strValue = <span class="hljs-string">"{'id':'123'}"</span>;

    <span class="hljs-keyword">final</span> ParseNode mockParseNode = mock(ParseNode<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    when(mockParseNode.getObjectValue(any())).thenReturn(<span class="hljs-keyword">new</span> TestEntity() {



        {

            setId(<span class="hljs-string">"123"</span>);

        }

    });

    <span class="hljs-keyword">final</span> ParseNodeFactory mockParseNodeFactory = mock(ParseNodeFactory<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    when(mockParseNodeFactory.getParseNode(any(), any())).thenReturn(mockParseNode);

    ParseNodeFactoryRegistry.defaultInstance.contentTypeAssociatedFactories.put(_jsonContentType, mockParseNodeFactory);

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> result = KiotaSerialization.deserialize(_jsonContentType, strValue, TestEntity::createFromDiscriminatorValue);

    assertEquals(<span class="hljs-string">"123"</span>, result.getId());

}
</div></code></pre>
</details>
<details><summary>Reusable Method for MCI (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> ParseNode <span class="hljs-title">createMockParseNode</span><span class="hljs-params">()</span> </span>{
    ParseNode mockParseNode = mock(ParseNode<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;
    when(mockParseNode.getObjectValue(any())).thenReturn(<span class="hljs-keyword">new</span> TestEntity() {
        {
            setId(<span class="hljs-string">"123"</span>);
        }
    });
    <span class="hljs-keyword">return</span> mockParseNode;
}
</div></code></pre>
</details>
<hr>
<h4 id="test-case-id-kiota-javatest132">Test Case ID #kiota-java_Test_13_2</h4>
<h4 id="test-case-name-deserializesobjectwithreflectionfile-cjavaprojectsmicrosoftkiota-javacomponentsabstractionssrctestjavacommicrosoftkiotaserializationdeserializationhelperstestjava">Test Case Name: <code>deserializesObjectWithReflection</code>(File: <code>C:\Java_projects\Microsoft\kiota-java\components\abstractions\src\test\java\com\microsoft\kiota\serialization\DeserializationHelpersTest.java</code>)</h4>
<h4 id="mock-object-variable-name-mockparsenode">Mock Object Variable Name: <code>mockParseNode</code></h4>
<summary>Suggested Diff</summary>
<pre class="hljs"><code><div><span class="hljs-comment">--- original</span>
<span class="hljs-comment">+++ refactored</span>
@@
    final String strValue = "{'id':'123'}";
<span class="hljs-deletion">-    final ParseNode mockParseNode = mock(ParseNode.class);</span>
<span class="hljs-deletion">-    when(mockParseNode.getObjectValue(any())).thenReturn(new TestEntity() {</span>
<span class="hljs-deletion">-</span>
<span class="hljs-deletion">-        {</span>
<span class="hljs-deletion">-            setId("123");</span>
<span class="hljs-deletion">-        }</span>
<span class="hljs-deletion">-    });</span>
<span class="hljs-addition">+    final ParseNode mockParseNode = createMockParseNode();</span>
    final ParseNodeFactory mockParseNodeFactory = mock(ParseNodeFactory.class);
    when(mockParseNodeFactory.getParseNode(any(), any())).thenReturn(mockParseNode);
    ParseNodeFactoryRegistry.defaultInstance.contentTypeAssociatedFactories.put(_jsonContentType, mockParseNodeFactory);
    final var result = KiotaSerialization.deserialize(_jsonContentType, strValue, TestEntity::createFromDiscriminatorValue);
    assertEquals("123", result.getId());
@@
</div></code></pre>
<details><summary>Original Test Code (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-meta">@Test</span>

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">deserializesObjectWithReflection</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException </span>{

    <span class="hljs-keyword">final</span> String strValue = <span class="hljs-string">"{'id':'123'}"</span>;

    <span class="hljs-keyword">final</span> ParseNode mockParseNode = mock(ParseNode<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    when(mockParseNode.getObjectValue(any())).thenReturn(<span class="hljs-keyword">new</span> TestEntity() {



        {

            setId(<span class="hljs-string">"123"</span>);

        }

    });

    <span class="hljs-keyword">final</span> ParseNodeFactory mockParseNodeFactory = mock(ParseNodeFactory<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    when(mockParseNodeFactory.getParseNode(any(), any())).thenReturn(mockParseNode);

    ParseNodeFactoryRegistry.defaultInstance.contentTypeAssociatedFactories.put(_jsonContentType, mockParseNodeFactory);

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> result = KiotaSerialization.deserialize(_jsonContentType, strValue, TestEntity::createFromDiscriminatorValue);

    assertEquals(<span class="hljs-string">"123"</span>, result.getId());

}
</div></code></pre>
</details>
<details><summary>Reusable Method for MCI (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> ParseNode <span class="hljs-title">createMockParseNode</span><span class="hljs-params">()</span> </span>{
    ParseNode mockParseNode = mock(ParseNode<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;
    when(mockParseNode.getObjectValue(any())).thenReturn(<span class="hljs-keyword">new</span> TestEntity() {
        {
            setId(<span class="hljs-string">"123"</span>);
        }
    });
    <span class="hljs-keyword">return</span> mockParseNode;
}
</div></code></pre>
</details>
<hr>
<h2 id="mock-clone-instance-kiota-javamci14">Mock Clone Instance #kiota-java_MCI_14</h2>
<ul>
<li><strong>Scope</strong>: method level</li>
<li><strong>Mocked Class</strong>: <code>com.microsoft.kiota.serialization.ParseNode</code></li>
<li><strong>Test Case Count</strong>: 2</li>
<li><strong>MO Count</strong>: 2</li>
</ul>
<h3 id="reusable-method">Reusable Method</h3>
<pre class="hljs"><code><div><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> ParseNode <span class="hljs-title">createMockParseNode</span><span class="hljs-params">(Parsable mockEntity)</span> </span>{
    ParseNode mockParseNode = mock(ParseNode<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;
    when(mockParseNode.getObjectValue(any(ParsableFactory<span class="hljs-class">.<span class="hljs-keyword">class</span>))).<span class="hljs-title">thenReturn</span>(<span class="hljs-title">mockEntity</span>)</span>;
    <span class="hljs-keyword">return</span> mockParseNode;
}
</div></code></pre>
<h3 id="the-refactoring-details-in-each-test-cases">The refactoring details in each test cases</h3>
<hr>
<h4 id="test-case-id-kiota-javatest141">Test Case ID #kiota-java_Test_14_1</h4>
<h4 id="test-case-name-sendreturnsobjectoncontentfile-cjavaprojectsmicrosoftkiota-javacomponentshttpokhttpsrctestjavacommicrosoftkiotahttpokhttprequestadaptertestjava">Test Case Name: <code>sendReturnsObjectOnContent</code>(File: <code>C:\Java_projects\Microsoft\kiota-java\components\http\okHttp\src\test\java\com\microsoft\kiota\http\OkHttpRequestAdapterTest.java</code>)</h4>
<h4 id="mock-object-variable-name-mockparsenode">Mock Object Variable Name: <code>mockParseNode</code></h4>
<summary>Suggested Diff</summary>
<pre class="hljs"><code><div>@@
    when(mockEntity.getFieldDeserializers()).thenReturn(new HashMap&lt;&gt;());
<span class="hljs-deletion">-    final var mockParseNode = mock(ParseNode.class);</span>
<span class="hljs-deletion">-    when(mockParseNode.getObjectValue(any(ParsableFactory.class))).thenReturn(mockEntity);</span>
<span class="hljs-addition">+    final var mockParseNode = createMockParseNode(mockEntity);</span>
    final var mockFactory = mock(ParseNodeFactory.class);
    when(mockFactory.getParseNode(any(String.class), any(InputStream.class))).thenReturn(mockParseNode);
    when(mockFactory.getValidContentType()).thenReturn("application/json");
    final var requestAdapter = new OkHttpRequestAdapter(authenticationProviderMock, mockFactory, null, client);
@@
</div></code></pre>
<details><summary>Original Test Code (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-meta">@ParameterizedTest</span>

<span class="hljs-meta">@ValueSource</span>(ints = { <span class="hljs-number">200</span>, <span class="hljs-number">201</span>, <span class="hljs-number">202</span>, <span class="hljs-number">203</span> })

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">sendReturnsObjectOnContent</span><span class="hljs-params">(<span class="hljs-keyword">int</span> statusCode)</span> <span class="hljs-keyword">throws</span> Exception </span>{

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> authenticationProviderMock = mock(AuthenticationProvider<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    authenticationProviderMock.authenticateRequest(any(RequestInformation<span class="hljs-class">.<span class="hljs-keyword">class</span>), <span class="hljs-title">any</span>(<span class="hljs-title">Map</span>.<span class="hljs-title">class</span>))</span>;

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> client = getMockClient(<span class="hljs-keyword">new</span> Response.Builder().code(statusCode).message(<span class="hljs-string">"OK"</span>).protocol(Protocol.HTTP_1_1).request(<span class="hljs-keyword">new</span> Request.Builder().url(<span class="hljs-string">"http://localhost"</span>).build()).body(ResponseBody.create(<span class="hljs-string">"test"</span>.getBytes(<span class="hljs-string">"UTF-8"</span>), MediaType.parse(<span class="hljs-string">"application/json"</span>))).build());

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> requestInformation = <span class="hljs-keyword">new</span> RequestInformation() {



        {

            setUri(<span class="hljs-keyword">new</span> URI(<span class="hljs-string">"https://localhost"</span>));

            httpMethod = HttpMethod.GET;

        }

    };

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> mockEntity = mock(Parsable<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    when(mockEntity.getFieldDeserializers()).thenReturn(<span class="hljs-keyword">new</span> HashMap&lt;&gt;());

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> mockParseNode = mock(ParseNode<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    when(mockParseNode.getObjectValue(any(ParsableFactory<span class="hljs-class">.<span class="hljs-keyword">class</span>))).<span class="hljs-title">thenReturn</span>(<span class="hljs-title">mockEntity</span>)</span>;

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> mockFactory = mock(ParseNodeFactory<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    when(mockFactory.getParseNode(any(String<span class="hljs-class">.<span class="hljs-keyword">class</span>), <span class="hljs-title">any</span>(<span class="hljs-title">InputStream</span>.<span class="hljs-title">class</span>))).<span class="hljs-title">thenReturn</span>(<span class="hljs-title">mockParseNode</span>)</span>;

    when(mockFactory.getValidContentType()).thenReturn(<span class="hljs-string">"application/json"</span>);

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> requestAdapter = <span class="hljs-keyword">new</span> OkHttpRequestAdapter(authenticationProviderMock, mockFactory, <span class="hljs-keyword">null</span>, client);

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> response = requestAdapter.send(requestInformation, <span class="hljs-keyword">null</span>, (node) -&gt; mockEntity);

    assertNotNull(response);

}
</div></code></pre>
</details>
<details><summary>Reusable Method for MCI (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> ParseNode <span class="hljs-title">createMockParseNode</span><span class="hljs-params">(Parsable mockEntity)</span> </span>{
    ParseNode mockParseNode = mock(ParseNode<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;
    when(mockParseNode.getObjectValue(any(ParsableFactory<span class="hljs-class">.<span class="hljs-keyword">class</span>))).<span class="hljs-title">thenReturn</span>(<span class="hljs-title">mockEntity</span>)</span>;
    <span class="hljs-keyword">return</span> mockParseNode;
}
</div></code></pre>
</details>
<hr>
<h4 id="test-case-id-kiota-javatest142">Test Case ID #kiota-java_Test_14_2</h4>
<h4 id="test-case-name-throwsapiexceptionfile-cjavaprojectsmicrosoftkiota-javacomponentshttpokhttpsrctestjavacommicrosoftkiotahttpokhttprequestadaptertestjava">Test Case Name: <code>throwsAPIException</code>(File: <code>C:\Java_projects\Microsoft\kiota-java\components\http\okHttp\src\test\java\com\microsoft\kiota\http\OkHttpRequestAdapterTest.java</code>)</h4>
<h4 id="mock-object-variable-name-mockparsenode">Mock Object Variable Name: <code>mockParseNode</code></h4>
<summary>Suggested Diff</summary>
<pre class="hljs"><code><div>@@
    when(mockParsableFactory.create(any(ParseNode.class))).thenReturn(mockEntity);
<span class="hljs-deletion">-    final var mockParseNode = mock(ParseNode.class);</span>
<span class="hljs-deletion">-    when(mockParseNode.getObjectValue(any(ParsableFactory.class))).thenReturn(mockEntity);</span>
<span class="hljs-addition">+    final var mockParseNode = createMockParseNode(mockEntity);</span>
    final var mockFactory = mock(ParseNodeFactory.class);
    when(mockFactory.getParseNode(any(String.class), any(InputStream.class))).thenReturn(mockParseNode);
    when(mockFactory.getValidContentType()).thenReturn("application/json");
@@
</div></code></pre>
<details><summary>Original Test Code (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-meta">@SuppressWarnings</span>(<span class="hljs-string">"unchecked"</span>)

<span class="hljs-meta">@ParameterizedTest</span>

<span class="hljs-meta">@MethodSource</span>(<span class="hljs-string">"providesErrorMappings"</span>)

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">throwsAPIException</span><span class="hljs-params">(<span class="hljs-keyword">int</span> responseStatusCode, List&lt;String&gt; errorMappingCodes, <span class="hljs-keyword">boolean</span> expectDeserializedException)</span> <span class="hljs-keyword">throws</span> Exception </span>{

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> authenticationProviderMock = mock(AuthenticationProvider<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    authenticationProviderMock.authenticateRequest(any(RequestInformation<span class="hljs-class">.<span class="hljs-keyword">class</span>), <span class="hljs-title">any</span>(<span class="hljs-title">Map</span>.<span class="hljs-title">class</span>))</span>;

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> client = getMockClient(<span class="hljs-keyword">new</span> Response.Builder().code(responseStatusCode).message(<span class="hljs-string">"Not Found"</span>).protocol(Protocol.HTTP_1_1).request(<span class="hljs-keyword">new</span> Request.Builder().url(<span class="hljs-string">"http://localhost"</span>).build()).body(ResponseBody.create(<span class="hljs-string">"test"</span>.getBytes(<span class="hljs-string">"UTF-8"</span>), MediaType.parse(<span class="hljs-string">"application/json"</span>))).header(<span class="hljs-string">"request-id"</span>, <span class="hljs-string">"request-id-value"</span>).build());

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> requestInformation = <span class="hljs-keyword">new</span> RequestInformation() {



        {

            setUri(<span class="hljs-keyword">new</span> URI(<span class="hljs-string">"https://localhost"</span>));

            httpMethod = HttpMethod.GET;

        }

    };

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> mockEntity = mock(Parsable<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    when(mockEntity.getFieldDeserializers()).thenReturn(<span class="hljs-keyword">new</span> HashMap&lt;&gt;());

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> mockParsableFactory = mock(ParsableFactory<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    when(mockParsableFactory.create(any(ParseNode<span class="hljs-class">.<span class="hljs-keyword">class</span>))).<span class="hljs-title">thenReturn</span>(<span class="hljs-title">mockEntity</span>)</span>;

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> mockParseNode = mock(ParseNode<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    when(mockParseNode.getObjectValue(any(ParsableFactory<span class="hljs-class">.<span class="hljs-keyword">class</span>))).<span class="hljs-title">thenReturn</span>(<span class="hljs-title">mockEntity</span>)</span>;

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> mockFactory = mock(ParseNodeFactory<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    when(mockFactory.getParseNode(any(String<span class="hljs-class">.<span class="hljs-keyword">class</span>), <span class="hljs-title">any</span>(<span class="hljs-title">InputStream</span>.<span class="hljs-title">class</span>))).<span class="hljs-title">thenReturn</span>(<span class="hljs-title">mockParseNode</span>)</span>;

    when(mockFactory.getValidContentType()).thenReturn(<span class="hljs-string">"application/json"</span>);

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> requestAdapter = <span class="hljs-keyword">new</span> OkHttpRequestAdapter(authenticationProviderMock, mockFactory, <span class="hljs-keyword">null</span>, client);

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> errorMappings = errorMappingCodes == <span class="hljs-keyword">null</span> ? <span class="hljs-keyword">null</span> : <span class="hljs-keyword">new</span> HashMap&lt;String, ParsableFactory&lt;? extends Parsable&gt;&gt;();

    <span class="hljs-keyword">if</span> (errorMappings != <span class="hljs-keyword">null</span>)

        errorMappingCodes.forEach((mapping) -&gt; errorMappings.put(mapping, mockParsableFactory));

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> exception = assertThrows(ApiException<span class="hljs-class">.<span class="hljs-keyword">class</span>, () -&gt; <span class="hljs-title">requestAdapter</span>.<span class="hljs-title">send</span>(<span class="hljs-title">requestInformation</span>, <span class="hljs-title">errorMappings</span>, (<span class="hljs-title">node</span>) -&gt; <span class="hljs-title">mockEntity</span>))</span>;

    assertNotNull(exception);

    <span class="hljs-keyword">if</span> (expectDeserializedException)

        verify(mockParseNode, times(<span class="hljs-number">1</span>)).getObjectValue(mockParsableFactory);

    assertEquals(responseStatusCode, exception.getResponseStatusCode());

    assertTrue(exception.getResponseHeaders().containsKey(<span class="hljs-string">"request-id"</span>));

}
</div></code></pre>
</details>
<details><summary>Reusable Method for MCI (click to expand)</summary>
<pre class="hljs"><code><div><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> ParseNode <span class="hljs-title">createMockParseNode</span><span class="hljs-params">(Parsable mockEntity)</span> </span>{
    ParseNode mockParseNode = mock(ParseNode<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;
    when(mockParseNode.getObjectValue(any(ParsableFactory<span class="hljs-class">.<span class="hljs-keyword">class</span>))).<span class="hljs-title">thenReturn</span>(<span class="hljs-title">mockEntity</span>)</span>;
    <span class="hljs-keyword">return</span> mockParseNode;
}
</div></code></pre>
</details>
<hr>

</body>
</html>
